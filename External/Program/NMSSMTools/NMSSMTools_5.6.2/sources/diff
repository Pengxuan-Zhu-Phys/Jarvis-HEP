Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 22.aux
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 22.log
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 22.out
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 22.pdf
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 22.tex
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: 9model
diff -rbd micromegas/clean /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/clean
11c11
<   rm -rf Packages/HiggsBounds*  Packages/HiggsSignals* Packages/smodels-* Packages/softsusy* Packages/SPheno-*
---
>   rm -rf Packages/higgsbounds*  Packages/higgssignals* Packages/smodels-* Packages/softsusy* Packages/SPheno-* Packages/superiso_v*
27a28,30
>   rm -f include/microPath.h
>   rm -rf */*.dSYM */*/*.dSYM
>   rm  -f ._* */._* */*/._* */*/*/._*
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: CPVMSSM
diff -rbd micromegas/fileMap.txt /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/fileMap.txt
1c1
< 		Files in micromegas_5.0.2 
---
> 		Files in micromegas_5.0.9
44c44
< NMSSMTools_5.1.1		Code used for computing spectrum and some constraints in the NMSSM
---
> NMSSMTools_5.1.1		Code used for computing the spectrum and some constraints in the NMSSM
46,47c46,52
< SMODELS.make		executable to download the code SMODELS to check LHC constraints on new particles
< hBandS.make		executable to download the codes HiggsBounds and HiggsSignals to check collider constraints on Higgs particles
---
> SMODELS.makef		executable to download the code SMODELS to check LHC constraints on new particles
> SPHENO.makef   executable to download the code SPHENO to compute the spectrum and some constraints in the MSSM
> SSUSY.makef  executable to download the code SoftSUSY to compute the spectrum and some constraints in the MSSM
> SUPERISO.make  executable to download the code superISO to compute flavour observables
> HBOUNDS.makef   executable to download the code HiggsBounds to check collider constraints on new Higgs particles
> HSIGNALS.makef executable to download the code HiggsSignals to check collider constraints on the Higgs
> 
61a67
> 	 micromegasInterfaceParams.ini Parameters needed for SModels
83a90
> 	 superIso.c  for superISO
101c108
< 
---
>    DDvelocity.c  contains DM velocity distributions (Maxwell and SHM++)
129a137
> 	 all_22_ploc.c  defines the list of all 2->2 processes  involving two  DM and two SM particles
154,155d161
< 
< 
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: IDM
diff -rbd micromegas/include/hBandS.inc /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/hBandS.inc
1,2c1,2
< #define HBversion  "5.3.0beta" 
< #define HSversion  "2.2.3beta"  
---
> #define HBversion  "5.5.0" 
> #define HSversion  "2.3.0"  
3a4,7
>    system("rm -f HB.out HS.out");
>    system("cp HB.in HS.in");
>    system("cp HB.in hb.in");
>    
7,8c11,15
<    sprintf(HB,"%s/Packages/HiggsBounds-%s/HiggsBounds", micrO,HBversion);
<    sprintf(HS,"%s/Packages/HiggsSignals-%s/HiggsSignals",micrO,HSversion);    
---
>    sprintf(HB,"%s/Packages/higgsbounds-%s/build/HiggsBounds", micrO,HBversion);
>    sprintf(HS,"%s/Packages/higgssignals-%s/build/HiggsSignals",micrO,HSversion);    
> 
> #ifdef HIGGSBOUNDS
> 
15,18c22,23
<    system("rm -f HB.out HS.out");
<    system("cp HB.in HS.in");
<    system("cp HB.in  hb.in");
< #ifdef HIGGSBOUNDS
---
>    if(!access(HB ,X_OK ))
>    {
34a40
>    }  
45,46c51,54
< #define DataSet " LHC13 "
< //#define Method  " peak " 
---
>    if(!access(HS ,X_OK ))
>    {                           
> #define DataSet " latestresults "
> #define Method  " peak " 
48c56
< #define  Method " both "
---
> //#define  Method " both "
64a73
>    }
66d74
< 
Only in micromegas/include: include
diff -rbd micromegas/include/Lilith.inc /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/Lilith.inc
2,4c2,4
<    int n1,n2;
<    pythonversion_(&n1,&n2); 
<    if(n1==2)
---
> //   int n1,n2;
> //   pythonversion_(&n1,&n2); 
> //   if(n1==2)
6,7c6,12
<       sprintf(call_lilith, "python ../Packages/Lilith/run_lilith.py Lilith_in.xml  -s -r  Lilith_out.slha %d  %.2E ", n_par, m2logL_reference);
<       system(call_lilith);
---
>    
>       char*command=(char*)malloc(strlen(micrO)+200 );
>       sprintf(command, "python %s/Packages/Lilith-2-2.1db19.09patch1/run_lilith.py Lilith_in.xml  -s -r  Lilith_out.slha %d  %.2E ",
>         micrO,  n_par, m2logL_reference);
> 
>       system(command);
>       free(command);
16,18d20
<     } else 
<     {  printf("LILITH can not work with Python version > 2\n");
<        ndf=0;
19a22,25
> //     else 
> //    {  printf("LILITH can not work with Python version > 2\n");
> //       ndf=0;
> //    }   
diff -rbd micromegas/include/micromegas_aux.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/micromegas_aux.h
4c4
< #define MPlank      1.22091E19   /* Plank mass in [GeV] */
---
> #define MPlanck      1.22091E19   /* Planck mass in [GeV] */
40a41,44
> extern double peterson21(    double (*F)(double),                double a, double b, double *aerr);
> extern double peterson21_arg(double (*F)(double,void*),void*par, double a, double b, double *aerr);
> 
> 
42a47
> extern double detAl( int N, double  *A);
62a68
> extern int maxPlistLen;
162a169,171
> extern void mass22_parDel(par_22*arg,double T);
> extern double sqmeIntDel(par_22*arg,double eps);
> 
185c194
< extern int vPolar(int out1,int out2,int out3,double*left,double*right,double*lng);
---
> extern int  vPolar( char**N,  double*lng);
207a217,231
> extern double plr2pval(double l);
> extern double pval2plr(double p); 
> 
> extern double uConversion(int u1,int u2);
> 
> #define  _GeV_  0
> #define  _g_    1
> #define  _K_    2   
> #define  _cm_1_ 3
> #define  _s_1_  4
> #define  _MP_   5
> #define  _erg_  6
> 
> extern double FSRdNdE(double E, double p,double m, double q, int spin2);
> 
213c237,242
< extern double tWidth21(char *name, double T);
---
> extern double tWidth21(char *name, double T,int show);
> 
> extern float UpperLim(float CL,int If, int N, float* FC, float muB,float*FB,int *Iflag);
> 
> extern void  addErrorMess( char** All, char * one);
> extern void delInterval(double x1,double x2,double **intervals, int*n);
diff -rbd micromegas/include/micromegas.fh /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/micromegas.fh
15c15,16
<      > deltaY,dmAsymm,Vesc,Vrot,FracCDM2,Mcdm1,Mcdm2,Tstart,Tend
---
>      > deltaY,dmAsymm,Vesc,Vrot, betaSHMpp,etaSHMpp,
>      > FracCDM2,Mcdm1,Mcdm2,Tstart,Tend
25c26,27
<      > deltaY,dmAsymm,Vesc,Vrot,FracCDM2,Mcdm1,Mcdm2,Tstart,Tend
---
>      > deltaY,dmAsymm,Vesc,Vrot, betaSHMpp,etaSHMpp,
>      > FracCDM2,Mcdm1,Mcdm2,Tstart,Tend
44c46
<      >displaySpectrum,nucleonAmplitudes,displayRecoilPlot,
---
>      >displaySpectrum,nucleonAmplitudes,
47c49
<      >   ic22event,hbBlockMO, LilithMO 
---
>      >   ic22event,hbBlockMO, LilithMO, smodels 
49c51
<      >displaySpectrum,nucleonAmplitudes,displayRecoilPlot,
---
>      >displaySpectrum,nucleonAmplitudes,
52c54
<      >  IC22event, hbBlockMO, LilithMO
---
>      >  IC22event, hbBlockMO, LilithMO, smodels
59c61
<      >         darkOmegaFO,oneChannel, vSigma,captureAux,
---
>      >         darkOmegaFO,oneChannel, vSigma,captureCS,
69c71
<      >         darkOmegaFO, oneChannel, vSigma,captureAux,
---
>      >         darkOmegaFO, oneChannel, vSigma,captureCS,
81c83
<      >nucleusRecoilAux,nucleusRecoil0Aux,cutRecoilResult,dNdERecoil
---
>      >nucleusRecoilCS,nucleusRecoil0CS,cutRecoilResult,dNdERecoil
84c86
<      >nucleusRecoilAux,nucleusRecoil0Aux,cutRecoilResult,dNdERecoil
---
>      >nucleusRecoilCS,nucleusRecoil0CS,cutRecoilResult,dNdERecoil
diff -rbd micromegas/include/micromegas_f.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/micromegas_f.h
272,278d271
< extern int displayrecoilplot_(double * tab, char * text, double *E1, double *E2,int len);
< /*
<     integer function displayRecoilPlot(tab, text, E1, E2)
<     real*8  tab(*)
<     character *(*) text
<     real*8 E1,E2   
< */
diff -rbd micromegas/include/micromegas.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/micromegas.h
35c35
< typedef  struct { double par[41]; }  MOcommonSTR;
---
> typedef  struct { double par[43]; }  MOcommonSTR;
65c65
< #define Vearth      mocommon_.par[25]
---
> #define vEarth      mocommon_.par[25]
76,77c76,77
< #define Vesc        mocommon_.par[34]
< #define Vrot        mocommon_.par[35]
---
> #define vEsc        mocommon_.par[34]
> #define vRot        mocommon_.par[35]
202c202,203
< extern double darkOmega2(double fast, double Beps0);
---
> extern char*ExcludedFor2DM;
> extern double darkOmega2(double fast, double Beps);
203a205,208
> extern double darkOmegaTR(double TR, double YR, int Fast, double Beps,int *err);
> extern double darkOmega2TR(double TR, double Y1R, double Y2R,double fast, double Beps);
> extern double checkFO(double Besp,double T);
> extern double collisionWidth(numout*cc, double Beps,double T);
221,222d225
< extern double dY1F(double T);
< extern double dY2F(double T);
240a244,250
> 
> typedef struct{ numout*cc; REAL m[4]; double sqrtSmin; double C; double T; int Ton;}  frin22Par;
> 
> extern double cTcut;
> extern    double dYfreezeIn(double T, frin22Par*arg);
> int initFrinArg(char * process,  frin22Par*arg);
> extern double YfreezeIn22(char*process, double T0, double TR,  int plot);
254,262c264,271
< /* input parameters:
<        a)  v velocity in c=1 units, v is about 0.001.
<        b)  outP   0-gamma; 1-positron; 2-antiproton; 3,4,5 -
<          for neutrinos (electron, muon and tau correspondinly)
< output parameters:
<        a) returned value v*sigma/M_lop^2 in sm^3/(GeV^2*sec)
<        b) array of 250 double elements to store spectra.
<        c) errcode !=0 if  in process of decays of outgoing particles 
<           we get a non-SM particle which has not 1->2 decays.  
---
> /*
>  calculates the spectra of DM annihilation at rest and returns œÉv in cm^3/s. The calculated spectra for 
>  Œ≥, e + , pÃÑ, ŒΩ_e , ŒΩ_Œº , ŒΩ_œÑ are stored in arrays Sg, Se, Sp, Sne, Snm, Snl  of dimension NZ(=250 by default).
> 
>  key =n1+2*n2+4*n4    is a bit switch where n_i is 1 or zero 
>  n1=1  switch on effect of W,Z polarization 
>  n2=1  includes photon radiation for DM annihilation into light fermions (2->3 process)  
>  n4=1  prints contribution of different annihilation channels to œÉv 
264a274,276
> extern void  decaySpectrum(char*pName,int outP, double*tabD);
> extern void getSpectrum2(int wPol, double M, char*n1,char*n2,int outP, double *tab);
> 
359c371
< extern double  captureAux(double(*vfv)(double),int forSun, double M_cdm, double csIp, double csIn,double csDp,double csDn);
---
> extern double  captureCS(double(*vfv)(double),int forSun, double M_cdm, double csIp, double csIn,double csDp,double csDn);
382a395
> extern double SHMpp(double v);
383a397,399
> #define RE_DIM     150    // dimention of recoil energy array
> #define RE_START   1.E-3  // energy [keV] corresponding to zero element.
> #define RE_STEP    1.08   // factor for  recoil energies grid  E_{n+1}=E_n*RE_STEP 
385c401
< #define REDIM 150
---
> extern double maxRecoil(double A); // calculate maximal recoil energy using  atomic numner A, Mcdm1,Mcdm2,Mcdm
402c418
< extern double nucleusRecoilAux(
---
> extern double nucleusRecoilCS(
409c425
< extern double nucleusRecoil0Aux(
---
> extern double nucleusRecoil0CS(
415a432,462
> #define XENON1T_2018   1
> #define DarkSide_2018  2
> #define PICO_2019      4  
> #define CRESST_2019    8 
> 
> #define  AllDDexp  0xFFFFFFF
> 
> extern double (*dNdEfact)(double Enr_kev,int  A);
> extern double DD_factorCS(unsigned int Experiment, double pval, double(*vfv)(double), double cs_SI_P, double cs_SI_N,  double cs_SD_P, double cs_SD_N,char**expName);
> extern double DD_pvalCS(unsigned  int Experiment, double(*vfv)(double), double cs_SI_P, double cs_SI_N,  double cs_SD_P, double cs_SD_N,char**expName);  
> 
> extern double DD_factor(unsigned int Experiment, double pval, double(*vfv)(double),char**expName);
> extern double DD_pval(unsigned int Experiment, double(*vfv)(double), char**expName);  
> 
> 
> extern double  XENON1T_90(double M);            
> extern double  DS50_90(double M);
> extern double  DS50_90_noB(double M);
> extern double  CRESST_III_90(double M);
> extern double  CRESST_III_SDn_90(double M);
> extern double  PICO60_90(double M);
> extern double  PICO60_SDp_90(double M);
> extern double  XENON1T_SDp_90(double M);
> extern double  XENON1T_SDn_90(double M);
> 
> extern int Xe1TnEvents;
> extern double Xe1TpEff0(double E);
> extern double Xe1TpEff1(double E);
> extern double Xe1TpEff2(double E);
> extern int PICO60Flag;
> 
426a474
> extern int    isSMP(int pdg);
429,430d476
< extern int displayRecoilPlot(double * tab, char * text, double E1, double E2);
< 
436c482
< extern void smodels(int Run, int nf,double csMinFb, char*fileName,int wrt);
---
> extern int smodels(int Run, int nf,double csMinFb, char*fileName, char*version, int wrt);
444a491,493
> extern SxxType SxxF19EFT,    SxxXe131EFT,   SxxXe129EFT, 
>                SxxF19SHELL,  SxxXe129SHELL, SxxXe131SHELL, 
>                SxxF19SHELLm, SxxXe129SHELLm,SxxXe131SHELLm;
445a495,505
> 
> 
> extern int XENON1T_2018_SDFF;
> extern int PICO_60_SDFF;
> 
> 
> extern int setSpinDepFF( int experiment, int name_of_FF_set);
> 
> #define EFT   2  // 1203.3542
> #define SHELL  0  // 1304.7684  (min+max)/2
> #define SHELLm 1  // 1304.7684  1P_min 
461a522
> #define Sn_O17      (0.5)
494a556
> #define J_O17   2.5
522a585,587
> #define Z_Ca  20
> #define Z_W   74
> #define Z_O    8 
Only in micromegas/include: micromegasInterfaceParams.ini
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include: microPath.h
diff -rbd micromegas/include/modelMakefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/modelMakefile
17c17
<  $(cLib)/num_c.a   $(cLib)/serv.a $(cLib)/ntools.a    $(LX11)
---
>  $(cLib)/num_c.a   $(cLib)/serv.a $(cLib)/ntools.a  $(CURDIR)/../lib/maxGap.so  ../lib/dummy.a   $(LX11)
38c38
< 	$(DLSET) $(CXX) $(CXXFLAGS) -o $(main:.cpp=) $(main)  $(SSS)  $(lDL)  -lm -lpthread
---
> 	$(DLSET) $(CXX) $(CXXFLAGS) -o $(main:.cpp=) $(main)  $(SSS)  $(lDL)  -lm  $(lQuad) -lpthread
41c41
< 	$(DLSET) $(CC)  $(CFLAGS) -o $(main:.c=) $(main)  $(SSS) $(lDL)  -lm -lpthread
---
> 	$(DLSET) $(CC)  $(CFLAGS)   -o $(main:.c=)   $(main)  $(SSS)  $(lDL)  -lm  $(lQuad) -lpthread 
47c47
< 	$(DLSET) $(FC) $(FFLAGS) -ffixed-line-length-none -o $(main:.F=) $(main) $(cLib)/faux.o  $(SSS)   $(lDL)  -lm -lpthread
---
> 	$(DLSET) $(FC) $(FFLAGS) -ffixed-line-length-none -o $(main:.F=) $(main) $(cLib)/faux.o  $(SSS)   $(lDL)  -lm $(lQuad) -lpthread
73c73
< 	rm -f  smodels.* summary.*
---
> 	rm -f  smodels.* 
diff -rbd micromegas/include/SMODELS.inc /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include/SMODELS.inc
1a2
>    char *VERSION="2.0.0";
5,8d5
<    char *VERSION="1.2.2";
<  
<    printf("\nSMODELS:\n");
<    smodels(LHCrun,5/*nf*/, 0.1/*fb*/,  "smodels.in",0);
10c7,11
<    char*command=(char*)malloc(strlen(micrO)+200 );
---
>    strcpy(smodelsInfo,VERSION);
>    topology[0]=0;
>    analysis[0]=0;
>    status=0;
>    Rvalue=0;
11a13,21
>    if(VERSION[0]<'2' || VERSION[0]>'9')
>    {
>       char command[100];
>       sprintf(command, "echo  \" SModelS '%s' is not supported\n\" > smodels.err",VERSION);
>       system(command);
>       status=-5;
>    }else
>    {        
>       char*command=(char*)malloc(strlen(micrO)+300 );
14,15c24,25
<    {
<       sprintf(command,"cd  %s/Packages;  make -f  SMODELS.makef VERSION=%s", micrO,VERSION); 
---
>       {  printf("Downloading the program SModels\n");
>          sprintf(command,"pwd=$PWD; cd  %s/Packages;  make -f  SMODELS.makef VERSION=%s 1>$pwd/smodels.err  2>$pwd/smodels.err", micrO,VERSION); 
16a27,28
>          sprintf(command,"%s/Packages/smodels-%s/runSModelS.py",micrO,VERSION);
>          if(access(command,X_OK )) status=-4; else system("rm -f smodels.err");
19,22c31,35
< //   sprintf(command,"micrO=%s; python3  $micrO/Packages/smodels-%s/smodelsTools.py xseccomputer -p -N -v warning  -O -f smodels.in 2>smodels.out",micrO,VERSION),
< //   system(command);
< //printf("%s\n", command);
<    sprintf(command,"micrO=%s; python3  $micrO/Packages/smodels-%s/runSModelS.py -f smodels.in -p $micrO/include/micromegasInterfaceParams.ini -o ./ -v error 2>>smodels.out",micrO,VERSION);
---
>       if(status==0) if(smodels(LHCrun,5/*nf*/, 0.005/*fb*/, "smodels.slha",VERSION, 0)) status=-2;
>       if(status==0)
>       {    
>          sprintf(command,"micrO=%s; python3  $micrO/Packages/smodels-%s/runSModelS.py -f smodels.slha -p $micrO/include/smodels_parameters.ini -o ./ -v error 2>smodels.err\n"
>                              "if(test $? -eq 0) then rm -f smodels.err; fi \n",micrO,VERSION);
24,26c37,40
< //printf("%s\n", command);   
<    free(command);   
<    slhaRead("smodels.in.smodelsslha", 1);
---
>          if(!access("smodels.err",R_OK )) status=-3;
>          else 
>          {        
>             err=slhaRead("smodels.slha.smodelsslha", 1);
29,31c43,45
<    printf("%s with database %s \n",smodels_version, smodels_database);
<    result=slhaVal("SModelS_Exclusion",0.,2,0,0); 
<    if(result>=0)
---
>             sprintf(smodelsInfo,"version %s with database %s",smodels_version, smodels_database);
>             status=slhaVal("SModelS_Exclusion",0.,2,0,0); 
>             if(status>=0)
33c47
<      slhaSTRFormat("SModelS_Exclusion"," 1 0  %s",topology);
---
>                slhaSTRFormat("SModelS_Exclusion"," 1 0  %[^#]",topology);
36d49
<      printf("highest R=%.2E from %s, topology %s\n", Rvalue,analysis,topology);
38,41d50
<    switch(result)
<    { case -1: printf("no channels for testing.\n");break;
<      case  0: printf("not excluded.\n");break; 
<      case  1: printf("excluded.\n ");break;
42a52,55
>       }
>       free(command);
>    }
>    if(status>=-2) smodelsOK=1; else smodelsOK=0; 
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/include: smodels_parameters.ini
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: LHM
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/lib: dummy.a
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/lib: maxGap.so
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/lib: micromegas.a
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: LLL_scalar
diff -rbd micromegas/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Makefile
4d3
< Tools = Packages/LoopTools-2.12-v0
6c5
< all:include/microPath.h $(Tools)/build/libooptools.a
---
> all:include/microPath.h
10,13d8
< $(Tools)/build/libooptools.a:
< 	cd $(Tools);  ./configure
< 	make -C $(Tools)
<         
19d13
< 	rm -f include/microPath.h
21,23d14
< 	make -C $(Tools)  clean
< 	rm -rf */*.dSYM 
< 
diff -rbd micromegas/man/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man/Makefile
2c2
< all: manual_5.0.pdf 
---
> all: manual_5.2.pdf 
4,9c4,9
< manual_5.0.pdf:manual_5.0.tex
< 	latex  manual_5.0
< 	bibtex manual_5.0
< 	latex  manual_5.0
< 	latex  manual_5.0
< 	dvipdf  manual_5.0.dvi
---
> manual_5.2.pdf:manual_5.2.tex
> 	latex  manual_5.2
> 	bibtex manual_5.2
> 	latex  manual_5.2
> 	latex  manual_5.2
> 	dvipdf  manual_5.2.dvi
Only in micromegas/man: manual_5.0.pdf
Only in micromegas/man: manual_5.0.tex
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man: manual_5.2.pdf
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man: manual_5.2.tex
diff -rbd micromegas/man/manual.bib /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man/manual.bib
34a35,66
> 
> @article{Amole:2017dex,
>     author = "Amole, C. and others",
>     collaboration = "PICO",
>     title = "{Dark Matter Search Results from the PICO-60 C$_3$F$_8$ Bubble Chamber}",
>     eprint = "1702.07666",
>     archivePrefix = "arXiv",
>     primaryClass = "astro-ph.CO",
>     reportNumber = "FERMILAB-PUB-17-058-AE-PPD",
>     doi = "10.1103/PhysRevLett.118.251301",
>     journal = "Phys. Rev. Lett.",
>     volume = "118",
>     number = "25",
>     pages = "251301",
>     year = "2017"
> }
> 
> 
> 
> 
> @article{Abdelhameed:2019mac,
>       author         = "Abdelhameed, A. H. and others",
>       title          = "{Description of CRESST-III Data}",
>       collaboration  = "CRESST",
>       year           = "2019",
>       eprint         = "1905.07335",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       SLACcitation   = "%%CITATION = ARXIV:1905.07335;%%"
> }
> 
> 
182a215,242
> @article{Kraml:2019sis,
>     author = "Kraml, Sabine and Loc, Tran Quang and Nhung, Dao Thi and Ninh, Le Duc",
>     title = "{Constraining new physics from Higgs measurements with Lilith: update to LHC Run 2 results}",
>     eprint = "1908.03952",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "IFIRSE-TH-2019-5",
>     doi = "10.21468/SciPostPhys.7.4.052",
>     journal = "SciPost Phys.",
>     volume = "7",
>     number = "4",
>     pages = "052",
>     year = "2019"
> }
> 
> @inproceedings{Bertrand:2020lyb,
>     author = "Bertrand, Marius and Kraml, Sabine and Loc, Tran Quang and Nhung, Dao Thi and Ninh, Le Duc",
>     title = "{Constraining new physics from Higgs measurements with Lilith-2}",
>     booktitle = "{Tools for High Energy Physics and Cosmology}",
>     eprint = "2012.11408",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "IFIRSE-TH-2020-3",
>     month = "12",
>     year = "2020"
> }
> 
> 
239c299
<       collaboration  = "OPAL Collaboration",
---
>       collaboration  = "OPAL",
270c330
<       author         = "Edelh√§user, Lisa and Heisig, Jan and Kr√§mer, Michael
---
>       author         = "Edelh√É‚Ç¨user, Lisa and Heisig, Jan and Kr√É‚Ç¨mer, Michael
287c347
<       author         = "Edelh√§user, Lisa and Kr√§mer, Michael and Sonneveld,
---
>       author         = "Edelh√É‚Ç¨user, Lisa and Kr√É‚Ç¨mer, Michael and Sonneveld,
370,386c430
< @article{Kraml:2013mwa,
<       author         = "Kraml, Sabine and Kulkarni, Suchita and Laa, Ursula and
<                         Lessa, Andre and Magerl, Wolfgang and
<                         Proschofsky-Spindler, Doris and Waltenberger, Wolfgang",
<       title          = "{SModelS: a tool for interpreting simplified-model
<                         results from the LHC and its application to
<                         supersymmetry}",
<       journal        = "Eur. Phys. J.",
<       volume         = "C74",
<       year           = "2014",
<       pages          = "2868",
<       doi            = "10.1140/epjc/s10052-014-2868-5",
<       eprint         = "1312.4175",
<       archivePrefix  = "arXiv",
<       primaryClass   = "hep-ph",
<       SLACcitation   = "%%CITATION = ARXIV:1312.4175;%%"
< }
---
> 
575,577d618
< @misc{SMS_dictionary,
<   note = "\url{http://smodels.hephy.at/wiki/SmsDictionary}",
< }
592,596d632
< %%% original SModelS webpage %%%
< @misc{smodels:wiki, 
<       note = "\url{http://smodels.hephy.at}",
< }
< 
1012c1048
<       author         = "Conte, Eric and Dumont, BÈranger and Fuks, Benjamin and
---
>       author         = "Conte, Eric and Dumont, B√©ranger and Fuks, Benjamin and
1217a1254,1282
> @article{Djouadi:2002ze,
>     author = "Djouadi, Abdelhak and Kneur, Jean-Loic and Moultaka, Gilbert",
>     title = "{SuSpect: A Fortran code for the supersymmetric and Higgs particle spectrum in the MSSM}",
>     eprint = "hep-ph/0211331",
>     archivePrefix = "arXiv",
>     reportNumber = "PM-02-39, CERN-TH-2002-325",
>     doi = "10.1016/j.cpc.2006.11.009",
>     journal = "Comput. Phys. Commun.",
>     volume = "176",
>     pages = "426--455",
>     year = "2007"
> }
> 
> 
> 
> @article{Mahmoudi:2008tp,
>     author = "Mahmoudi, F.",
>     title = "{SuperIso v2.3: A Program for calculating flavor physics observables in Supersymmetry}",
>     eprint = "0808.3144",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     doi = "10.1016/j.cpc.2009.02.017",
>     journal = "Comput. Phys. Commun.",
>     volume = "180",
>     pages = "1579--1613",
>     year = "2009"
> }
> 
> 
1862,1880d1926
< @article{Ambrogi:2017neo,
<       author         = "Ambrogi, Federico and Kraml, Sabine and Kulkarni, Suchita
<                         and Laa, Ursula and Lessa, Andre and Magerl, Veronika and
<                         Sonneveld, Jory and Traub, Michael and Waltenberger,
<                         Wolfgang",
<       title          = "{SModelS v1.1 user manual: Improving simplified model
<                         constraints with efficiency maps}",
<       journal        = "Comput. Phys. Commun.",
<       volume         = "227",
<       year           = "2018",
<       pages          = "72-98",
<       doi            = "10.1016/j.cpc.2018.02.007",
<       eprint         = "1701.06586",
<       archivePrefix  = "arXiv",
<       primaryClass   = "hep-ph",
<       reportNumber   = "LPSC17001, HEPHY-PUB-981-17",
<       SLACcitation   = "%%CITATION = ARXIV:1701.06586;%%"
< }
< 
1927a1974,2000
> @article{Bechtle:2020pkv,
>     author = "Bechtle, Philip and Dercks, Daniel and Heinemeyer, Sven and Klingl, Tobias and Stefaniak, Tim and Weiglein, Georg and Wittbrodt, Jonas",
>     title = "{HiggsBounds-5: Testing Higgs Sectors in the LHC 13 TeV Era}",
>     eprint = "2006.06007",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "BONN-TH-2020-03, DESY 20-093, DESY-20-093, IFT-UAM/CSIC-20-072, LU 20-27",
>     doi = "10.1140/epjc/s10052-020-08557-9",
>     month = "6",
>     year = "2020"
> }
> 
> @article{Bechtle:2020uwn,
>     author = "Bechtle, Philip and Heinemeyer, Sven and Klingl, Tobias and Stefaniak, Tim and Weiglein, Georg and Wittbrodt, Jonas",
>     title = "{HiggsSignals-2: Probing new physics with precision Higgs measurements in the LHC 13 TeV era}",
>     eprint = "2012.09197",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "BONN-TH-2020-09, DESY-20-228, IFT-UAM/CSIC-20-081, LU TP 20-53",
>     doi = "10.1140/epjc/s10052-021-08942-y",
>     journal = "Eur. Phys. J. C",
>     volume = "81",
>     number = "2",
>     pages = "145",
>     year = "2021"
> }
> 
1958a2032,2058
> @article{Hahn:1998yk,
>     author = "Hahn, T. and Perez-Victoria, M.",
>     title = "{Automatized one loop calculations in four-dimensions and D-dimensions}",
>     eprint = "hep-ph/9807565",
>     archivePrefix = "arXiv",
>     reportNumber = "UG-FT-87-98, KA-TP-7-1998",
>     doi = "10.1016/S0010-4655(98)00173-8",
>     journal = "Comput. Phys. Commun.",
>     volume = "118",
>     pages = "153--165",
>     year = "1999"
> }
> 
> @article{Semenov:2014rea,
>     author = "Semenov, A.",
>     title = "{LanHEP \textemdash{} A package for automatic generation of Feynman rules from the Lagrangian. Version 3.2}",
>     eprint = "1412.5016",
>     archivePrefix = "arXiv",
>     primaryClass = "physics.comp-ph",
>     reportNumber = "LAPTH-234-14",
>     doi = "10.1016/j.cpc.2016.01.003",
>     journal = "Comput. Phys. Commun.",
>     volume = "201",
>     pages = "167--170",
>     year = "2016"
> }
> 
1960c2060
<       author         = "Bechtle, Philip and Heinemeyer, Sven and St√•l, Oscar and
---
>       author         = "Bechtle, Philip and Heinemeyer, Sven and St{\aa}l, Oscar and
2042a2143,2476
> 
> @article{Aprile:2018dbl,
>       author         = "Aprile, E. and others",
>       title          = "{Dark Matter Search Results from a One Tonne$\times$Year
>                         Exposure of XENON1T}",
>       collaboration  = "XENON",
>       year           = "2018",
>       eprint         = "1805.12562",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       SLACcitation   = "%%CITATION = ARXIV:1805.12562;%%"
> }
> 
> 
> @article{Agnes:2018ves,
>       author         = "Agnes, P. and others",
>       title          = "{Low-Mass Dark Matter Search with the DarkSide-50
>                         Experiment}",
>       collaboration  = "DarkSide",
>       journal        = "Phys. Rev. Lett.",
>       volume         = "121",
>       year           = "2018",
>       number         = "8",
>       pages          = "081307",
>       doi            = "10.1103/PhysRevLett.121.081307",
>       eprint         = "1802.06994",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.HE",
>       reportNumber   = "FERMILAB-PUB-18-048-AE-E-PPD",
>       SLACcitation   = "%%CITATION = ARXIV:1802.06994;%%"
> }
> 
> 
> @article{Abdelhameed:2019hmk,
>       author         = "Abdelhameed, A. H. and others",
>       title          = "{First results from the CRESST-III low-mass dark matter
>                         program}",
>       collaboration  = "CRESST",
>       year           = "2019",
>       eprint         = "1904.00498",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       SLACcitation   = "%%CITATION = ARXIV:1904.00498;%%"
> }
> 
> @article{Abdelhameed:2019mac,
>       author         = "Abdelhameed, A. H. and others",
>       title          = "{Description of CRESST-III Data}",
>       collaboration  = "CRESST",
>       year           = "2019",
>       eprint         = "1905.07335",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       SLACcitation   = "%%CITATION = ARXIV:1905.07335;%%"
> }
> 
> @article{Amole:2019fdf,
>       author         = "Amole, C. and others",
>       title          = "{Dark Matter Search Results from the Complete Exposure of
>                         the PICO-60 C$_3$F$_8$ Bubble Chamber}",
>       collaboration  = "PICO",
>       journal        = "Phys. Rev.",
>       volume         = "D100",
>       year           = "2019",
>       number         = "2",
>       pages          = "022001",
>       doi            = "10.1103/PhysRevD.100.022001",
>       eprint         = "1902.04031",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       reportNumber   = "FERMILAB-PUB-19-073-AE-E",
>       SLACcitation   = "%%CITATION = ARXIV:1902.04031;%%"
> }
> 
> 
> 
> 
> 
> @article{Aprile:2019dbj,
>       author         = "Aprile, E. and others",
>       title          = "{Constraining the spin-dependent WIMP-nucleon cross
>                         sections with XENON1T}",
>       collaboration  = "XENON",
>       journal        = "Phys. Rev. Lett.",
>       volume         = "122",
>       year           = "2019",
>       number         = "14",
>       pages          = "141301",
>       doi            = "10.1103/PhysRevLett.122.141301",
>       eprint         = "1902.03234",
>       archivePrefix  = "arXiv",
>       primaryClass   = "astro-ph.CO",
>       SLACcitation   = "%%CITATION = ARXIV:1902.03234;%%"
> }
> 
> @article{Klos:2013rwa,
>       author         = "Klos, P. and Men\'endez, J. and Gazit, D. and Schwenk, A.",
>       title          = "{Large-scale nuclear structure calculations for
>                         spin-dependent WIMP scattering with chiral effective field
>                         theory currents}",
>       journal        = "Phys. Rev.",
>       volume         = "D88",
>       year           = "2013",
>       number         = "8",
>       pages          = "083516",
>       doi            = "10.1103/PhysRevD.89.029901, 10.1103/PhysRevD.88.083516",
>       note           = "[Erratum: Phys. Rev.D89,no.2,029901(2014)]",
>       eprint         = "1304.7684",
>       archivePrefix  = "arXiv",
>       primaryClass   = "nucl-th",
>       SLACcitation   = "%%CITATION = ARXIV:1304.7684;%%"
> }
> 
> @article{Fitzpatrick:2012ix,
>       author         = "Fitzpatrick, A. Liam and Haxton, Wick and Katz, Emanuel
>                         and Lubbers, Nicholas and Xu, Yiming",
>       title          = "{The Effective Field Theory of Dark Matter Direct
>                         Detection}",
>       journal        = "JCAP",
>       volume         = "1302",
>       year           = "2013",
>       pages          = "004",
>       doi            = "10.1088/1475-7516/2013/02/004",
>       eprint         = "1203.3542",
>       archivePrefix  = "arXiv",
>       primaryClass   = "hep-ph",
>       SLACcitation   = "%%CITATION = ARXIV:1203.3542;%%"
> }
> 
> @article{Bednyakov:2006ux,
>       author         = "Bednyakov, V. A. and Simkovic, F.",
>       title          = "{Nuclear spin structure in dark matter search: The Finit
>                         momentum transfer limit}",
>       journal        = "Phys. Part. Nucl.",
>       volume         = "37",
>       year           = "2006",
>       pages          = "S106-S128",
>       doi            = "10.1134/S1063779606070057",
>       eprint         = "hep-ph/0608097",
>       archivePrefix  = "arXiv",
>       primaryClass   = "hep-ph",
>       SLACcitation   = "%%CITATION = HEP-PH/0608097;%%"
> }
> 
> @article{Belanger:2020gnr,
>     author = "Belanger, Genevieve and Mjallal, Ali and Pukhov, Alexander",
>     title = "{Recasting direct detection limits within micrOMEGAs and implication for non-standard
> Dark Matter scenarios}",
>     eprint = "2003.08621",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     month = "3",
>     year = "2020"
> }
> 
> @article{Yellin:2002xd,
>       author         = "Yellin, S.",
>       title          = "{Finding an upper limit in the presence of unknown
>                         background}",
>       journal        = "Phys. Rev.",
>       volume         = "D66",
>       year           = "2002",
>       pages          = "032005",
>       doi            = "10.1103/PhysRevD.66.032005",
>       eprint         = "physics/0203002",
>       archivePrefix  = "arXiv",
>       primaryClass   = "physics",
>       reportNumber   = "UCSB-HEP-2002-01",
>       SLACcitation   = "%%CITATION = PHYSICS/0203002;%%"
> }
> 
> @article{Yellin:2008da,
>       author         = "Yellin, S.",
>       title          = "{Extending the optimum interval method}",
>       year           = "2008",
>       eprint         = "0709.2701",
>       archivePrefix  = "arXiv",
>       primaryClass   = "physics.data-an",
>       SLACcitation   = "%%CITATION = ARXIV:0709.2701;%%",
>       note="\url{http://cdms.stanford.edu/Upperlimit/}"
> }
> 
> @article{Myeong:2018kfh,
>     author = "Myeong, G.C. and Evans, N.W. and Belokurov, V. and Sanders, J.L. and Koposov, S.E.",
>     title = "{The Sausage Globular Clusters}",
>     eprint = "1805.00453",
>     archivePrefix = "arXiv",
>     primaryClass = "astro-ph.GA",
>     doi = "10.3847/2041-8213/aad7f7",
>     journal = "Astrophys. J. Lett.",
>     volume = "863",
>     number = "2",
>     pages = "L28",
>     year = "2018"
> }
> 
> @article{Belokurov_2018,
>    title={Co-formation of the disc and the stellar halo},
>    volume={478},
>    ISSN={1365-2966},
>    url={http://dx.doi.org/10.1093/mnras/sty982},
>    DOI={10.1093/mnras/sty982},
>    number={1},
>    journal={Monthly Notices of the Royal Astronomical Society},
>    publisher={Oxford University Press (OUP)},
>    author={Belokurov, V and Erkal, D and Evans, N W and Koposov, S E and Deason, A J},
>    year={2018},
>    month={Jun},
>    pages={611}
> }
> 
> 
> 
> 
> %%% SModelS references %%%
> 
> % SModelS proper: \cite{Kraml:2013mwa,Ambrogi:2017neo,Ambrogi:2018ujg}
> % LLPs in SModelS: \cite{Heisig:2018kfq,Ambrogi:2018ujg}
> 
> @misc{smodels20,
>       author         = "Lessa, Andre",
>       title          = "{SModelS v2.0: new features and developments}",
>       note         = "{Talk at 6th workshop of the LHC Reinterpretation Forum, 15--19 Feb 2021 (online)}, 
>       \url{https://indico.cern.ch/event/982553/contributions/4206953/}",
> }
> 
> @misc{smodels:wiki, 
>       note = "\url{http://smodels.github.io}",
> }
> 
> @article{Alguero:2020grj,
>     author = {Alguero, Ga\"el and Kraml, Sabine and Waltenberger, Wolfgang},
>     title = "{A SModelS interface for pyhf likelihoods}",
>     eprint = "2009.01809",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     journal = "Comput. Phys. Commun.",
>     year = "2020"
> }
> 
> @article{Ambrogi:2018ujg,
>     author = "Ambrogi, Federico and others",
>     title = "{SModelS v1.2: long-lived particles, combination of signal regions, and other novelties}",
>     eprint = "1811.10624",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "CP3-18-65",
>     doi = "10.1016/j.cpc.2019.07.013",
>     journal = "Comput. Phys. Commun.",
>     volume = "251",
>     pages = "106848",
>     year = "2020"
> }
> 
> 
> @article{Heisig:2018kfq,
>       author         = "Heisig, Jan and Kraml, Sabine and Lessa, Andre",
>       title          = "{Constraining new physics with searches for long-lived
>                         particles: Implementation into SModelS}",
>       doi            = "10.1016/j.physletb.2018.10.049",
>       year           = "2018",
>       eprint         = "1808.05229",
>       archivePrefix  = "arXiv",
>       primaryClass   = "hep-ph",
>       reportNumber   = "TTK-18-31",
>       SLACcitation   = "%%CITATION = ARXIV:1808.05229;%%"
> }
> 
> @article{Ambrogi:2017neo,
>     author = "Ambrogi, Federico and Kraml, Sabine and Kulkarni, Suchita and Laa, Ursula and Lessa, Andre and Magerl, Veronika and Sonneveld, Jory and Traub, Michael and Waltenberger, Wolfgang",
>     title = "{SModelS v1.1 user manual: Improving simplified model constraints with efficiency maps}",
>     eprint = "1701.06586",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "LPSC17001, HEPHY-PUB-981-17",
>     doi = "10.1016/j.cpc.2018.02.007",
>     journal = "Comput. Phys. Commun.",
>     volume = "227",
>     pages = "72--98",
>     year = "2018"
> }
> 
> @article{Kraml:2013mwa,
>       author         = "Kraml, Sabine and Kulkarni, Suchita and Laa, Ursula and
>                         Lessa, Andre and Magerl, Wolfgang and Proschofsky, Doris and 
>                         Waltenberger, Wolfgang",
>       title          = "{SModelS: a tool for interpreting simplified-model
>                         results from the LHC and its application to
>                         supersymmetry}",
>       journal        = "Eur.Phys.J.",
>       volume         = "C74",
>       pages          = "2868",
>       doi            = "10.1140/epjc/s10052-014-2868-5",
>       year           = "2014",
>       eprint         = "1312.4175",
>       archivePrefix  = "arXiv",
>       primaryClass   = "hep-ph",
>       SLACcitation   = "%%CITATION = ARXIV:1312.4175;%%",
> }
> 
> @article{Belanger:2020hyh,
>     author = "B\'elanger, Genevi\`eve and Pukhov, Alexander and Yaguna, Carlos E. and Zapata, \'Oscar",
>     title = "{The Z$_{5}$ model of two-component dark matter}",
>     eprint = "2006.14922",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     doi = "10.1007/JHEP09(2020)030",
>     journal = "JHEP",
>     volume = "09",
>     pages = "030",
>     year = "2020"
> }
> 
> @misc{SMS_dictionary,
>   note = "\url{https://smodels.github.io/docs/SmsDictionary}",
> }
> 
> 
> @article{Ball:2017nwa,
>     author = "Ball, Richard D. and others",
>     collaboration = "NNPDF",
>     title = "{Parton distributions from high-precision collider data}",
>     eprint = "1706.00428",
>     archivePrefix = "arXiv",
>     primaryClass = "hep-ph",
>     reportNumber = "CAVENDISH-HEP-17-06, CERN-TH-2017-077, EDINBURGH-2017-08, NIKHEF-2017-006, OUTP-17-04P, TIF-UNIMI-2017-3, CAVENDISH-HEP-17-06, CERN-TH-2017-077, Edinburgh 2017/08,
>   Nikhef/2017-006, OUTP-17-04P,TIF-UNIMI-2017-3",
>     doi = "10.1140/epjc/s10052-017-5199-5",
>     journal = "Eur. Phys. J. C",
>     volume = "77",
>     number = "10",
>     pages = "663",
>     year = "2017"
> }
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man: manual_.bin
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/man: utphys.bst
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/mdlIndep: dd_exp.c
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/mdlIndep/lib: aLib.xx
diff -rbd micromegas/mdlIndep/main.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/mdlIndep/main.c
14,18c14
< #define CDM_NUCLEUS
< /* Calculate number of events for 1kg*day and recoil energy distibution for various nuclei.
<    Input parameters are  Mcdm, spin dependent and spin independent cross sections on nucleons
< */
< #define NEUTRINO 
---
> //#define NEUTRINO 
32,36d27
< static int N=0;
< double ex(double x){ N++; return exp(x);}
< 
< 
< 
40,43c31
<   double in= simpson(ex,-10,0,1E-5,NULL);
<   printf("int=%e [%e], N=%d\n", in,1-exp(-10),N);     
<   exit(0);
< 
---
>    printf("%e %e \n", FeldmanCousins(0,0, 0.9), FeldmanCousins(0,0.35, 0.9));
44a33,34
>    printf("uConversion(_s_1_,_GeV_)=%E\n",uConversion(_s_1_,_GeV_));
>    exit(0);
55a46,62
> // ======= millicharge   
> 
> /*   
> {     
> double Z=10, A=20, alpha=1/137., RA=40, RN=pow(20,1./3.)*1E-3, rho=2.6,NAv=6E23,
> cmGeVsq=3.86E8*1E-36;
>    //  dE^2/dl[cm]= q^2*Mdm/MA*
>    
> double F= 2*M_PI*pow(Z*alpha,2)*log(RA/RN)*(NAv*rho/A);// *cmGeVsq;
> 
> printf("F=%.2E [1/cm^3]\n",F);
>   
>  
>     exit(0);
> } 
> */  
> // ===   
91c98
<      "and spherical region described by cone with angle %.2f[rad]\n",fi,2*dfi);
---
>      "and sph[Berical region described by cone with angle %.2f[rad]\n",fi,2*dfi);
124,172d130
< // Interaction with nucleus
<   
< #ifdef CDM_NUCLEUS
< { double dNdE[300];
<   double nEvents;
< 
< 
<   printf("\n======== Direct Detection ========\n");    
< 
<   nEvents=nucleusRecoilAux(Maxwell,73,Z_Ge,J_Ge73,SxxGe73, csSIp,csSIn, csSDp,csSDn,dNdE);
<                               
<   printf("73Ge: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));
<                                                                                                          
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 73Ge","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoilAux(Maxwell,131,Z_Xe,J_Xe131,SxxXe131,csSIp,csSIn, csSDp,csSDn,dNdE);
< 
<   printf("131Xe: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 131Xe","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoilAux(Maxwell,23,Z_Na,J_Na23,SxxNa23,csSIp,csSIn, csSDp,csSDn,dNdE);
< 
<   printf("23Na: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 23Na","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoilAux(Maxwell,127,Z_I,J_I127,SxxI127,csSIp,csSIn, csSDp,csSDn,dNdE);
< 
<   printf("I127: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 127I","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
<   
< }
< #endif 
< 
187c145
<   Crate=captureAux(Maxwell,forSun, Mcdm,csSIp,csSIn,csSDp,csSDn);
---
>   Crate=captureCS(Maxwell,forSun, Mcdm,csSIp,csSIn,csSDp,csSDn);
diff -rbd micromegas/mdlIndep/work/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/mdlIndep/work/Makefile
17c17
< VandP.c: models/vars1.mdl models/func1.mdl models/prtcls1.mdl
---
> VandP.c: models/vars1.mdl models/func1.mdl models/prtcls1.mdl models/lgrng1.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: MSSM
diff -rbd micromegas/NMSSM/lib/loopGamma.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/lib/loopGamma.c
36c36
<   sprintf(buff+strlen(buff)," %E", Vrot/299792.*1.5957691);
---
>   sprintf(buff+strlen(buff)," %E", vRot/299792.*1.5957691);
diff -rbd micromegas/NMSSM/lib/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/lib/Makefile
3c3
< NMSSMTools = $(CURDIR)/../../Packages/NMSSMTools_5.1.1
---
> NMSSMTools = $(CURDIR)/../../Packages/NMSSMTools_5.5.2
diff -rbd micromegas/NMSSM/main.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/main.c
50,53c50,52
< /*#define CDM_NUCLEUS */ 
<       /* Calculate number of events for 1kg*day 
<          and recoil energy distibution for various nuclei
<       */
---
> #define CDM_NUCLEUS 
>      // Calculate  exclusion rate for direct detection experiments Xenon1T, DarkSide50, CRESST-III, and PICO-60 
>                    
87a87,88
>   useSLHAwidth=1;
>   VWdecay=1; VZdecay=0;
174c175
<      mode=4;
---
>      mode=0;
242,243c243,244
<    int HB_id[3],HB_result[3];
<    double  HB_obsratio[3],HS_observ,HS_chi2, HS_pval;
---
>    int HB_id[3]={0,0,0},HB_result[3];
>    double  HB_obsratio[3],HS_observ=-1,HS_chi2, HS_pval;
252c253
<    for(int i=0;i<3;i++) printf("  id= %d  result = %d  obsratio=%.2E  channel= %s \n", HB_id[i],HB_result[i],HB_obsratio[i],HB_chan[i]);
---
>    for(int i=0;i<3;i++) if(HB_id[i]) printf("  id= %d  result = %d  obsratio=%.2E  channel= %s \n", HB_id[i],HB_result[i],HB_obsratio[i],HB_chan[i]);
254a256,257
>    if(HS_observ>=0)
>    {
256a260
>    }  
284c288
<    char call_lilith[100], Lilith_version[20];
---
>    char Lilith_version[50];
286c290
<    if(LilithMDL("Lilith_in.xml"))
---
>    if(LilithMO("Lilith_in.xml"))
300c304
< {  int result=0;
---
> {  int status=0,smodelsOK=0;
302c306
<    char analysis[30]={},topology[30]={};
---
>    char analysis[50]={},topology[100]={},smodelsInfo[100];
304c308,317
< #include "../include/SMODELS.inc" 
---
> 
> #include "../include/SMODELS.inc" // SLHA interface with SModels:   smodels.slha  ==>  smodels.slha.smodelsslha
> 
>    printf("SModelS: %s \n",smodelsInfo);
>    if(smodelsOK) 
>    {  if(Rvalue>=1) printf(" Excluded."); else printf("Not excluded."); 
>       printf(" r-value = %.2E .",Rvalue); 
>       if(Rvalue>0)  printf(" Analysis='%s', topology='%s'.",analysis,topology);
>       printf("\n");
>    } else system("cat smodels.err"); // problem in version number, downloading or running. See smodels.err
311c324
< { int fast=1;
---
> { int fast=-1;
316a330
>   
324c338
<   VZdecay=1; VWdecay=1; cleanDecayTable();  
---
>   VZdecay=0; VWdecay=0; cleanDecayTable();  
442c456,457
< 
---
>   double csSIp,csSIn,csSDp,csSDn;
>   int sI,sD;    
450a466,471
> 
>     csSIp=  SCcoeff*pA0[0]*pA0[0]; 
>     csSDp=3*SCcoeff*pA5[0]*pA5[0]; 
>     csSIn=  SCcoeff*nA0[0]*nA0[0]; 
>     csSDn=3*SCcoeff*nA5[0]*nA5[0]; 
>                     
452,453c473,474
<     printf(" proton  SI %.3E  SD %.3E\n",SCcoeff*pA0[0]*pA0[0],3*SCcoeff*pA5[0]*pA5[0]);
<     printf(" neutron SI %.3E  SD %.3E\n",SCcoeff*nA0[0]*nA0[0],3*SCcoeff*nA5[0]*nA5[0]);
---
>     printf(" proton  SI %.3E  SD %.3E\n",csSIp,csSDp);
>     printf(" neutron SI %.3E  SD %.3E\n",csSIn,csSDn);     
459,500c480,485
< { double dNdE[300];
<   double nEvents;
< 
< printf("\n======== Direct Detection ========\n");    
< 
<   nEvents=nucleusRecoil(Maxwell,73,Z_Ge,J_Ge73,SxxGe73,dNdE);
< 
<   printf("73Ge: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));
<                                                                                                          
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 73Ge","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoil(Maxwell,131,Z_Xe,J_Xe131,SxxXe131,dNdE);
< 
<   printf("131Xe: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 131Xe","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoil(Maxwell,23,Z_Na,J_Na23,SxxNa23,dNdE);
< 
<   printf("23Na: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 23Na","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
< 
<   nEvents=nucleusRecoil(Maxwell,127,Z_I,J_I127,SxxI127,dNdE);
< 
<   printf("I127: Total number of events=%.2E /day/kg\n",nEvents);
<   printf("Number of events in 10 - 50 KeV region=%.2E /day/kg\n",
<                                    cutRecoilResult(dNdE,10,50));                                   
< #ifdef SHOWPLOTS
<     displayPlot("Distribution of recoil energy of 127I","E[keV]",1,50,0,1,"dNdE",0,dNdERecoil,dNdE);
< #endif
<   
---
> { char* expName; 
>   printf("\n===== Direct detection exclusion:======\n");
>   double pval=DD_pval(AllDDexp, Maxwell, &expName);
>   printf("pval=%E\n", pval);
>   if(pval<0.1 )  printf("Excluded by %s  %.1f%%\n", expName, 100*(1-pval)); 
>   else printf("Not excluded by DD experiments  at 90%% level \n"); 
501a487
> 
595c581
<   system("rm -f   smodels.in  smodels.log  smodels.out  summary.*");  
---
> //  system("rm -f   smodels.*");  
diff -rbd micromegas/NMSSM/work/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/work/Makefile
17c17
< VandP.c: models/vars1.mdl models/func1.mdl models/prtcls1.mdl
---
> VandP.c: models/vars1.mdl models/func1.mdl models/prtcls1.mdl models/lgrng1.mdl
diff -rbd micromegas/NMSSM/work/models/func1.mdl /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/work/models/func1.mdl
93c93
< Mbp    |bPoleMass()
---
> Mbp    |MbMb*(1+4/3*alphaQCD(MbMb)/PI) %    bPoleMass()
diff -rbd micromegas/NMSSM/work/models/vars1.mdl /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/NMSSM/work/models/vars1.mdl
5c5
< EE     |0.31343      |Electromagnetic coupling constant
---
> EE     |0.3122       |Electromagnetic coupling constant
7c7
< MW     |80.385       |W mass 
---
> MW     |80.37        |W mass 
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: NMSSM_FO
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages: CPsuperH2.3
diff -rbd micromegas/Packages/HBOUNDS.makef /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/HBOUNDS.makef
1c1
< HB=HiggsBounds-$(VERSION)
---
> HB=higgsbounds-$(VERSION)
3c3
< all:$(HB)/HiggsBounds
---
> all:$(HB)/build/HiggsBounds
5,7c5,7
< $(HB)/HiggsBounds:$(HB)/README
< 	cd $(HB); ./configure
< 	make -C $(HB)
---
> $(HB)/build/HiggsBounds:$(HB)/COPYING
> 	if(test -z "`which cmake`" ) then echo "Install cmake to compile HiggsBounds"; exit 1; fi
> 	cd $(HB);     mkdir build; cd build; cmake ..; make
9c9
< $(HB)/README: 
---
> $(HB)/COPYING: 
11c11
< 	curl https://www.hepforge.org/archive/higgsbounds/$(HB).tar.gz  -O -L
---
> 	curl https://gitlab.com/higgsbounds/higgsbounds/-/archive/$(VERSION)/$(HB).tar.gz  -O -L
14c14
< 	wget https://www.hepforge.org/archive/higgsbounds/$(HB).tar.gz 
---
> 	wget https://gitlab.com/higgsbounds/higgsbounds/-/archive/$(VERSION)/$(HB).tar.gz 
19d18
< 	- unlink  HiggsBounds
22d20
< 	ln -s HiggsBounds-$(VERSION) HiggsBounds
\ No newline at end of file
diff -rbd micromegas/Packages/HSIGNALS.makef /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/HSIGNALS.makef
1c1
< HS=HiggsSignals-$(VERSION)
---
> HS=higgssignals-$(VERSION)
3c3
< all:$(HS)/HiggsSignals
---
> all:$(HS)/build/HiggsSignals
5,7c5,7
< $(HS)/HiggsSignals:$(HS)/README
< 	cd $(HS); ./configure --hbpath=../HiggsBounds
< 	make -C $(HS)
---
> $(HS)/build/HiggsSignals:$(HS)/COPYING
> 	if(test -z "`which cmake`" ) then echo "Install cmake to compile HiggsBounds"; exit 1; fi
> 	cd $(HS);  mkdir build; cd build; cmake ..; make
9c9
< $(HS)/README: 
---
> $(HS)/COPYING: 
11c11
< 	curl https://www.hepforge.org/archive/higgsbounds/$(HS).tar.gz  -O -L
---
> 	curl https://gitlab.com/higgsbounds/higgssignals/-/archive/$(VERSION)/$(HS).tar.gz  -O -L
14c14
< 	wget https://www.hepforge.org/archive/higgsbounds/$(HS).tar.gz 
---
> 	wget https://gitlab.com/higgsbounds/higgssignals/-/archive/$(VERSION)/$(HS).tar.gz 
diff -rbd micromegas/Packages/LanHEP/alg1b.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1b.c
293c293
< 		int v;
---
> 		long int v;
306c306
< 	int n1,n2,d1,d2,num,den,cf;
---
> 	long int n1,n2,d1,d2,num,den,cf;
367c367
< 		int i1,i2;
---
> 		long int i1,i2;
569c569
< 		pp=IntegerValue(t2);
---
> 		pp=(int)IntegerValue(t2);
diff -rbd micromegas/Packages/LanHEP/alg1c.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1c.c
25c25
< 					int iv;
---
> 					long int iv;
diff -rbd micromegas/Packages/LanHEP/alg1d.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1d.c
157,158c157,158
< 	int num1,den1;
< 	int io1=0,io2=0,rmn=0;
---
> 	long int num1,den1;
> 	long int io1=0,io2=0,rmn=0;
220c220
< 		int n1,n2,d1,d2,num,den,cf;
---
> 		long int n1,n2,d1,d2,num,den,cf;
283,284c283,284
< 	int num1,den1;
< 	int io1=0,io2=0,rmn=0;
---
> 	long int num1,den1;
> 	long int io1=0,io2=0,rmn=0;
348c348
< 		int n1,n2,d1,d2,num,den,cf;
---
> 		long int n1,n2,d1,d2,num,den,cf;
diff -rbd micromegas/Packages/LanHEP/alg1e.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1e.c
244c244
< 					po+=IntegerValue(CompoundArg1(prp));
---
> 					po+=(int)IntegerValue(CompoundArg1(prp));
diff -rbd micromegas/Packages/LanHEP/alg1f.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1f.c
229c229
< 	range=IntegerValue(CompoundArg2(by));
---
> 	range=(int)IntegerValue(CompoundArg2(by));
diff -rbd micromegas/Packages/LanHEP/alg1g.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1g.c
13c13
< 	int num1,den1;
---
> 	long int num1,den1;
33c33
< 		int n1,n2,d1,d2,num,den,cf;
---
> 		long int n1,n2,d1,d2,num,den,cf;
182c182
< 	int num1,den1;
---
> 	long int num1,den1;
203c203
< 			int n1,n2,d1,d2,num,den,cf;
---
> 			long int n1,n2,d1,d2,num,den,cf;
542c542
< 		int   iv, c=0, i=0;
---
> 		long int   iv, c=0, i=0;
564c564
< 				wl=ListNthList(CompoundArgN(m1,3),c);
---
> 				wl=ListNthList(CompoundArgN(m1,3),(int)c);
566c566
< 				w=sub_ind_wild(w,i,iv);
---
> 				w=sub_ind_wild(w,(int)i,(int)iv);
diff -rbd micromegas/Packages/LanHEP/alg1h.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1h.c
63c63
< 				pw=IntegerValue(CompoundArg2(aa));
---
> 				pw=(int)IntegerValue(CompoundArg2(aa));
152c152
< 				ino+=IntegerValue(CompoundArg1(prp));
---
> 				ino+=(int)IntegerValue(CompoundArg1(prp));
642c642
< 					cno=IntegerValue(CompoundArgN(
---
> 					cno=(int)IntegerValue(CompoundArgN(
744a745
>                         if(!GetAtomProperty(z,PROP_TYPE))
diff -rbd micromegas/Packages/LanHEP/alg1i.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1i.c
54c54
< 	int num1,den1;
---
> 	long int num1,den1;
72c72
< 		int n1,n2,d1,d2,num,den,cf;
---
> 		long int n1,n2,d1,d2,num,den,cf;
122c122
< 	int num1,den1;
---
> 	long int num1,den1;
139c139
< 		int n1,n2,d1,d2,num,den,cf;
---
> 		long int n1,n2,d1,d2,num,den,cf;
1095c1095
< 			int n=IntegerValue(CompoundArg1(ListFirst(l1))),
---
> 			long int n=IntegerValue(CompoundArg1(ListFirst(l1))),
diff -rbd micromegas/Packages/LanHEP/alg1p.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1p.c
12c12
< 		return IntegerValue(pp1)-IntegerValue(pp2);
---
> 		return (int)(IntegerValue(pp1)-IntegerValue(pp2));
30c30
< 			n=pw+IntegerValue(CompoundArg2(pp));
---
> 			n=pw+(int)IntegerValue(CompoundArg2(pp));
35c35
< 				int n,d,c;
---
> 				long int n,d,c;
96c96
< 		int num, den;
---
> 		long int num, den;
207c207
< 					pw=IntegerValue(CompoundArg2(ListFirst(l4)));
---
> 					pw=(int)IntegerValue(CompoundArg2(ListFirst(l4)));
314c314
< 						pw=IntegerValue(CompoundArg2(ListFirst(l4)));
---
> 						pw=(int)IntegerValue(CompoundArg2(ListFirst(l4)));
386c386
< 		int n1,n2,d1,d2,n,d,c;
---
> 		long int n1,n2,d1,d2,n,d,c;
497c497
< 	int dd,d1,d2,d3=0;
---
> 	long int dd,d1,d2,d3=0;
557c557
< 		remake_2(a1,l1,ind1,ind2,d1,d2);
---
> 		remake_2(a1,l1,ind1,ind2,(int)d1,(int)d2);
604c604
< 		remake_3(a1,l1,ind1,ind2,ind3,d1,d2,d3);
---
> 		remake_3(a1,l1,ind1,ind2,ind3,(int)d1,(int)d2,(int)d3);
diff -rbd micromegas/Packages/LanHEP/alg1s.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg1s.c
177c177
< 		int nu=0, de=0, apdim=0, apcol=0, need_sq2;	
---
> 		long int nu=0, de=0, apdim=0, apcol=0, need_sq2;	
298c298
< 		ar=mk_im_f(apdim,apcol,inw,inc,inv,inv2);
---
> 		ar=mk_im_f((int)apdim,(int)apcol,inw,inc,inv,inv2);
340c340,341
< 	int nu=0, de=0, apdim=0, apcol=0, need_sq2;
---
> 	long int nu=0, de=0;
> 	int apdim=0, apcol=0, need_sq2;
377c378
< 					cw+=IntegerValue(pp);
---
> 					cw+=(int)IntegerValue(pp);
505c506
< 			apdim=IntegerValue(CompoundArgN(ListFirst(l1),3));
---
> 			apdim=(int)IntegerValue(CompoundArgN(ListFirst(l1),3));
582c583
< 			int nu1, de1;
---
> 			long int nu1, de1;
661c662,663
< extern int allow_dfdfc, fromdfdfc;
---
> extern int allow_dfdfc;
> extern List fromdfdfc;
739c741
< 			apdim=IntegerValue(CompoundArgN(ListFirst(l1),3));
---
> 			apdim=(int)IntegerValue(CompoundArgN(ListFirst(l1),3));
780c782
< 		int n,n1,n2,d,d1,d2,c;
---
> 		long int n,n1,n2,d,d1,d2,c;
950c952
< 					ret+=IntegerValue(prop);
---
> 					ret+=(int)IntegerValue(prop);
1008c1010
< 			ret+=IntegerValue(prop);
---
> 			ret+=(int)IntegerValue(prop);
1061c1063
< 			ret+=IntegerValue(prop);
---
> 			ret+=(int)IntegerValue(prop);
diff -rbd micromegas/Packages/LanHEP/alg2a.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2a.c
70c70
< 			pw=IntegerValue(CompoundArg2(t));
---
> 			pw=(int)IntegerValue(CompoundArg2(t));
185c185
< 	int num,den;
---
> 	long int num,den;
413c413
< 		cf=gcf(num,den);
---
> 		cf=(int)gcf(num,den);
545c545
< 	int i1,i2;
---
> 	long int i1,i2;
564c564
< 		return i1;
---
> 		return (int)i1;
572c572
< 		return i1;
---
> 		return (int)i1;
715c715
< 					int la1, la2;
---
> 					long int la1, la2;
811c811
< 			i=IntegerValue(ListFirst(l2));
---
> 			i=(int)IntegerValue(ListFirst(l2));
886,887c886,887
< 		a2_symm_1(a2,IntegerValue(CompoundArg1(ListFirst(l))),
< 					IntegerValue(CompoundArg2(ListFirst(l))));
---
> 		a2_symm_1(a2,(int)IntegerValue(CompoundArg1(ListFirst(l))),
> 					(int)IntegerValue(CompoundArg2(ListFirst(l))));
diff -rbd micromegas/Packages/LanHEP/alg2b.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2b.c
55,56c55,56
< 		i1=IntegerValue(CompoundArg1(t1));
< 		i2=IntegerValue(CompoundArg1(t2));
---
> 		i1=(int)IntegerValue(CompoundArg1(t1));
> 		i2=(int)IntegerValue(CompoundArg1(t2));
362c362
< 	if(ListLength(pl)==2)
---
> 	if(ListLength(pl)==2 && !FAOutput)
364c364
< 		int num;
---
> 		long int num;
382c382
< 			no=IntegerValue(CompoundArg1(t));
---
> 			no=(int)IntegerValue(CompoundArg1(t));
527c527
< 				k=IntegerValue(ListFirst(l3));
---
> 				k=(int)IntegerValue(ListFirst(l3));
diff -rbd micromegas/Packages/LanHEP/alg2.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2.c
102c102
< 	int num, den, gc;
---
> 	long int num, den, gc;
144c144
< 					po=IntegerValue(CompoundArg2(pw));
---
> 					po=(int)IntegerValue(CompoundArg2(pw));
368c368
< 				int i1, i2;
---
> 				long int i1, i2;
424c424
< 	if(FAOutput)
---
> 	if(FAOutput && !UFOutput)
440c440
< 					int maxi=0;
---
> 					long int maxi=0;
623c623
< 				int i1, i2;
---
> 				long int i1, i2;
diff -rbd micromegas/Packages/LanHEP/alg2c.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2c.c
5c5,7
< extern int opTriHeu, opAbbrVrt;
---
> extern int opTriHeu, opAbbrVrt, has_cmplx_params;
> 
> List abbr_coeffs=0, no_abbr_coeffs=0;
7d8
< List abbr_coeffs=0;
9a11,46
> static int mcmp_err=0;
> 
> static int prmcmp(Term p1, Term p2)
> 	{
> 	if(CompoundArg1(p1)==A_I)
> 		return -1;
> 	if(CompoundArg1(p2)==A_I)
> 		return 1;
> 	return strcmp(AtomValue(CompoundArg1(p1)),AtomValue(CompoundArg1(p2)));
> 	}
> 
> 	static int mcmp(Term p1, Term p2)
> {
> 	p1=CompoundArg2(p1);
> 	p2=CompoundArg2(p2);
> 	if(ListLength(p1)<ListLength(p2))
> 		return -1;
> 	if(ListLength(p1)>ListLength(p2))
> 		return 1;
> 	for(;p1;p1=ListTail(p1),p2=ListTail(p2))
> 	{
> 		int s=strcmp(AtomValue(CompoundArg1(ListFirst(p1))),
> 				AtomValue(CompoundArg1(ListFirst(p2))));
> 		if(s)
> 			return s;
> 		s=(int)IntegerValue(CompoundArg2(ListFirst(p1)))
> 				-(int)IntegerValue(CompoundArg2(ListFirst(p2)));
> 		if(s)
> 			return s;
> 	}
> 	puts("Internal error (abbr-mcmp0)");
> 	mcmp_err=1;
> 	return 0;
> }
> 
> 		
29c66
< 				int d1,n1,d2,n2,d,n,gc;
---
> 				long int d1,n1,d2,n2,d,n,gc;
81c118
< 				int d1,n1,d2,n2,d,n,gc;
---
> 				long int d1,n1,d2,n2,d,n,gc;
210c247
< 	pw=IntegerValue(CompoundArg2(t1));
---
> 	pw=(int)IntegerValue(CompoundArg2(t1));
263d299
< static int adpno=0;
276,279c312,314
< 	int num,den,cnt, has_i=0;
< 	Term t1, t2, t2_2, ctf;
< 	char cbuf[32];
< 	Atom newprm;
---
> 	
> 	Term ctf;
> 	
324c359
< 	
---
> 	if(!CalcOutput || has_cmplx_params==0)
424c459
< 	Term t1, t2,  ctf=0;
---
> 	Term t2,  ctf=0;
439a475,481
> 	for(l1=CompoundArgN(a2,5);l1;l1=ListTail(l1))
> 	{
> 		l2=ConsumeCompoundArg(ListFirst(l1),2);
> 		if(l2) l2=SortedList(l2,prmcmp);
> 		SetCompoundArg(ListFirst(l1),2,l2);
> 	}
> 	
479a522,523
> 		int numf=1;
> 		
488d531
< 		num=den=1;
489a533,547
> 		
> 		l1=SortedList(l1,mcmp);
> 		if(IntegerValue(CompoundArg1(ListFirst(l1)))<0)
> 		{
> 			numf*=-1;
> 			for(l3=l1;l3;l3=ListTail(l3))
> 			{
> 				int nn=(int)IntegerValue(CompoundArg1(ListFirst(l3)));
> 				SetCompoundArg(ListFirst(l3),1,NewInteger(-nn));
> 			}
> 		}
> 		
> 		
> 		num=den=1;
> 		
495a554,558
> 			if(is_compound(newprm))
> 			{
> 				numf*=-1;
> 				newprm=CompoundArg1(newprm);
> 			}
509c572
< 			num=IntegerValue(CompoundArg1(ListFirst(l2)));
---
> 			num=(int)IntegerValue(CompoundArg1(ListFirst(l2)));
534a598
> 		
540a605,606
> 			Term ccprm=GetAtomProperty(newprm,A_ANTI);
> 			
548c614
< 						int f=IntegerValue(CompoundArg1(ListFirst(l4)));
---
> 						int f=(int)IntegerValue(CompoundArg1(ListFirst(l4)));
555a622,639
> 				
> 			for(l4=l1cc;l4;l4=ListTail(l4))
> 			{
> 				l5=ConsumeCompoundArg(ListFirst(l4),2);
> 				if(l5) l5=SortedList(l5,prmcmp);
> 				SetCompoundArg(ListFirst(l4),2,l5);
> 			}
> 			
> 			l1cc=SortedList(l1cc,mcmp);	
> 			if(IntegerValue(CompoundArg1(ListFirst(l1cc)))<0)
> 			{
> 				for(l4=l1cc;l4;l4=ListTail(l4))
> 				{
> 					int nn=(int)IntegerValue(CompoundArg1(ListFirst(l4)));
> 					SetCompoundArg(ListFirst(l4),1,NewInteger(-nn));
> 				}
> 				ccprm=MakeCompound1(OPR_MINUS,ccprm);
> 			}
558c642,643
< 					GetAtomProperty(newprm,A_ANTI),l1cc));	
---
> 					ccprm,l1cc));
> 			
564c649
< 		SetCompoundArg(t2,1,NewInteger(1));
---
> 		SetCompoundArg(t2,1,NewInteger(numf));
582,606d666
< static int mcmp_err=0;
< 
< static int mcmp(Term p1, Term p2)
< {
< 	p1=CompoundArg2(p1);
< 	p2=CompoundArg2(p2);
< 	if(ListLength(p1)<ListLength(p2))
< 		return -1;
< 	if(ListLength(p1)>ListLength(p2))
< 		return 1;
< 	for(;p1;p1=ListTail(p1),p2=ListTail(p2))
< 	{
< 		int s=strcmp(AtomValue(CompoundArg1(ListFirst(p1))),
< 				AtomValue(CompoundArg1(ListFirst(p2))));
< 		if(s)
< 			return s;
< 		s=IntegerValue(CompoundArg2(ListFirst(p1)))
< 				-IntegerValue(CompoundArg2(ListFirst(p2)));
< 		if(s)
< 			return s;
< 	}
< 	puts("Internal error (abbr-mcmp0)");
< 	mcmp_err=1;
< 	return 0;
< }
616c676
< 	List l;
---
> 
618c678
< 	Term t;
---
> 
686c746
< 				fit=IntegerValue(t);
---
> 				fit=(int)IntegerValue(t);
710c770
< 			int d=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			int d=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
715c775
< 			int d=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			int d=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
770c830
< 			t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),IntegerValue(CompoundArg1(ListFirst(pl))),1);
---
> 			t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),(int)IntegerValue(CompoundArg1(ListFirst(pl))),1);
776c836
< 						IntegerValue(CompoundArg1(ListFirst(l))),1));
---
> 						(int)IntegerValue(CompoundArg1(ListFirst(l))),1));
782,783c842,843
< 			t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),IntegerValue(CompoundArg1(r)),
< 														IntegerValue(CompoundArg2(r)));
---
> 			t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),(int)IntegerValue(CompoundArg1(r)),
> 														(int)IntegerValue(CompoundArg2(r)));
791c851
< 						IntegerValue(CompoundArg1(r)),IntegerValue(CompoundArg2(r))));
---
> 						(int)IntegerValue(CompoundArg1(r)),(int)IntegerValue(CompoundArg2(r))));
827c887
< 	t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),IntegerValue(CompoundArg1(ListFirst(pl))),1);
---
> 	t=l_2_t(ConsumeCompoundArg(ListFirst(pl),2),(int)IntegerValue(CompoundArg1(ListFirst(pl))),1);
842c902
< 					IntegerValue(CompoundArg1(ListFirst(pl))),1));
---
> 					(int)IntegerValue(CompoundArg1(ListFirst(pl))),1));
855c915
< 				IntegerValue(CompoundArg1(ListFirst(l))),1));
---
> 				(int)IntegerValue(CompoundArg1(ListFirst(l))),1));
873a934,944
> 	if(no_abbr_coeffs)
> 	for(l1=CompoundArgN(a2,5);l1;l1=ListTail(l1))
> 	{
> 	  Term m=ListFirst(l1);
> 	  for(l2=CompoundArg2(m);l2;l2=ListTail(l2))
> 	  {
> 	    if(ListMember(no_abbr_coeffs,CompoundArg1(ListFirst(l2))))
> 	      return;
> 	  }
> 	}
> 	
928c999,1000
< 				A_INFINITESIMAL))
---
> 				A_INFINITESIMAL) && !GetAtomProperty(CompoundArg1(ListFirst(l2)),
> 				PROP_TYPE))
947c1019
< 		int cnum;
---
> 		int cnum=1;
986c1058
< 		cnum=IntegerValue(CompoundArg1(ListFirst(pl)));
---
> 		cnum=(int)IntegerValue(CompoundArg1(ListFirst(pl)));
989c1061
< 			cnum=gcf(cnum,IntegerValue(CompoundArg1(ListFirst(l2))));
---
> 			cnum=(int)gcf(cnum,IntegerValue(CompoundArg1(ListFirst(l2))));
1042c1114
< 	int has_i=0, has_inf=0, has_c=0;
---
> 	int has_i=0, has_c=0;
1088a1161
> 	if(!has_cmplx_params)				
1106c1179
< 	
---
> 	/*
1126c1199
< 
---
> 	*/
1171c1244
< 		cnum=IntegerValue(CompoundArg1(ListFirst(pl)));
---
> 		cnum=(int)IntegerValue(CompoundArg1(ListFirst(pl)));
1174c1247
< 			cnum=gcf(cnum,IntegerValue(CompoundArg1(ListFirst(l2))));
---
> 			cnum=(int)gcf(cnum,IntegerValue(CompoundArg1(ListFirst(l2))));
1242c1315,1316
< 			if(GetAtomProperty(CompoundArg1(ListFirst(l1)),A_INFINITESIMAL))
---
> 			if(GetAtomProperty(CompoundArg1(ListFirst(l1)),A_INFINITESIMAL) &&
>                             !GetAtomProperty(CompoundArg1(ListFirst(l1)),PROP_TYPE) )
diff -rbd micromegas/Packages/LanHEP/alg2d.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2d.c
132c132
< 			ic=IntegerValue(CompoundArg2(t));
---
> 			ic=(int)IntegerValue(CompoundArg2(t));
143c143
< 			im=IntegerValue(CompoundArg2(t1));
---
> 			im=(int)IntegerValue(CompoundArg2(t1));
261c261
< 					np=IntegerValue(CompoundArg2(t3))-IntegerValue(CompoundArg2(t2));
---
> 					np=(int)IntegerValue(CompoundArg2(t3))-(int)IntegerValue(CompoundArg2(t2));
328c328
< 				int b1, b2;
---
> 				long int b1, b2;
365c365
< 					int np;
---
> 					long int np;
419,420c419,420
< 					pw=IntegerValue(CompoundArg2(ListFirst(l2)))
< 						+IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 					pw=(int)IntegerValue(CompoundArg2(ListFirst(l2)))
> 						+(int)IntegerValue(CompoundArg2(ListFirst(l1)));
448,449c448,449
<       int i=IntegerValue(ListFirst(l));
<       i/=gcf(i,ret);
---
>       int i=(int)IntegerValue(ListFirst(l));
>       i/=(int)gcf(i,ret);
474c474
< 	ret=IntegerValue(ListFirst(l));
---
> 	ret=(int)IntegerValue(ListFirst(l));
482c482
< 		ret=gcf(ret,IntegerValue(ListFirst(l)));
---
> 		ret=(int)gcf(ret,IntegerValue(ListFirst(l)));
547c547
< 	ti=gcf(cnum,cden);
---
> 	ti=(int)gcf(cnum,cden);
572c572
< 	int cnum,cden;
---
> 	long int cnum,cden;
590c590
< 		int c1,c2,c3;
---
> 		long int c1,c2,c3;
608c608
<     int cnum,n,d;
---
>     long int cnum,n,d;
diff -rbd micromegas/Packages/LanHEP/alg2e.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2e.c
4a5
> static Term el_name[16];
46,47c47,48
<    line1=IntegerValue(CompoundArgN(prop,4));
<     line2=IntegerValue(CompoundArgN(prop,3));
---
>    line1=(int)IntegerValue(CompoundArgN(prop,4));
>     line2=(int)IntegerValue(CompoundArgN(prop,3));
85c86
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop)));i++)
114c115
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop)));i++)
147c148
< 	for(i=1;i<=abs(IntegerValue(CompoundArg2(prop)));i++)
---
> 	for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop)));i++)
178c179
< 	for(i=1;i<=abs(IntegerValue(CompoundArg2(prop)));i++)
---
> 	for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop)));i++)
230c231
< 	int line1,line2,i;
---
> 	int line1,line2,i, inv;
234,235c235,240
<     line1=IntegerValue(CompoundArgN(prop,4));
<     line2=IntegerValue(CompoundArgN(prop,3));
---
>     line1=(int)IntegerValue(CompoundArgN(prop,4));
>     line2=(int)IntegerValue(CompoundArgN(prop,3));
> 	
> 	if(el_name[0]==el_name[1]) inv=0;
> 	else if(el_name[0]==GetAtomProperty(el_name[1],A_ANTI)) inv=1;
> 	else {puts("Internal error (ro2ii)"); return 0;}
278a284
> 		if(!inv)
279a286,290
> 		else
> 		{
> 		  l2=AppendFirst(l2,MakeCompound2(OPR_POW,par1,NewInteger(1)));
> 		  l2=AppendFirst(l2,MakeCompound2(OPR_POW,GetAtomProperty(par1,A_ANTI),NewInteger(1)));
> 		}
312a324
> 		if(!inv)
313a326,331
> 		else
> 		{
> 		  l2=AppendFirst(l2,MakeCompound2(OPR_POW,par1,NewInteger(1)));
> 		  l2=AppendFirst(l2,MakeCompound2(OPR_POW,GetAtomProperty(par1,A_ANTI),NewInteger(1)));
> 		}
> 	
357a376
> 	int inv1=0, inv2=0;
363,364c382,383
<     	line1=IntegerValue(CompoundArgN(prop1,4));
<     	line2=IntegerValue(CompoundArgN(prop2,4));
---
>     	line1=(int)IntegerValue(CompoundArgN(prop1,4));
>     	line2=(int)IntegerValue(CompoundArgN(prop2,4));
370,371c389,390
<     		line1=IntegerValue(CompoundArgN(prop1,3));
<     		line2=IntegerValue(CompoundArgN(prop2,3));
---
>     		line1=(int)IntegerValue(CompoundArgN(prop1,3));
>     		line2=(int)IntegerValue(CompoundArgN(prop2,3));
377a397,399
> 	
> 	
> 	
393a416,436
>    
> 	{
> 	  Atom a;
> 	  a=CompoundArgN(CompoundArgN(matr,(int)IntegerValue(CompoundArgN(prop1,3))),
> 				(int)IntegerValue(CompoundArgN(prop1,4)));
> 	  if(a!=el_name[0])
> 	  {
> 		if(GetAtomProperty(a,A_ANTI)==el_name[0]) inv1=1;
> 		else puts("Internal error (ro11i1)");
> 	  }
> 	  a=CompoundArgN(CompoundArgN(matr,(int)IntegerValue(CompoundArgN(prop2,3))),
> 				(int)IntegerValue(CompoundArgN(prop2,4)));
> 	   if(a!=el_name[1])
> 	  {
> 		if(GetAtomProperty(a,A_ANTI)==el_name[1]) inv2=1;
> 		else puts("Internal error (ro11i2)");
> 	  }
> 	}
>     
>     
>     
426a470,471
>     	if(inv1) par1=GetAtomProperty(par1,A_ANTI);
> 		if(inv2) par2=GetAtomProperty(par2,A_ANTI);
480,481c525,526
<     	line1=IntegerValue(CompoundArgN(prop1,4));
<     	line2=IntegerValue(CompoundArgN(prop2,4));
---
>     	line1=(int)IntegerValue(CompoundArgN(prop1,4));
>     	line2=(int)IntegerValue(CompoundArgN(prop2,4));
487,488c532,533
<     		line1=IntegerValue(CompoundArgN(prop1,3));
<     		line2=IntegerValue(CompoundArgN(prop2,3));
---
>     		line1=(int)IntegerValue(CompoundArgN(prop1,3));
>     		line2=(int)IntegerValue(CompoundArgN(prop2,3));
531c576
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop1)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop1)));i++)
570c615
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop1)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop1)));i++)
643,644c688,689
<     	line1=IntegerValue(CompoundArgN(prop1,4));
<     	line2=IntegerValue(CompoundArgN(prop2,4));
---
>     	line1=(int)IntegerValue(CompoundArgN(prop1,4));
>     	line2=(int)IntegerValue(CompoundArgN(prop2,4));
650,651c695,696
<     		line1=IntegerValue(CompoundArgN(prop1,3));
<     		line2=IntegerValue(CompoundArgN(prop2,3));
---
>     		line1=(int)IntegerValue(CompoundArgN(prop1,3));
>     		line2=(int)IntegerValue(CompoundArgN(prop2,3));
695c740
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop1)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop1)));i++)
733,734c778,779
< 				line1=IntegerValue(CompoundArgN(prop1,3));
<     			line2=IntegerValue(CompoundArgN(prop2,3));
---
> 				line1=(int)IntegerValue(CompoundArgN(prop1,3));
>     			line2=(int)IntegerValue(CompoundArgN(prop2,3));
746c791
<     for(i=1;i<=abs(IntegerValue(CompoundArg2(prop1)));i++)
---
>     for(i=1;i<=abs((int)IntegerValue(CompoundArg2(prop1)));i++)
782,783c827,828
< 				line1=IntegerValue(CompoundArgN(prop1,3));
<     			line2=IntegerValue(CompoundArgN(prop2,3));
---
> 				line1=(int)IntegerValue(CompoundArgN(prop1,3));
>     			line2=(int)IntegerValue(CompoundArgN(prop2,3));
823c868
< 			n=1+IntegerValue(CompoundArg2(pp));
---
> 			n=1+(int)IntegerValue(CompoundArg2(pp));
932c977
< 		zpo+=IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 		zpo+=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
944,945c989,990
< 			n1=IntegerValue(CompoundArg2(ListFirst(l2)));
< 			n2=l3?IntegerValue(CompoundArg2(ListFirst(l3))):0;
---
> 			n1=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
> 			n2=l3?(int)IntegerValue(CompoundArg2(ListFirst(l3))):0;
982,983c1027,1028
< 			coeff=IntegerValue(CompoundArg1(ListFirst(l2)))/
< 					IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 			coeff=(int)IntegerValue(CompoundArg1(ListFirst(l2)))/
> 					(int)IntegerValue(CompoundArg1(ListFirst(l1)));
1026,1029c1071,1074
< 	rows[0]=IntegerValue(CompoundArgN(props[0],3));
< 	rows[1]=IntegerValue(CompoundArgN(props[1],3));
< 	rows[2]=IntegerValue(CompoundArgN(props[2],3));
< 	rows[3]=IntegerValue(CompoundArgN(props[3],3));
---
> 	rows[0]=(int)IntegerValue(CompoundArgN(props[0],3));
> 	rows[1]=(int)IntegerValue(CompoundArgN(props[1],3));
> 	rows[2]=(int)IntegerValue(CompoundArgN(props[2],3));
> 	rows[3]=(int)IntegerValue(CompoundArgN(props[3],3));
1031,1034c1076,1079
< 	cols[0]=IntegerValue(CompoundArgN(props[0],4));
< 	cols[1]=IntegerValue(CompoundArgN(props[1],4));
< 	cols[2]=IntegerValue(CompoundArgN(props[2],4));
< 	cols[3]=IntegerValue(CompoundArgN(props[3],4));
---
> 	cols[0]=(int)IntegerValue(CompoundArgN(props[0],4));
> 	cols[1]=(int)IntegerValue(CompoundArgN(props[1],4));
> 	cols[2]=(int)IntegerValue(CompoundArgN(props[2],4));
> 	cols[3]=(int)IntegerValue(CompoundArgN(props[3],4));
1036c1081
< 	dim=IntegerValue(CompoundArg2(props[0]));
---
> 	dim=(int)IntegerValue(CompoundArg2(props[0]));
1145,1147c1190,1192
< 	rows[0]=IntegerValue(CompoundArgN(props[0],3));
< 	rows[1]=IntegerValue(CompoundArgN(props[1],3));
< 	rows[2]=IntegerValue(CompoundArgN(props[2],3));
---
> 	rows[0]=(int)IntegerValue(CompoundArgN(props[0],3));
> 	rows[1]=(int)IntegerValue(CompoundArgN(props[1],3));
> 	rows[2]=(int)IntegerValue(CompoundArgN(props[2],3));
1149,1151c1194,1196
< 	cols[0]=IntegerValue(CompoundArgN(props[0],4));
< 	cols[1]=IntegerValue(CompoundArgN(props[1],4));
< 	cols[2]=IntegerValue(CompoundArgN(props[2],4));
---
> 	cols[0]=(int)IntegerValue(CompoundArgN(props[0],4));
> 	cols[1]=(int)IntegerValue(CompoundArgN(props[1],4));
> 	cols[2]=(int)IntegerValue(CompoundArgN(props[2],4));
1153c1198
< 	dim=IntegerValue(CompoundArg2(props[0]));
---
> 	dim=(int)IntegerValue(CompoundArg2(props[0]));
1346c1391
< 						sn[no]=CompoundArg1(ListFirst(l1));
---
> 						el_name[no]=sn[no]=CompoundArg1(ListFirst(l1));
1353c1398,1399
< 			if(no==2 && sn[0]==sn[1] && alg2_red_orth_2(&lm,l,ss[0]))
---
> 			if(no==2 && (sn[0]==sn[1] || sn[0]==GetAtomProperty(sn[1],A_ANTI))
> 				  && alg2_red_orth_2(&lm,l,ss[0]))
1527c1573
< 						sn[no]=CompoundArg1(ListFirst(l1));
---
> 						el_name[no]=sn[no]=CompoundArg1(ListFirst(l1));
1534c1580,1581
< 			if(no==2 && sn[0]==sn[1] && alg2_red_orth_2(&lm,l,ss[0]))
---
> 			if(no==2 && (sn[0]==sn[1] || sn[0]==GetAtomProperty(sn[1],A_ANTI))
> 					&& alg2_red_orth_2(&lm,l,ss[0]))
1574c1621
< 		dim=IntegerValue(CompoundArgN(t,3));
---
> 		dim=(int)IntegerValue(CompoundArgN(t,3));
1632,1633c1679,1680
< 			cbuf1[p1r]='1'+i;
< 			cbuf1[p2r]='1'+j;
---
> 			cbuf1[p1r]='1'+(char)i;
> 			cbuf1[p2r]='1'+(char)j;
1641,1642c1688,1689
< 			cbuf2[p1i]='1'+i;
< 			cbuf2[p2i]='1'+j;
---
> 			cbuf2[p1i]='1'+(char)i;
> 			cbuf2[p2i]='1'+(char)j;
1660,1661c1707,1708
< 				cbuf1[p1r]='1'+i;
< 				cbuf1[p2r]='1'+j;
---
> 				cbuf1[p1r]='1'+(char)i;
> 				cbuf1[p2r]='1'+(char)j;
1674,1675c1721,1722
< 				cbuf2[p1i]='1'+i;
< 				cbuf2[p2i]='1'+j;
---
> 				cbuf2[p1i]='1'+(char)i;
> 				cbuf2[p2i]='1'+(char)j;
1901c1948
< 		dim=IntegerValue(CompoundArg2(t));
---
> 		dim=(int)IntegerValue(CompoundArg2(t));
1935,1936c1982,1983
< 			cbuf[p1]='1'+i;
< 			cbuf[p2]='1'+j;
---
> 			cbuf[p1]='1'+(char)i;
> 			cbuf[p2]='1'+(char)j;
1953,1954c2000,2001
< 				cbuf[p1]='1'+i;
< 				cbuf[p2]='1'+j;
---
> 				cbuf[p1]='1'+(char)i;
> 				cbuf[p2]='1'+(char)j;
2088c2135
< 			n=pw+IntegerValue(CompoundArg2(pp));
---
> 			n=pw+(int)IntegerValue(CompoundArg2(pp));
2115,2116c2162,2163
< 				n1=IntegerValue(CompoundArg1(t));
< 				n2=IntegerValue(CompoundArg1(m2));
---
> 				n1=(int)IntegerValue(CompoundArg1(t));
> 				n2=(int)IntegerValue(CompoundArg1(m2));
2156c2203
< 			ipw=IntegerValue(CompoundArg2(ListFirst(lp)));
---
> 			ipw=(int)IntegerValue(CompoundArg2(ListFirst(lp)));
diff -rbd micromegas/Packages/LanHEP/alg2r.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2r.c
213c213
< 					l1=AppendLast(l1,mk_cnvl(1,IntegerValue(CompoundArg1(t)),0,ppp));
---
> 					l1=AppendLast(l1,mk_cnvl(1,(int)IntegerValue(CompoundArg1(t)),0,ppp));
218c218
< 					l1=AppendLast(l1,mk_cnvl(1,IntegerValue(CompoundArg1(t)),0,ppp));
---
> 					l1=AppendLast(l1,mk_cnvl(1,(int)IntegerValue(CompoundArg1(t)),0,ppp));
223c223
< 					l1=AppendLast(l1,mk_cnvl(1,IntegerValue(CompoundArg1(t)),2,ppp));
---
> 					l1=AppendLast(l1,mk_cnvl(1,(int)IntegerValue(CompoundArg1(t)),2,ppp));
228c228
< 					l1=AppendLast(l1,mk_cnvl(1,IntegerValue(CompoundArg1(t)),0,ppp));
---
> 					l1=AppendLast(l1,mk_cnvl(1,(int)IntegerValue(CompoundArg1(t)),0,ppp));
247c247
< 					SetCompoundArg(tg,3,mk_gamma(1,IntegerValue(CompoundArg1(t))));
---
> 					SetCompoundArg(tg,3,mk_gamma(1,(int)IntegerValue(CompoundArg1(t))));
262,263c262,263
< 					l1=AppendLast(l1,mk_cnvl(1,IntegerValue(CompoundArg1(t)),
< 											1,IntegerValue(CompoundArg1(t1))));
---
> 					l1=AppendLast(l1,mk_cnvl(1,(int)IntegerValue(CompoundArg1(t)),
> 											1,(int)IntegerValue(CompoundArg1(t1))));
499c499
< 					SetCompoundArg(tg,3,mk_gamma(1,IntegerValue(CompoundArg1(t1))));
---
> 					SetCompoundArg(tg,3,mk_gamma(1,(int)IntegerValue(CompoundArg1(t1))));
711c711
< 			dn=IntegerValue(CompoundArg2(nf));
---
> 			dn=(int)IntegerValue(CompoundArg2(nf));
diff -rbd micromegas/Packages/LanHEP/alg2s.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2s.c
37c37
< 		ity[i]=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(
---
> 		ity[i]=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(
881c881
< 			ptyp[pno]=IntegerValue(CompoundArg2(prop));
---
> 			ptyp[pno]=(int)IntegerValue(CompoundArg2(prop));
diff -rbd micromegas/Packages/LanHEP/alg2t.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alg2t.c
25c25
< 			i=IntegerValue(ListFirst(l2));
---
> 			i=(int)IntegerValue(ListFirst(l2));
144c144
< 	int num, den;
---
> 	long int num, den;
211c211
< 				po=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 				po=(int)IntegerValue(CompoundArg2(ListFirst(l)));
237c237
< 				po=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 				po=(int)IntegerValue(CompoundArg2(ListFirst(l)));
257c257
< 				po=-IntegerValue(CompoundArg2(ListFirst(l)));
---
> 				po=-(int)IntegerValue(CompoundArg2(ListFirst(l)));
419c419
< 			fprintf(f,"%s ",AtomValue(ListNth(ind,IntegerValue(ListFirst(l1)))));
---
> 			fprintf(f,"%s ",AtomValue(ListNth(ind,(int)IntegerValue(ListFirst(l1)))));
442c442
< 				ii=IntegerValue(ListFirst(CompoundArg2(sp)));
---
> 				ii=(int)IntegerValue(ListFirst(CompoundArg2(sp)));
460c460
< 				ii=IntegerValue(ListFirst(CompoundArg2(sp)));
---
> 				ii=(int)IntegerValue(ListFirst(CompoundArg2(sp)));
472c472
< 				ii=IntegerValue(ListNth(CompoundArg2(sp),2));
---
> 				ii=(int)IntegerValue(ListNth(CompoundArg2(sp),2));
486c486
< 					ii=IntegerValue(ListNth(CompoundArg2(sp),3));
---
> 					ii=(int)IntegerValue(ListNth(CompoundArg2(sp),3));
505c505
< 				ii=IntegerValue(ListFirst(l));
---
> 				ii=(int)IntegerValue(ListFirst(l));
539c539
< 					AtomValue(ListNth(ind,IntegerValue(ListFirst(CompoundArg2(sp))))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListFirst(CompoundArg2(sp))))));
546,548c546,548
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))));
555,556c555,556
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))));
563,564c563,564
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))));
571,572c571,572
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))));
579,580c579,580
< 				n1=IntegerValue(ListNth(CompoundArg2(sp),1));
< 				n2=IntegerValue(ListNth(CompoundArg2(sp),2));
---
> 				n1=(int)IntegerValue(ListNth(CompoundArg2(sp),1));
> 				n2=(int)IntegerValue(ListNth(CompoundArg2(sp),2));
595,598c595,598
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),4)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),4)))));
606,608c606,608
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))));
615,617c615,617
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))));
624,626c624,626
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))));
633,635c633,635
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),1)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),2)))),
< 					AtomValue(ListNth(ind,IntegerValue(ListNth(CompoundArg2(sp),3)))));
---
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),1)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),2)))),
> 					AtomValue(ListNth(ind,(int)IntegerValue(ListNth(CompoundArg2(sp),3)))));
672c672
< 		num=IntegerValue(CompoundArg1(m2));
---
> 		num=(int)IntegerValue(CompoundArg1(m2));
713c713
< 				po=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 				po=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
719c719
< 					silcnt+=2*IntegerValue(sle);
---
> 					silcnt+=2*(int)IntegerValue(sle);
746c746
< 				ii=IntegerValue(ListFirst(CompoundArg2(sp)));
---
> 				ii=(int)IntegerValue(ListFirst(CompoundArg2(sp)));
766c766
< 				ii=IntegerValue(ListFirst(CompoundArg2(sp)));
---
> 				ii=(int)IntegerValue(ListFirst(CompoundArg2(sp)));
778c778
< 				ii=IntegerValue(ListNth(CompoundArg2(sp),2));
---
> 				ii=(int)IntegerValue(ListNth(CompoundArg2(sp),2));
811c811
< 				ii=IntegerValue(ListFirst(l));
---
> 				ii=(int)IntegerValue(ListFirst(l));
diff -rbd micromegas/Packages/LanHEP/alias.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/alias.c
47a48,92
> static List plused_atoms=0;
> 
> static Term del_plus(Term t)
> {
>   if(is_compound(t) && CompoundArity(t)==1 && CompoundName(t)==OPR_PLUS)
>   {
> 	Term t1=ConsumeCompoundArg(t,1);
> 	if(!is_atom(t1))
> 	{
> 	  ErrorInfo(1);
> 	  printf("alias: argument of '+' must be a symbol, got ");
> 	  WriteTerm(t1);puts("");
> 	}
> 	else
> 	  plused_atoms=AppendLast(plused_atoms,t1);
> 	
> 	FreeAtomic(t);
> 	return t1;
>   }
>   
>   if(is_compound(t))
>   {
> 	int i, a=CompoundArity(t);
> 	for(i=1;i<=a;i++)
> 	{
> 	  Term t1=ConsumeCompoundArg(t,i);
> 	  SetCompoundArg(t,i,del_plus(t1));
> 	}
> 	return t;
>   }
> 	
>   if(is_list(t))
>   {
> 	List l;
> 	for(l=t;l;l=ListTail(l))
> 	{
> 	  ChangeList(l,del_plus(ListFirst(l)));
> 	}
> 	return t;
>   }
>   
>   return t;
>   
> }
> 
51a97,102
> 	
> 	alsv=CopyTerm(al);
> 	
> 	plused_atoms=0;
> 	al=del_plus(al);
> 	
54c105,106
< 	alsv=CopyTerm(al);
---
> 	
> 	
58a111,112
> 
> 	
61c115,126
< 	l1=l3;
---
> 	
> 	l1=0;
> 	
> 	for(l2=l3;l2;l2=ListTail(l2))
> 	  if(!ListMember(plused_atoms,ListFirst(l2)))
> 		l1=AppendLast(l1,ListFirst(l2));
> 	  
> 	RemoveList(l3);
> 	RemoveList(plused_atoms);
> 	plused_atoms=0;
> 	l3=l1;
> 	
277c342,345
< 					
---
> 	if(is_compound(t) && CompoundArity(t)==1 && CompoundName(t)==OPR_PLUS)
> 	{
> 	  return CopyTerm(CompoundArg1(t));
> 	}
322a391
> 	 int cnt=0;
325a395,401
> 		cnt++;
> 		if(cnt>15)
> 		{
> 		  ErrorInfo(100);
> 		  printf("possible infine loop in processing aliases.\n");
> 		  return 0;
> 		}
347c423
< 	int lv;
---
> 	long int lv;
diff -rbd micromegas/Packages/LanHEP/angle.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/angle.c
34,35c34,35
< 		rs=IntegerValue(CompoundArg2(ListFirst(m1))) -
< 			IntegerValue(CompoundArg2(ListFirst(m2)));
---
> 		rs=(int)IntegerValue(CompoundArg2(ListFirst(m1))) -
> 			(int)IntegerValue(CompoundArg2(ListFirst(m2)));
155c155
< 		ncf=IntegerValue(CompoundArg1(nn));
---
> 		ncf=(int)IntegerValue(CompoundArg1(nn));
159c159
<            n=IntegerValue(CompoundArg1(ListFirst(ll)));
---
>            n=(int)IntegerValue(CompoundArg1(ListFirst(ll)));
201c201
< 		ncf=IntegerValue(CompoundArg1(nn));
---
> 		ncf=(int)IntegerValue(CompoundArg1(nn));
205c205
<            n=IntegerValue(CompoundArg1(ListFirst(ll)));
---
>            n=(int)IntegerValue(CompoundArg1(ListFirst(ll)));
286c286
< 		cf=IntegerValue(CompoundArg1(m2));
---
> 		cf=(int)IntegerValue(CompoundArg1(m2));
305c305
< 			po=IntegerValue(CompoundArg2(ListFirst(lp)));
---
> 			po=(int)IntegerValue(CompoundArg2(ListFirst(lp)));
394a395
> 	
451c452
< 	if(nco==0)
---
> 	/*if(nco==0)
456c457
< 		}
---
> 		}*/
514a516
> 	
603c605
< 	u=IntegerValue(CompoundArg2(CompoundArg2(a2)));
---
> 	u=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
607c609
< 		u=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 		u=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
714c716
< 	ret=IntegerValue(CompoundArg1(ListFirst(l)));
---
> 	ret=(int)IntegerValue(CompoundArg1(ListFirst(l)));
718c720
< 		ret=gcf(ret,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 		ret=(int)gcf(ret,IntegerValue(CompoundArg1(ListFirst(l))));
724c726
< 		i=IntegerValue(CompoundArg1(ListFirst(l)));
---
> 		i=(int)IntegerValue(CompoundArg1(ListFirst(l)));
784,785c786,787
< 	ic=IntegerValue(CompoundArg1(ListFirst(l2)))
< 		/ IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 	ic=(int)IntegerValue(CompoundArg1(ListFirst(l2)))
> 		/ (int)IntegerValue(CompoundArg1(ListFirst(l1)));
791,792c793,794
< 		i1=IntegerValue(CompoundArg1(ListFirst(l1)));
< 		i2=IntegerValue(CompoundArg1(ListFirst(l2)));
---
> 		i1=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
> 		i2=(int)IntegerValue(CompoundArg1(ListFirst(l2)));
843,845c845,847
< 	n=IntegerValue(CompoundArg1(a2));
< 	d=IntegerValue(CompoundArg2(a2));
< 	f=gcf(n,d);
---
> 	n=(int)IntegerValue(CompoundArg1(a2));
> 	d=(int)IntegerValue(CompoundArg2(a2));
> 	f=(int)gcf(n,d);
859c861
< 			int n,d,n1,d1,n2,d2,f;
---
> 			long int n,d,n1,d1,n2,d2,f;
889c891
< 	int n,d;
---
> 	long int n,d;
894c896
< 	int n1,n2,d1,d2;
---
> 	long int n1,n2,d1,d2;
931c933
< 				int n;
---
> 				long int n;
950c952
< 				int n;
---
> 				long int n;
1095c1097
< 			pw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			pw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
1145,1146c1147,1148
< 		n=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
< 		d=IntegerValue(CompoundArg2(CompoundArg1(ListFirst(l1))));
---
> 		n=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
> 		d=(int)IntegerValue(CompoundArg2(CompoundArg1(ListFirst(l1))));
1165c1167
< 				n=IntegerValue(CompoundArg1(ListFirst(l2)));
---
> 				n=(int)IntegerValue(CompoundArg1(ListFirst(l2)));
diff -rbd micromegas/Packages/LanHEP/atoms.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/atoms.c
10c10
< 	OPR_EQEQSIGN, OPR_DOLLAR, OPR_HASH;
---
> 	OPR_EQEQSIGN, OPR_AND, OPR_OR, OPR_NOT, OPR_NOTEQ, OPR_DEFINED, OPR_DOLLAR, OPR_HASH;
14c14
<       OPR_WILD, OPR_READ, OPR_EDIT, OPR_FUNCTION, OPR_CLASS;
---
>       OPR_WILD, OPR_READ, OPR_EDIT, OPR_FUNCTION, OPR_CLASS, A_FORT_NAME;
18c18
<     A_GAUGE, A_GHOST, A_END, A_S_COLOR, A_COLOR_EPS, A_BRST_TRANSF,
---
>     A_GAUGE, A_GHOST, A_END, A_S_COLOR, A_COLOR_EPS, A_COLOR_K6, A_COLOR_L6, A_BRST_TRANSF,
29c29
< 		OPR_CPART;
---
> 		OPR_CPART, A_AUX;
126a127,128
> 	A_COLOR_K6=NewAtom("__color_k6__",0);
> 	A_COLOR_L6=NewAtom("__color_l6__",0);
139a142,146
> 	OPR_NOTEQ=NewAtom("!=",0);
> 	OPR_NOT=NewAtom("!",0);
> 	OPR_OR=NewAtom("||",0);
> 	OPR_AND=NewAtom("&&",0);
> 	OPR_DEFINED=NewAtom("defined",0);
177a185
> 	A_AUX=NewAtom("aux",0);
199c207
< 
---
> 	A_FORT_NAME=NewAtom("fortran_name",0);
205a214
> 	SetOperator(OPR_PLUS,OP_FX,10);
214a224,227
> 	SetOperator(OPR_NOT,OP_FX,600);
> 	SetOperator(OPR_NOTEQ,OP_XFY,700);
> 	SetOperator(OPR_AND,OP_XFY,750);
> 	SetOperator(OPR_OR,OP_XFY,800);
241a255
> 	SetOperator(A_AUX,OP_FX,800);
263a278,279
> 	SetOperator(NewAtom("write",0),OP_FX,1250);
> 	SetOperator(NewAtom("display",0),OP_FX,1250);
305c321
< 	if(len==0) len=strlen(s);
---
> 	if(len==0) len=(int)strlen(s);
319c335
< 			j+=sizeof(List);
---
> 			j+=(int)sizeof(List);
322c338
< 				return j-sizeof(List)+i*0x10000+0x01000000;
---
> 				return j-(int)sizeof(List)+i*0x10000+(1L<<56);
325c341
< 			while(j%4)  j++;
---
> 			while(j%8)  j++;
337c353
< 	while(i<256 && ATOM_buffers[i]!=NULL && ATOM_buffill[i]+len+sizeof(List)>0xffff)
---
> 	while(i<256 && ATOM_buffers[i]!=NULL && ATOM_buffill[i]+len+(int)sizeof(List)>0xffff)
348,349c364,365
< 	strncpy(ATOM_buffers[i]+ATOM_buffill[i]+sizeof(List),s,len);
< 	*(ATOM_buffers[i]+ATOM_buffill[i]+len+sizeof(List))=0;
---
> 	strncpy(ATOM_buffers[i]+ATOM_buffill[i]+(int)sizeof(List),s,(unsigned int)len);
> 	*(ATOM_buffers[i]+ATOM_buffill[i]+len+(int)sizeof(List))=0;
351,353c367,369
< 	ATOM_buffill[i]+=len+1+sizeof(List);
< 	while(ATOM_buffill[i]%4) ATOM_buffill[i]++;
< 	return ret+i*0x10000+0x01000000;
---
> 	ATOM_buffill[i]+=len+1+(int)sizeof(List);
> 	while(ATOM_buffill[i]%8) ATOM_buffill[i]++;
> 	return ret+i*0x10000+(1L<<56);
491a508
> 	 WriteTerm(t);puts("");
501a519
> 	 printf("%lx %lx\n",lp,*lp);
diff -rbd micromegas/Packages/LanHEP/atoms.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/atoms.h
21c21,22
< 	OPR_RARROW, OPR_EQEQSIGN, OPR_DOLLAR, OPR_HASH;
---
> 	OPR_RARROW, OPR_EQEQSIGN, OPR_AND, OPR_OR, OPR_NOT, OPR_NOTEQ, OPR_DEFINED,
> 	OPR_DOLLAR, OPR_HASH;
28c29
<          A_GHOST, A_END, A_S_COLOR, A_COLOR_EPS, A_BRST_TRANSF, A_BRSTI_TRANSF,
---
>          A_GHOST, A_END, A_S_COLOR, A_COLOR_EPS, A_COLOR_K6, A_COLOR_L6, A_BRST_TRANSF, A_BRSTI_TRANSF,
30c31
< extern Atom PROP_TYPE,PROP_INDEX, OPR_WILD, OPR_CLASS;
---
> extern Atom PROP_TYPE,PROP_INDEX, OPR_WILD, OPR_CLASS, A_FORT_NAME;
38c39
< 		OPR_CPART;
---
> 		OPR_CPART, A_AUX;
diff -rbd micromegas/Packages/LanHEP/cls.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/cls.c
48c48
< int ProcClass(Term cl, Term ind)
---
> Term  ProcClass(Term cl, Term ind)
183c183
< 			csp=IntegerValue(CompoundArgN(p2,4));
---
> 			csp=(int)IntegerValue(CompoundArgN(p2,4));
329,330c329,330
< 		cl=IntegerValue(ListFirst(fp));
< 		no=IntegerValue(ListFirst(ListTail(fp)));
---
> 		cl=(int)IntegerValue(ListFirst(fp));
> 		no=(int)IntegerValue(ListFirst(ListTail(fp)));
425c425
< 	n=IntegerValue(CompoundArg1(cl));
---
> 	n=(int)IntegerValue(CompoundArg1(cl));
449c449,451
< 			if(GetAtomProperty(CompoundArg1(ListFirst(l1)),A_INFINITESIMAL))
---
> 			if(GetAtomProperty(CompoundArg1(ListFirst(l1)),A_INFINITESIMAL) && 
>                             !GetAtomProperty(CompoundArg1(ListFirst(l1)),PROP_TYPE)
>                         )
560c562
< 		int c=IntegerValue(ListFirst(l1))-IntegerValue(ListFirst(l2));
---
> 		int c=(int)IntegerValue(ListFirst(l1))-(int)IntegerValue(ListFirst(l2));
569c571
< 	return IntegerValue(t1)-IntegerValue(t2);
---
> 	return (int)IntegerValue(t1)-(int)IntegerValue(t2);
1187c1189
< 				int ov=IntegerValue(ListFirst(l3));
---
> 				int ov=(int)IntegerValue(ListFirst(l3));
1219c1221
< 			int k1,k2,k3,k4;
---
> 			Term k1,k2,k3,k4;
1242c1244
< 			int k1,k2,k3,k4;
---
> 			Term k1,k2,k3,k4;
1615c1617
< 			comps*=IntegerValue(ListFirst(l1));
---
> 			comps*=(int)IntegerValue(ListFirst(l1));
1722c1724
< 			int num=IntegerValue(CompoundArg1(ListFirst(l3)));
---
> 			int num=(int)IntegerValue(CompoundArg1(ListFirst(l3)));
1783c1785
< 		int n=IntegerValue(is_integer(num)?num:CompoundArg1(num));
---
> 		int n=(int)IntegerValue(is_integer(num)?num:CompoundArg1(num));
1799c1801
< 		int  w=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 		int  w=(int)IntegerValue(CompoundArg2(ListFirst(l)));
diff -rbd micromegas/Packages/LanHEP/color.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/color.c
4c4,5
< Atom ColorLambda=0, ColorF=0, ColorD=0, ColorEps=0, ColorEpsB=0;
---
> Atom ColorLambda=0, ColorF=0, ColorD=0, ColorEps=0, ColorEpsB=0, 
> 		ColorK6=0, ColorK6b=0, ColorL6=0;
33a35,41
> Term inv_color_k6(Atom s)
> {
> 	if(s!=ColorK6 && s!=ColorK6b)
> 	{
> 		puts("Internal error (cepi)");
> 		return s;
> 	}
34a43,44
> 	return s==ColorK6?ColorK6b:ColorK6;
> }
37a48
> 	char *v1, *v2;
42a54,65
> 	v1=AtomValue(a1);
> 	if(v1[1]=='8')
> 	  return 3;
> 	if(v1[1]=='3' && v1[2]==0)
> 	  return 1;
> 	if(v1[1]=='3' && v1[2]=='b')
> 	  return 2;
> 	
> 	if(v1[1]=='6' && v1[2]==0)
> 	  return 6;
> 	if(v1[1]=='6' && v1[2]=='b')
> 	  return 7;
94a118
> 	
121a146,158
> 		if(CompoundName(t)==OPR_SPECIAL && (
> 				GetAtomProperty(CompoundArg1(t),A_COLOR)==A_COLOR_K6))
> 		{
> 		  List ill=CompoundArg2(t);
> 		  Integer in1=ListFirst(ill);
> 		  Integer in2=ListFirst(ListTail(ill));
> 		  if(IntegerValue(in1)>IntegerValue(in2))
> 		  {
> 		    ChangeList(ill,in2);
> 		    ChangeList(ListTail(ill),in1);
> 		  }
> 		}
> 		
308a346,349
> 	/*printf("%s: ",AtomValue(name));
> 	WriteTerm(itc);
> 	puts("");
> 	*/
325,327c366,368
< 	t1=IntegerValue(ListFirst(itc));
< 	t2=IntegerValue(ListFirst(ListTail(itc)));
< 	t3=IntegerValue(ListFirst(ListTail(ListTail(itc))));
---
> 	t1=(int)IntegerValue(ListFirst(itc));
> 	t2=(int)IntegerValue(ListFirst(ListTail(itc)));
> 	t3=(int)IntegerValue(ListFirst(ListTail(ListTail(itc))));
384a426,440
> 	if(t1==1 && t2==1 &&  t3==7)
> 	{
> 	  ColorK6=name;
> 	  SetAtomProperty(name,A_COLOR,A_COLOR_K6);
> 	}
> 	if(t1==2 && t2==2 &&  t3==6)
> 	{
> 	  ColorK6b=name;
> 	  SetAtomProperty(name,A_COLOR,A_COLOR_K6);
> 	}
> 	if(t1==6 && t2==7 && t3==3)
> 	{
> 	  ColorL6=name;
> 	  SetAtomProperty(name,A_COLOR,A_COLOR_L6);
> 	}
diff -rbd micromegas/Packages/LanHEP/data.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/data.c
4a5,6
> #define TBSIZE 65500
> 
25a28
>   ---- new notation
26a30,35
>   1 - atoms
>   2 - functors
>   3 - floats
>   4 - compounds
>   5 - lists
>   6 - labels
31c40
< 	double d;
---
> 	struct { double d,i;} v;
60c69
< 			p[i].p.f=0x1f000000+f_blocks*0x10000+i;
---
> 			p[i].p.f=(3L<<56)+f_blocks*0x10000+i;
67c76,77
< 	p->d=d;
---
> 	p->v.d=d;
> 	p->v.i=0.0;
71a82,89
> 
> Float NewComplex(cmplx cx)
> {
>   Float f=NewFloat(0.0);
>   SetFloat(f,cx.r,cx.i);
>   return f;
> }
> 
80c98
< 	return p->d;
---
> 	return p->v.d;
82a101,131
> cmplx ComplexValue(Float f)
> {
>   cmplx ret;
>   ret.r=FloatValue(f);
>   ret.i=ImaginaryValue(f);
>   return ret;
> }
> 
> void SetFloat(Float f, double r, double i)
> {
>   union fpoint *p;
> 	int bno,bpos;
> 	bno=f&0xff0000;
> 	bno/=0x10000;
> 	bpos=f&0xffff;
> 	p=fbuffers[bno]+bpos;
> 	p->v.d=r;
> 	p->v.i=i;
> }
> 
> double ImaginaryValue(Float f)
> {
>   union fpoint *p;
> 	int bno,bpos;
> 	bno=f&0xff0000;
> 	bno/=0x10000;
> 	bpos=f&0xffff;
> 	p=fbuffers[bno]+bpos;
> 	return p->v.i;
> }
> 
88c137
< union COMPOpoint *COMPO_buffers[4096];
---
> union COMPOpoint *COMPO_buffers[400096];
90c139
< int LABEL_count = 0;
---
> long int LABEL_count = 0;
108c157
< 	i=l-1073741824;
---
> 	i=l-2223372036854775807L;
118c167
< 	return i+1073741824;
---
> 	return i+2223372036854775807L;
126c175
< 	if(arity<1 || arity >100)
---
> 	if(arity<1 || arity >250)
129c178
< 	return (name&0xffffff) + (arity+1)*0x1000000;
---
> 	return (name&0xffffff) + (((long)arity+1)<<48)+ (2L<<56);
147c196
< 	int bno,bpos;
---
> 	long int bno,bpos;
152c201
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
173c222
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
207,208c256,257
< 		int i;
< 		if(COMPO_blocks==4096)
---
> 		unsigned int i;
> 		if(COMPO_blocks==400096)
210c259
< 		i=sizeof(union COMPOpoint)*65500;
---
> 		i=sizeof(union COMPOpoint)*TBSIZE;
223c272
< 		for(i=0;i<65500;i++)
---
> 		for(i=0;i<TBSIZE;i++)
232c281
< 			p[i].p.this_a=0x20000000+cb*0x10000+i;
---
> 			p[i].p.this_a=(4L<<56)+cb*0x10000+i;
264c313
< 		if(COMPO_blocks==4096)
---
> 		if(COMPO_blocks==400096)
266c315
< 		i=sizeof(union COMPOpoint)*65500;
---
> 		i=sizeof(union COMPOpoint)*TBSIZE;
279c328
< 		for(i=0;i<65500;i++)
---
> 		for(i=0;i<TBSIZE;i++)
288c337
< 			p[i].p.this_a=0x20000000+cb*0x10000+i;
---
> 			p[i].p.this_a=(4L<<56)+cb*0x10000+i;
367c416
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
378c427,428
< 	int bno,bpos, ar;
---
> 	long int bno,bpos;
> 	int ar;
380c430
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
393c443
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
404c454
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
414,415c464,465
< 	int bno,bpos;
< 	bno=c&0xfff0000;
---
> 	long int bno,bpos;
> 	bno=c&0xfffff0000;
427c477
< 	int bno,bpos;
---
> 	long int bno,bpos;
429c479
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
445,446c495,496
< 	int bno,bpos;
< 	bno=c&0xfff0000;
---
> 	long int bno,bpos;
> 	bno=c&0xfffff0000;
510c560
< 	return (a&0xff000000)==0x1f000000;
---
> 	return TERMTYPE(a)==3;
520c570
< 	return (a&0xff000000)==0x01000000;
---
> 	return TERMTYPE(a)==1;
525,527c575
< 	int b;
< 	b=a/0x1000000;
< 	return (b>1 && b<31);
---
> 	return TERMTYPE(a)==2;
532c580
< 	return a/0x10000000 == 2;
---
> 	return TERMTYPE(a)==4;
537c585
< 	return a/0x10000000 >3 ;
---
> 	return TERMTYPE(a)==6;
543c591
< 	return ((++LABEL_count)&0x3fffffff)+0x40000000;
---
> 	return ((++LABEL_count)&0xffffffffffffff)+(6L<<56);
546c594
< __inline int   LabelValue(Atomic l)
---
> __inline long   LabelValue(Atomic l)
548c596
< 	return l-0x40000000;
---
> 	return l-(6L<<56);
555c603
< 	int bno,bpos,arity;
---
> 	long int bno,bpos,arity;
557c605
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
585c633
< 	bno=c&0xfff0000;
---
> 	bno=c&0xfffff0000;
612,614c660,661
< 	type = a&0xff000000;
< 	type = type/0x1000000;
< 	if(type==31)
---
> 	type = TERMTYPE(a);
> 	if(type==3)
628c675
< 	if(type>=32 && type<48)
---
> 	if(type==4)
633c680
< 	if(type>=48 && type<64)
---
> 	if(type==5)
646,648c693,694
< 	type = a&0xff000000;
< 	type = type/0x1000000;
< 	if(type==31)
---
> 	type = TERMTYPE(a);
> 	if(type==3)
662c708
< 	if(type>=32 && type<48)
---
> 	if(type==4)
667c713
< 	if(type>=48 && type<64)
---
> 	if(type==5)
773,774c819
< 	type = a&0xff000000;
< 	type = type/0x1000000;
---
> 	type = TERMTYPE(a);
777c822
< 	if(type==31)	/* 0xff */
---
> 	if(type==3)	/* 0xff */
779c824
< 	if(type>=32 && type<48)   /* 0xfe */
---
> 	if(type==4)   /* 0xfe */
781c826
< 	if(type>=48 && type<64)  /*  0xfd */ 
---
> 	if(type==5)  /*  0xfd */ 
783c828
< 	if(type>=64)  /*  0xfc */
---
> 	if(type==6)  /*  0xfc */
785c830
< 	if(type>1 && type<31)
---
> 	if(type==2)
799c844
< 		COMPO_blocks,COMPO_blocks*sizeof(union COMPOpoint)*64,
---
> 		COMPO_blocks,COMPO_blocks*(int)sizeof(union COMPOpoint)*64,
815c860
< 	return (long)COMPO_blocks*sizeof(union COMPOpoint)*64;
---
> 	return (long)COMPO_blocks*(long)sizeof(union COMPOpoint)*64;
826c871
< 		a=CompoundArity(t1);
---
> 		a=(int)CompoundArity(t1);
diff -rbd micromegas/Packages/LanHEP/field.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/field.c
6c6
< extern int max_prt_lenp, max_prt_lenl;
---
> extern int max_prt_lenp, max_prt_lenl, NoQuotes;
254a255,272
> 	if(is_compound(t) && strcmp(AtomValue(CompoundName(t)),"aux")==0)
> 	{
> 		Atom n1;
> 		n1=CompoundArg1(t);
> 		
> 		if(!is_atom(n1) && !is_integer(n1))
> 			{
> 			ErrorInfo(113);
> 			printf(" bad specification \'");
> 			WriteTerm(t);
> 			printf("\'.\n");
> 			return 0;
> 			}
> 		SetAtomProperty(CompoundArg2(sv),A_AUX,n1);
> 		SetCompoundArg(sv,7,n1);
> 		return 1;		
> 	}
> 	
261c279
< 			n=IntegerValue(t1);
---
> 			n=(int)IntegerValue(t1);
275,276c293,294
< 			n=IntegerValue(CompoundArg1(t1));
< 			d=IntegerValue(CompoundArg2(t1));
---
> 			n=(int)IntegerValue(CompoundArg1(t1));
> 			d=(int)IntegerValue(CompoundArg2(t1));
333c351
< 			m=ProcessAlias(m);
---
> 			
355a374,382
> 				if(UFOutput)
>                 {
>                     SetCompoundArg(m,2,NewInteger(0));
>                     if(CompoundArgN(sv,3)==0)
>                     m1=make_param(m,"width",CompoundArg1(sv));
>                     else
>                     m1=make_param(m,"width",CompoundArgN(sv,3));
>                 }
>                 else {
362c389
< 				m1=CompoundArg1(m);
---
>                     m1=CompoundArg1(m);}
845,846c872,873
< 				num=IntegerValue(CompoundArg1(prp));
< 				den=IntegerValue(CompoundArg2(prp));
---
> 				num=(int)IntegerValue(CompoundArg1(prp));
> 				den=(int)IntegerValue(CompoundArg2(prp));
1070a1098,1100
> 							char *v=AtomValue(CompoundArg1(t1));
> 							col=v[1]-'0';
> 							/*
1074a1105
> 							*/
1103c1134,1138
< 						sp=fprintf(f,"%s",AtomValue(CompoundArgN(ttt,7)));
---
> 					{
> 					  NoQuotes=1;
> 						sp=fWriteTerm(f,CompoundArgN(ttt,7));
> 					  NoQuotes=0;
> 					}
1153c1188,1191
< 						if(CompoundArgN(ttt,7)!=OPR_MLT)
---
> 						if(CompoundArgN(ttt,7)!=OPR_MLT && 
> 						      AtomValue(CompoundArgN(ttt,7))[1]!='*'
>                                                   && 
> 						      AtomValue(CompoundArgN(ttt,7))[0]!='*')
1228c1266,1268
< 				if(EqualTerms(CompoundArg1(t1),CompoundArg2(t1)))
---
> 				char *v=AtomValue(CompoundArg1(t1));
> 				col=v[1]-'0';
> 				/*if(EqualTerms(CompoundArg1(t1),CompoundArg2(t1)))
1231c1271
< 					col=3;
---
> 					col=3;*/
diff -rbd micromegas/Packages/LanHEP/fu1.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/fu1.c
6a7
> #include <sys/stat.h>
48a50,54
> 	if(is_atom(k1) && AtomValue(k1)[0]=='?')
> 	{
> 	  DumpList(current_keys);
> 	  return;
> 	}
161a168,176
> static Term key_val(Term k)
> {
> 	List l;
> 	for(l=current_keys;l;l=ListTail(l))
> 		if(CompoundArg1(ListFirst(l))==k)
> 			return CompoundArg2(ListFirst(l));
> 	return 0;
> }
> 			
165,168c180,182
< 	if(!is_compound(t) || CompoundArity(t)!=2 || 
< 			(CompoundName(t)!=OPR_EQSIGN && CompoundName(t)!=OPR_EQEQSIGN) ||
< 			 !is_atom(CompoundArg1(t)) || 
< 			(!is_atom(CompoundArg2(t)) && !is_integer(CompoundArg2(t))))
---
> 	
> 	
> 	if(!is_compound(t))
185,187c199,246
< 	for(l=current_keys;l;l=ListTail(l))
< 		if(CompoundArg1(ListFirst(l))==CompoundArg1(t))
< 			break;
---
> 	if(CompoundName(t)==OPR_EQSIGN || CompoundName(t)==OPR_EQEQSIGN
> 	  	|| CompoundName(t)==OPR_NOTEQ)
> 	{
> 		Term a1, a2, k1, k2;
> 		a1=CompoundArg1(t);
> 		a2=CompoundArg2(t);
> 		int inv=(CompoundName(t)==OPR_NOTEQ);
> 		k1=key_val(a1);
> 		k2=key_val(a2);
> 		
> 		if(k1==0)
> 		{
> 			ErrorInfo(0);
> 			printf("do_if: ");
> 			WriteTerm(a1);
> 			puts(" is not defined as key.");
> 			return 0;
> 		}
> 		/*if(k2==0)*/
> 			return inv?(k1!=a2):(k1==a2);
> 		/*if(k1==0)
> 			return inv?(k2!=a1):(k2==a1);
> 		return inv?(k1!=k2):(k1==k2);*/
> 	}
> 	
> 	if(CompoundName(t)==OPR_NOT)
> 	{
> 		int r=read_eval(CompoundArg1(t));
> 		return !r;
> 	}
> 	
> 	if(CompoundName(t)==OPR_OR)
> 	{
> 		int r1=read_eval(CompoundArg1(t)), r2=read_eval(CompoundArg2(t));
> 		return r1||r2;
> 	}
> 	
> 	if(CompoundName(t)==OPR_AND)
> 	{
> 		int r1=read_eval(CompoundArg1(t)), r2=read_eval(CompoundArg2(t));
> 		return r1&&r2;
> 	}
> 	
> 	if(CompoundName(t)==OPR_DEFINED)
> 	{
> 		Term r=key_val(CompoundArg1(t));
> 		return r!=0;
> 	}
189d247
< 	if(is_empty_list(l))
192,193c250,252
< 		printf("do_if/do_else_if: key '%s' was not defined.\n",
< 				AtomValue(CompoundArg1(t)));
---
> 		printf("illegal condition '");
> 		WriteTerm(t);
> 		printf("' in do_if/do_else_if statement.\n");
197d255
< 	return CompoundArg2(ListFirst(l))==CompoundArg2(t);
200c258
< static int read_to_endif(void)
---
> static Term read_to_endif(void)
211c269
< static int read_file(int rec, char *file)
---
> static Term read_file(int rec, char *file)
272c330
< 			int cimp;
---
> 			int cimp, resc;
293c351,355
< 			if(read_eval(CompoundArg1(a)))
---
> 			/*WarningInfo(0);printf("if "); WriteTerm(CompoundArg1(a));*/
> 			resc=read_eval(CompoundArg1(a));
> 			/*printf(" -> %d\n",resc);*/
> 			
> 			if(resc)
295c357
< 				int a1;
---
> 				Term a1;
450c512
< 		int min,sec;
---
> 		long int min,sec;
457,458c519,520
< 			printf("%d min ",min);
< 		printf("%d sec.\n",sec);
---
> 			printf("%ld min ",min);
> 		printf("%ld sec.\n",sec);
505d566
< 
515,516c576,577
< 			ModelNumber=5;
< 		return 0;
---
> 			ModelNumber=1;
> 		goto outdir;
524c585
< 			ModelNumber=IntegerValue(CompoundArg2(arg));
---
> 			ModelNumber=(int)IntegerValue(CompoundArg2(arg));
526c587
< 			return 0;
---
> 			goto outdir;
527a589,590
> 	
>     
531a595,616
> 	outdir:
> 	if(UFOutput && OutputDirectory==0)
>         {
>             OutputDirectory=malloc(1000);
>             strcpy(OutputDirectory,ModelName);
>             for(int i=0;i<1000&&OutputDirectory[i];i++)
>             {
>                 if(OutputDirectory[i]=='(' || OutputDirectory[i]==')' ||
>                     OutputDirectory[i]==' ' || OutputDirectory[i]==',')
>                     OutputDirectory[i]='_';
>             }
>             if(access(OutputDirectory,F_OK))
>             {
>                 if(mkdir(OutputDirectory,0777))
>                 {
>                     perror(OutputDirectory);
>                     OutputDirectory=0;
>                 }
>                 else printf("Folder %s is created.\n",OutputDirectory);
>             }
>         }
>     return 0;
785c870
< extern List abbr_coeffs;
---
> extern List abbr_coeffs, no_abbr_coeffs;
851c936
< 		 opUndefAngleComb=IntegerValue(val);
---
> 		 opUndefAngleComb=(int)IntegerValue(val);
864c949
< 		 opTriHeu=IntegerValue(val);
---
> 		 opTriHeu=(int)IntegerValue(val);
876c961
< 		 LagrHashSize=IntegerValue(val);
---
> 		 LagrHashSize=(int)IntegerValue(val);
889c974
< 		 opBreakLines=IntegerValue(val);
---
> 		 opBreakLines=(int)IntegerValue(val);
902c987
< 		 opSortLagr=IntegerValue(val);
---
> 		 opSortLagr=(int)IntegerValue(val);
915c1000
< 		 opDoSymmetrize=IntegerValue(val);
---
> 		 opDoSymmetrize=(int)IntegerValue(val);
928c1013
< 		 opAutoWidths=IntegerValue(val);
---
> 		 opAutoWidths=(int)IntegerValue(val);
941c1026
< 		 opOnlyMass=IntegerValue(val);
---
> 		 opOnlyMass=(int)IntegerValue(val);
954c1039
< 		 opRemDotWithFerm=IntegerValue(val);
---
> 		 opRemDotWithFerm=(int)IntegerValue(val);
967c1052
< 		 write_all_vertices=IntegerValue(val);
---
> 		 write_all_vertices=(int)IntegerValue(val);
979c1064
< 		 opMaxiLegs=IntegerValue(val);
---
> 		 opMaxiLegs=(int)IntegerValue(val);
992c1077
< 		 MultByI=IntegerValue(val);
---
> 		 MultByI=(int)IntegerValue(val);
1005c1090
< 		 opReduceG5=IntegerValue(val);
---
> 		 opReduceG5=(int)IntegerValue(val);
1018c1103
< 		 opSetGpm=IntegerValue(val);
---
> 		 opSetGpm=(int)IntegerValue(val);
1030c1115
< 		 C_F_WIDTH=IntegerValue(val);
---
> 		 C_F_WIDTH=(int)IntegerValue(val);
1042c1127
< 		 L_P_WIDTH=IntegerValue(val);
---
> 		 L_P_WIDTH=(int)IntegerValue(val);
1054c1139
< 		 P_D_WIDTH=IntegerValue(val);
---
> 		 P_D_WIDTH=(int)IntegerValue(val);
1114c1199
< 		 opSplitCol1=IntegerValue(val);
---
> 		 opSplitCol1=(int)IntegerValue(val);
1126c1211
< 		 opSplitCol2=IntegerValue(val);
---
> 		 opSplitCol2=(int)IntegerValue(val);
1138c1223
< 		 WriteColors=IntegerValue(val);
---
> 		 WriteColors=(int)IntegerValue(val);
1150c1235
< 	     infi_order=IntegerValue(val);
---
> 	     infi_order=(int)IntegerValue(val);
1162c1247
< 	     block_transf=IntegerValue(val);
---
> 	     block_transf=(int)IntegerValue(val);
1174c1259
< 		 opNeutrC8=IntegerValue(val);
---
> 		 opNeutrC8=(int)IntegerValue(val);
1185c1270
< 		 opclsreal=IntegerValue(val);
---
> 		 opclsreal=(int)IntegerValue(val);
1196c1281
< 		 opclsred=IntegerValue(val);
---
> 		 opclsred=(int)IntegerValue(val);
1207c1292
< 		 oprcmatr=IntegerValue(val);
---
> 		 oprcmatr=(int)IntegerValue(val);
1225a1311,1326
> 	if(strcmp(s,"NoAbbrCoeff")==0)
> 	 {
> 		 if(val==NewInteger(0))
> 		 {
> 			 no_abbr_coeffs=0;
> 			 return 0;
> 		 }
> 		 if(is_list(val))
> 		 {
> 			 no_abbr_coeffs=val;
> 			 return 0;
> 		 }
> 		 ErrorInfo(415);
> 		 puts("wrong value for 'AbbrCoeff' option.");
> 		 return 0;
> 	 }  
diff -rbd micromegas/Packages/LanHEP/fu2.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/fu2.c
80a81,82
>         if(!is_compound(prp)) return 0;
>         
102a105,106
>          if(!is_compound(prp)) return 0;
>          
313c317
< 
---
> /*
469a474
> */
566a572,575
> 	ErrorInfo(0);
> 	puts("Argument of cc() function must be a fermion.\n");
> 	return 0;
> 	/*
605c614
< 	
---
> 	*/
diff -rbd micromegas/Packages/LanHEP/func.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/func.c
193c193
< 	i=IntegerValue(CompoundArg1(prop));
---
> 	i=(int)IntegerValue(CompoundArg1(prop));
diff -rbd micromegas/Packages/LanHEP/group.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/group.c
46c46
< 	N=IntegerValue(ar);
---
> 	N=(int)IntegerValue(ar);
diff -rbd micromegas/Packages/LanHEP/herm.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/herm.c
65,66c65,66
< 		i1=IntegerValue(CompoundArg1(t1));
< 		i2=IntegerValue(CompoundArg1(t2));
---
> 		i1=(int)IntegerValue(CompoundArg1(t1));
> 		i2=(int)IntegerValue(CompoundArg1(t2));
310c310
< 				num=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
---
> 				num=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
482c482
< 			n=IntegerValue(CompoundArg1(CompoundArg1(m2)));
---
> 			n=(int)IntegerValue(CompoundArg1(CompoundArg1(m2)));
597c597
< 			num=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
---
> 			num=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
623c623
< 		num=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
---
> 		num=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l))));
638a639
> Atom inv_color_k6(Atom);
640c641
< static void fix_color_f(List ml)
---
> static void fix_color_f(List ml, List prts)
642a644,659
> 	int spcase=0;
> 	int hasceps=0;
> 	if(ListLength(prts)>2)
> 	{
> 	  Atom p1=CompoundArg1(ListFirst(prts));
> 	  Atom p2=CompoundArg1(ListFirst(ListTail(prts)));
> 	  Term prp=GetAtomProperty(p1,PROP_TYPE);
> 	  if(prp && is_compound(prp) && CompoundName(prp)==OPR_FIELD
> 	    && CompoundArg2(prp)==NewInteger(4) && CompoundArg1(prp)==p2)
> 	    spcase=1;
> 	  prp=GetAtomProperty(p2,PROP_TYPE);
> 	  if(prp && is_compound(prp) && CompoundName(prp)==OPR_FIELD
> 	    && CompoundArg2(prp)==NewInteger(4) && CompoundArg1(prp)==p1)
> 	    spcase=1;
> 	}
> 	
693a711
> 		Term prp;
696c714,717
< 				GetAtomProperty(CompoundArg1(ListFirst(l1)),A_COLOR)==A_COLOR_EPS)
---
> 				(prp=GetAtomProperty(CompoundArg1(ListFirst(l1)),A_COLOR)))
> 			{
> 			  if(prp==A_COLOR_EPS)
> 			  {
699c720,732
< 		
---
> 				hasceps=1;
> 			  }
> 			 if(prp==A_COLOR_K6)
> 					SetCompoundArg(ListFirst(l1),1,
> 						inv_color_k6(CompoundArg1(ListFirst(l1))));
> 			}
> 		if(hasceps && spcase) 
> 		{
> 		  Term rt=ConsumeCompoundArg(ListFirst(l),1);
> 		  Integer num=CompoundArg1(rt);
> 		  SetCompoundArg(rt,1,NewInteger(-IntegerValue(num)));
> 		  SetCompoundArg(ListFirst(l),1,rt);
> 		}
739,740c772,773
< 		n=IntegerValue(CompoundArg1(CompoundArg1(m2)));
< 		d=IntegerValue(CompoundArg2(CompoundArg1(m2)));
---
> 		n=(int)IntegerValue(CompoundArg1(CompoundArg1(m2)));
> 		d=(int)IntegerValue(CompoundArg2(CompoundArg1(m2)));
745c778
< 		n=IntegerValue(CompoundArg1(m2));
---
> 		n=(int)IntegerValue(CompoundArg1(m2));
754c787
< 		p=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 		p=(int)IntegerValue(CompoundArg2(ListFirst(l)));
767d799
< 
771a804,817
> 	
> 	for(l1=CompoundArgN(a2cf,5);l1;l1=ListTail(l1))
> 	{
> 		o=ConsumeCompoundArg(ListFirst(l1),2);
> 		if(o) o=SortedList(o,prmcmp);
> 		SetCompoundArg(ListFirst(l1),2,o);
> 	}
> 	for(l1=CompoundArgN(a2cg,5);l1;l1=ListTail(l1))
> 	{
> 		o=ConsumeCompoundArg(ListFirst(l1),2);
> 		if(o) o=SortedList(o,prmcmp);
> 		SetCompoundArg(ListFirst(l1),2,o);
> 	}
> 	
825c871
< 
---
> /*
829c875
< 
---
> */
847c893
< 		wrt_mono(ListNth(CompoundArgN(a2cf,5),IntegerValue(ListFirst(l1))));
---
> 		wrt_mono(ListNth(CompoundArgN(a2cf,5),(int)IntegerValue(ListFirst(l1))));
973,974c1019,1023
< 				if(CompoundName(pr)==OPR_PARTICLE && 
< 						CompoundArgN(pr,7) == OPR_MLT)
---
> 				if(CompoundName(pr)==OPR_PARTICLE)
>                                 { 
>                                         Atom prp=CompoundArgN(pr,7);
>                                         if(is_atom(prp) && (AtomValue(prp)[0]=='*'
>                                             || AtomValue(prp)[1]=='*'))
975a1025
>                                 }
1024c1074
< 			fix_color_f(CompoundArgN(a2c,5));
---
> 			fix_color_f(CompoundArgN(a2c,5),CompoundArg1(a2c));
1120c1170
< 			fix_color_f(CompoundArgN(a2c,5));
---
> 			fix_color_f(CompoundArgN(a2c,5),CompoundArg1(a2c));
diff -rbd micromegas/Packages/LanHEP/imprt.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/imprt.c
125a126
> static int imppdg=100500;
131a133
> 	int hc_corr=0;
132a135,151
> 	if(ListLength(hint)==4)
> 	{
> 	  Atom nms[4];
> 	  Term prp;
> 	  int i;
> 	  nms[0]=CompoundArg1(ListFirst(hint));
> 	  nms[1]=CompoundArg1(ListNth(hint,2));
> 	  nms[2]=CompoundArg1(ListNth(hint,3));
> 	  nms[3]=CompoundArg1(ListNth(hint,4));
> 	  for(i=0;i<4;i++)
> 	  if((prp=GetAtomProperty(nms[i],PROP_TYPE)) && CompoundName(prp)==OPR_FIELD
> 	    && CompoundArg2(prp)==NewInteger(4))
> 	      nms[i]=CompoundArg1(prp);
> 	  if((nms[0]==GetAtomProperty(nms[2],A_ANTI) || nms[0]==GetAtomProperty(nms[3],A_ANTI)) &&
> 	      (nms[1]==GetAtomProperty(nms[2],A_ANTI) || nms[1]==GetAtomProperty(nms[3],A_ANTI)))
> 	    hc_corr=1;
> 	}
170a190
> 		SetAtomProperty(n,NewAtom("_pdg",0),NewInteger(imppdg++));
180a201,204
> 		{
> 		  if(CalcOutput && !hc_corr)
> 		    SetCompoundArg(prt,7,NewAtom("!*",0));
> 		  else
181a206
> 		}
187c212,214
< 			if(col==3)
---
> 			if(col==6)
> 				cl=MakeCompound2(A_COLOR,NewAtom("c6",0),NewAtom("c6b",0));
> 			else if(col==3)
264,266c291,293
< 	spin=IntegerValue(CompoundArg1(t));
< 	col= IntegerValue(CompoundArg2(t));
< 	anti=IntegerValue(CompoundArgN(t,3));
---
> 	spin=(int)IntegerValue(CompoundArg1(t));
> 	col= (int)IntegerValue(CompoundArg2(t));
> 	anti=(int)IntegerValue(CompoundArgN(t,3));
282a310
> 		SetAtomProperty(n,NewAtom("_pdg",0),NewInteger(imppdg++));
291,292c319,320
< 		if(spin<2 || CalcOutput)
< 			SetCompoundArg(prt,7,OPR_MLT);
---
> 		if(spin<2 || CalcOutput || UFOutput)
> 			SetCompoundArg(prt,7,anti>0?OPR_MLT:NewAtom("!*",0));
diff -rbd micromegas/Packages/LanHEP/lagr.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/lagr.c
26c26
< int LagrHashSize=1713;
---
> unsigned int LagrHashSize=1713;
128d127
< 	t1=ProcessAlias(t1);
233c232
< 	alg2_hash_add(lagr_hash,LagrHashSize,t1);
---
> 	alg2_hash_add(lagr_hash,(int)LagrHashSize,t1);
274a274,276
> #include <dirent.h>
> extern char *InputDirectory;
> 
279c281,282
< 	
---
> 	if(OutputDirectory)
> 		printf("Writing files to the folder %s\n",OutputDirectory); 
341c344,372
< 	printf("\nStatic files for UFO model can be found in mdl/ufo-static/ of LanHEP source direcory\n\n");
---
> 	{
> 	printf("\nCopying static files...\n");
> 	char cbuf[1000];
> 	sprintf(cbuf,"%s/ufo-static",InputDirectory);
> 	DIR *ufo=opendir(cbuf);
> 	if(ufo==0) printf("Error: can not find UFO static files\n");
> 	else
> 	{
> 		struct dirent *dp;
> 		while((dp=readdir(ufo))!=NULL)
> 		{
> 			if(dp->d_type==8)
> 			{
> 				char ibuf[1000], obuf[1000];
> 				char buf[100];
> 				unsigned long int brd;
> 				FILE *fi, *fo;
> 				sprintf(ibuf,"%s/ufo-static/%s",InputDirectory,dp->d_name);
> 				sprintf(obuf,"%s/%s",OutputDirectory?OutputDirectory:".",dp->d_name);
> 				fi=fopen(ibuf,"rb"); if(fi==0) continue;
> 				fo=fopen(obuf,"wb"); if(fo==0) {fclose(fi); continue;}
> 				while((brd=fread(buf,1,100,fi))!=0) fwrite(buf,1,brd,fo);
> 				fclose(fi);
> 				fclose(fo);
> 			}
> 		}
> 		closedir(ufo);
> 	}
> 	}
560c591
< 		cf=IntegerValue(CompoundArg1(m2));
---
> 		cf=(int)IntegerValue(CompoundArg1(m2));
589c620
< 			po=IntegerValue(CompoundArg2(ListFirst(lp)));
---
> 			po=(int)IntegerValue(CompoundArg2(ListFirst(lp)));
608c639
< 	cf=IntegerValue(CompoundArg1(ListFirst(ml)));
---
> 	cf=(int)IntegerValue(CompoundArg1(ListFirst(ml)));
612c643
< 		cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 		cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
709,710c740,741
< 		i1=IntegerValue(CompoundArg2(ListFirst(l1)));
< 		i2=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 		i1=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
> 		i2=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
752c783
< 				prior=IntegerValue(pp);
---
> 				prior=(int)IntegerValue(pp);
835c866
< 		c_n_f=IntegerValue(CompoundArgN(ListFirst(l1),3));
---
> 		c_n_f=(int)IntegerValue(CompoundArgN(ListFirst(l1),3));
867c898
< 				c_n_f=IntegerValue(CompoundArgN(ListFirst(i2),3));
---
> 				c_n_f=(int)IntegerValue(CompoundArgN(ListFirst(i2),3));
977,978c1008,1009
< 	num=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 	den=IntegerValue(CompoundArg2(CompoundArg2(a2)));
---
> 	num=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 	den=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
1011c1042
< 			po=IntegerValue(CompoundArg2(ListFirst(s)));
---
> 			po=(int)IntegerValue(CompoundArg2(ListFirst(s)));
1039c1070
< 				po=-IntegerValue(CompoundArg2(ListFirst(s)));
---
> 				po=-(int)IntegerValue(CompoundArg2(ListFirst(s)));
1113c1144
< 		C_F_WIDTH=IntegerValue(prp);
---
> 		C_F_WIDTH=(int)IntegerValue(prp);
1653c1684
< 				(ll_2-ll_1*ll_1/LagrHashSize)/LagrHashSize, ll_m);
---
> 				(ll_2-ll_1*ll_1/(int)LagrHashSize)/(int)LagrHashSize, ll_m);
1809c1840
< 			alg2_hash_add(lagr_hash,LagrHashSize,AppendLast(NewList(),a21));
---
> 			alg2_hash_add(lagr_hash,(int)LagrHashSize,AppendLast(NewList(),a21));
diff -rbd micromegas/Packages/LanHEP/lanhep.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/lanhep.h
28a29
> cmplx cEvalParameter(Term);
176c177
< int gcf(int, int);
---
> long int gcf(long int, long int);
257c258
< int defined_em_charge(void);
---
> Atom defined_em_charge(void);
301c302
< extern int  TexOutput, FAOutput, CalcOutput, CompOutput;
---
> extern int  TexOutput, FAOutput, UFOutput, CalcOutput, CompOutput;
diff -rbd micromegas/Packages/LanHEP/let.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/let.c
10c10
< static void c_mlt(int n1, int d1, int n2, int d2, int *n, int *d)
---
> static void c_mlt(long int n1, long int d1, long int n2, long int d2, long int *n, long int *d)
75c75
< 				ino+=IntegerValue(CompoundArg1(prp));
---
> 				ino+=(int)IntegerValue(CompoundArg1(prp));
98c98
< 		int n, ns, d, ds;
---
> 		long int n, ns, d, ds;
127c127
< 			int n,d,n1,d1;
---
> 			long int n,d,n1,d1;
145c145
< 				int n,d;
---
> 				long int n,d;
222d221
< 	
229d227
< 	t1=ProcessAlias(t1);
300a299
> 	
315c314,315
< 	
---
> 	if(sub==0)
> 		return 0;
568c568
< 		int n,d,g;
---
> 		long int n,d,g;
705,707c705,707
< 				int n1=IntegerValue(CompoundArg1(om1));
< 				int d1=IntegerValue(CompoundArg2(om1));
< 				int rn,rd,cc=0;
---
> 				long int n1=IntegerValue(CompoundArg1(om1));
> 				long int d1=IntegerValue(CompoundArg2(om1));
> 				long int rn,rd,cc=0;
diff -rbd micromegas/Packages/LanHEP/lexic.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/lexic.c
202c202
< 	len=strlen(cbuf);
---
> 	len=(int)strlen(cbuf);
439a440
> 			
diff -rbd micromegas/Packages/LanHEP/lists.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/lists.c
3a4,5
> #define TBSIZE 65500
> 
16c18
< union LISTpoint *LISTS_buffers[4096];
---
> union LISTpoint *LISTS_buffers[400096];
105c107
< 		if(LISTS_blocks==4096)
---
> 		if(LISTS_blocks==400096)
107c109
< 		i=sizeof(union LISTpoint)*65500;
---
> 		i=sizeof(union LISTpoint)*TBSIZE;
112c114
< 		p=LISTS_buffers[LISTS_blocks]=(union LISTpoint*)malloc(i);
---
> 		p=LISTS_buffers[LISTS_blocks]=(union LISTpoint*)malloc((unsigned)i);
121c123
< 		for(i=0;i<65500;i++)
---
> 		for(i=0;i<TBSIZE;i++)
130c132
< 			p[i].p.l=0x30000000+lb*0x10000+i;
---
> 			p[i].p.l=(5L<<56)+lb*0x10000+i;
164c166
< 		if(LISTS_blocks==4096)
---
> 		if(LISTS_blocks==400096)
166c168
< 		i=sizeof(union LISTpoint)*65500;
---
> 		i=sizeof(union LISTpoint)*TBSIZE;
180c182
< 		for(i=0;i<65500;i++)
---
> 		for(i=0;i<TBSIZE;i++)
189c191
< 			p[i].p.l=0x30000000+lb*0x10000+i;
---
> 			p[i].p.l=(5L<<56)+lb*0x10000+i;
317c319
< 	return a/0x10000000 == 3;
---
> 	return TERMTYPE(a) == 5;
563c565
< 		LISTS_blocks,LISTS_blocks*sizeof(union LISTpoint)*64,
---
> 		LISTS_blocks,LISTS_blocks*(int)sizeof(union LISTpoint)*64,
569c571
< 	return (long)LISTS_blocks*sizeof(union LISTpoint)*64;
---
> 	return (long)LISTS_blocks*(long)sizeof(union LISTpoint)*64;
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: lists.ci
diff -rbd micromegas/Packages/LanHEP/main.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/main.c
6a7
> #include <sys/stat.h>
69c70
< extern int opSplitCol1, opSplitCol2, opEvalVrt;
---
> extern int opSplitCol1, opSplitCol2, opEvalVrt, opNo4Scal;
77a79
> extern List ufo_params_nolha;
165c167
< 		tm_lt*d, tm_12*d, tm_sl*d, tm_sw*d, tm_a2*d, tm_add*d);
---
> 		(double)tm_lt*d, (double)tm_12*d, (double)tm_sl*d, (double)tm_sw*d, (double)tm_a2*d, (double)tm_add*d);
167c169
< 	printf("       RedL %.2f Wrt %.2f\n",tm_rl*d, tm_wr*d);
---
> 	printf("       RedL %.2f Wrt %.2f\n",(double)tm_rl*d, (double)tm_wr*d);
201c203
< 	if(!is_compound(t) || (CompoundName(t)!=OPR_ALIAS  && 
---
> 	if(!is_compound(t) || (CompoundName(t)!=OPR_ALIAS  && CompoundName(t)!=OPR_UNALIAS &&
272c274
<     	char sment[1024];
---
>     	char sment[100024];
354a357
> 			opRemDotWithFerm=0;
392c395,396
< 	if(sizeof(Term)!=4)
---
> 	
> 	if(sizeof(Term)!=8)
397a402,423
> 	/*{
> 		Atom a=NewAtom("test",0), b=NewAtom("hoho",0), c=NewAtom("oooh",0);
> 		printf("%lx\n",a);
> 		Term t=MakeCompound1(a,NewInteger(1));
> 		Term t2=MakeCompound2(b,CopyTerm(t),c);
> //		printf("%lx %lx\n",a,t);
> 		WriteTerm(t2);puts("");
> 		List l=MakeList2(t,t2);
> 		DumpList(l);
> 		l=AppendLast(l,a);
> 		l=AppendLast(l,b);
> 		DumpList(l);
> 		SetAtomProperty(a,b,l);
> 		
> 		while(!is_empty_list(l))
> 		{
> 			printf("%lx %lx\n",l,ListTail(l));
> 			l=ListTail(l);
> 		}
> 	//	return 0;
> 	}*/
> 		
496a523,531
> 			if(access(OutputDirectory,F_OK))
>             {
>                 if(mkdir(OutputDirectory,0777))
>                 {
>                     perror(OutputDirectory);
>                     OutputDirectory=0;
>                 }
>                 else printf("Folder %s is created.\n",OutputDirectory);
>             }
582a618,622
> 		if(strcmp(argv[i],"-no4scal")==0)
> 			{
>             opNo4Scal=1;
> 			continue;
>             }
673c713
< 			int sec;
---
> 			unsigned int sec;
709,710c749,750
< 		if(FAOutput)
< 			opMaxiLegs=4;
---
> 		if(UFOutput)
> 			opMaxiLegs=6;
770c810
< 		printf("Welcome to LanHEP                                Version 3.1.9  (Nov 27 2013)\n");
---
> 		printf("Welcome to LanHEP                                Version 4.0.0  (Jan 16 2020)\n");
871a912,919
> 
> 
> 	if(UFOutput && ufo_params_nolha)
> 	{
> 	  printf("Warning: LHA block/index info is not provided for external parameters: ");
> 	  WriteTerm(ufo_params_nolha);
> 	  printf(".\nUse lha statements to set LHA data:\n\tlha parameter_name=block_name(index).\n\n");
> 	}
876c924
< 			(ListMemory()+TermMemory())*0.001);
---
> 			(double)(ListMemory()+TermMemory())*0.001);
878c926
< 		/*AtomStatistics();
---
> 		AtomStatistics();
879a928
> 	/*
diff -rbd micromegas/Packages/LanHEP/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/Makefile
1c1
< LOPT = -O2
---
> LOPT = 
Only in micromegas/Packages/LanHEP: manuals
diff -rbd micromegas/Packages/LanHEP/mass.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mass.c
43c43
< 	spi=IntegerValue(CompoundArgN(prop,4));
---
> 	spi=(int)IntegerValue(CompoundArgN(prop,4));
174c174
< 				pw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 				pw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
199a200
> /*
290a292,372
> */
> 
> static void wrt_num(FILE *f, List ml, int spi)
> 	{
> 	List gl;
> 	List l;
> 	gl=NewList();
> 	for(l=ml;l;l=ListTail(l))
> 		{
> 		Term sp;
> 		if(is_empty_list(CompoundArgN(ListFirst(l),3)))
> 			sp=0;
> 		else
> 			sp=CompoundArg1(ListFirst(CompoundArgN(ListFirst(l),3)));
> 		if(!ListMember(gl,sp))
> 			gl=AppendLast(gl,sp);
> 		}
> 	
> 	for(l=gl;l;l=ListTail(l))
> 		{
> 		List l1;
> 		cmplx vc;
> 		vc.r=0.0;
> 		vc.i=0.0;
> 		
> 		for(l1=ml;l1;l1=ListTail(l1))
> 			{
> 			Term sp;
> 			double v1;
> 			List l2;
> 			cmplx vv;
> 			vv.r=vv.i=0.0;
> 
> 			if(is_empty_list(CompoundArgN(ListFirst(l1),3)))
> 				sp=0;
> 			else
> 				sp=CompoundArg1(ListFirst(CompoundArgN(ListFirst(l1),3)));
> 			if(ListFirst(l)!=sp)
> 				continue;
> 			v1=(double)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
> 			v1/=(double)IntegerValue(CompoundArg2(CompoundArg1(ListFirst(l1))));
> 			if(CompoundArg2(ListFirst(l1)))
> 				{
> 				double vvr;
> 				vv=cEvalParameter(CompoundArg2(ListFirst(l1)));
> 				vvr=EvalParameter(CompoundArg2(ListFirst(l1)));
> 				vc.r+=v1*vv.r;
> 				vc.i+=v1*vv.i;
> 				}
> 			else
> 				vc.r+=v1;
> 			}
> 		if(vc.r!=0.0 && vc.i!=0.0)
> 			{
> 			if(spi==1)
> 				fprintf(f,"(%+f%+f*i)",vc.r,vc.i);
> 			else
> 				fprintf(f,"(%+f**2%+f**2*i)",mysqrt(vc.r),mysqrt(vc.i));
> 			}
> 		else
> 			{
> 			if(vc.r!=0.0)
> 			{
> 				if(spi==1)
> 					fprintf(f,"%+f",vc.r);
> 				else
> 					fprintf(f,"%+f**2",mysqrt(vc.r));
> 			}
> 			else
> 				fprintf(f,"%+f*i",vc.i);
> 			}
> 		if(ListFirst(l) && ListFirst(l)!=A_DELTA)
> 			{
> 			if(is_atom(ListFirst(l)))
> 				fprintf(f,"*%s",AtomValue(ListFirst(l)));
> 			else
> 				fprintf(f,"*p%ld",IntegerValue(ListFirst(l)));
> 			}
> 		}
> 	FreeAtomic(gl);
> 	}
425d506
< /*	WriteTerm(lm); puts("");*/
437,438c518,519
< 				n=IntegerValue(CompoundArg1(CompoundArg1(m4)));
< 				d=IntegerValue(CompoundArg2(CompoundArg1(m4)));
---
> 				n=(int)IntegerValue(CompoundArg1(CompoundArg1(m4)));
> 				d=(int)IntegerValue(CompoundArg2(CompoundArg1(m4)));
449c530
< 				g=gcf(n,d);
---
> 				g=(int)gcf(n,d);
455a537
> 	
477c559,561
< 			if(EqualTerms(j1,j2))
---
> 			if(j1 && EqualTerms(j1,j2) && 
>                             EqualTerms(CompoundArg2(ListFirst(lm)),
>                                 CompoundArg2(ListFirst(ListTail(lm)))))
484,485c568,569
< 				n=IntegerValue(CompoundArg1(CompoundArg1(m4)));
< 				d=IntegerValue(CompoundArg2(CompoundArg1(m4)));
---
> 				n=(int)IntegerValue(CompoundArg1(CompoundArg1(m4)));
> 				d=(int)IntegerValue(CompoundArg2(CompoundArg1(m4)));
487c571
< 				g=gcf(n,d);
---
> 				g=(int)gcf(n,d);
493a578
> 	/*DumpList(lm); puts("");*/
796c881
< 				n=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
---
> 				n=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
804c889
< 				n=IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
---
> 				n=(int)IntegerValue(CompoundArg1(CompoundArg1(ListFirst(l1))));
1185c1270,1271
< 		
---
>         if(ftell(outf)==0)
>             fprintf(outf,"No problems were found.\n");
1225c1311
< 		ti=IntegerValue(CompoundArgN(prop,5-fixel));
---
> 		ti=(int)IntegerValue(CompoundArgN(prop,5-fixel));
1231c1317
< 			tj=IntegerValue(CompoundArgN(prop,5-fixel));
---
> 			tj=(int)IntegerValue(CompoundArgN(prop,5-fixel));
1269c1355
< 			int n,d,n1,d1,n2,d2,cf;
---
> 			long int n,d,n1,d1,n2,d2,cf;
1289c1375
< 		int n,d,cf;
---
> 		long int n,d,cf;
1352,1353c1438,1439
< 		ti=IntegerValue(CompoundArgN(prop,5-fixel));
< 		tj=IntegerValue(CompoundArgN(prop2,5-fixel));
---
> 		ti=(int)IntegerValue(CompoundArgN(prop,5-fixel));
> 		tj=(int)IntegerValue(CompoundArgN(prop2,5-fixel));
1383c1469
< 			int n,d,n1,d1,n2,d2,cf;
---
> 			long int n,d,n1,d1,n2,d2,cf;
1455c1541
< 					macoe+=IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 					macoe+=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
1460c1546
< 					macoe2+=IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 					macoe2+=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
1466c1552
< 					macoe+=IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 					macoe+=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
1472c1558
< 					macoe2+=IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 					macoe2+=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
1580c1666
< 					prtp[i]=IntegerValue(ListFirst(e1used));
---
> 					prtp[i]=(int)IntegerValue(ListFirst(e1used));
1586c1672
< 					prtp[i]=IntegerValue(ListFirst(e2used));
---
> 					prtp[i]=(int)IntegerValue(ListFirst(e2used));
1739c1825
< 					prtp[i]=IntegerValue(ListFirst(e1used));
---
> 					prtp[i]=(int)IntegerValue(ListFirst(e1used));
1745c1831
< 					prtp[i]=IntegerValue(ListFirst(e2used));
---
> 					prtp[i]=(int)IntegerValue(ListFirst(e2used));
diff -rbd micromegas/Packages/LanHEP/mdl/calchep.rc /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl/calchep.rc
3,5c3
< external_func(creal,1).
< external_func(cimag,1).		   
< external_func(cabs,1).		   
---
> keys OutputFormat=CalcHEP.
14,15c12,13
<                 ne=12, n1=12, nm=14, n2=14, nl=16, n3=16,
<                 e=11, e1=11, m=13, e2=13, l=15, e3=15,
---
>                 ne=12, nm=14, nl=16,
>                 e=11, m=13, l=15,
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: feynarts.rc
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: qcd.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: qeddip.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: qed.mdl
diff -rbd micromegas/Packages/LanHEP/mdl/lhep.rc /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl/lhep.rc
53a54,57
> prtcproperty pdg.
> external_func(creal,1).
> external_func(cimag,1).		   
> external_func(cabs,1).		   
55c59
< do_if FeynArts==1.
---
> do_if FeynArts==1 && UFO!=1.
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: newsm.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: slhaplus.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: sm_brst.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: smnlg.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: smren.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: stand.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: stand_ufo.lhep
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: uedqed.mdl
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: ufo.rc
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/mdl: ufo-static
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: minsusy
diff -rbd micromegas/Packages/LanHEP/ops.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/ops.c
61c61
< 			*prior=IntegerValue(CompoundArgN(c,3));
---
> 			*prior=(int)IntegerValue(CompoundArgN(c,3));
diff -rbd micromegas/Packages/LanHEP/params.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/params.c
8a9,10
> int has_cmplx_params=0;
> 
54a57,218
> static void check_fortr(Atom p)
> {
>   char cbuf[64];
>   int i;
>   static int cnt=0;
>   Atom fn, prp;
>   strcpy(cbuf,AtomValue(p));
>   
>   for(i=0; cbuf[i]&&i<64; i++)
> 	cbuf[i]=(char)tolower(cbuf[i]);
>   fn=NewAtom(cbuf,0);
>   prp=GetAtomProperty(fn,A_FORT_NAME);
>   if(prp==0)
>   {
> 	SetAtomProperty(fn,A_FORT_NAME,p);
> 	return;
>   }
>   if(prp==p)
> 	return;
>   cnt++;
>   if(cnt==5) puts("More parameters which are equivalent in FORTRAN follow.");
>   if(cnt>4) return;
>   if(FAOutput)
> 	ErrorInfo(0);
>   else
> 	WarningInfo(0);
>   
>   printf("parameters %s and %s are equivalent in FORTRAN\n",
> 		 AtomValue(p),AtomValue(prp));
> }
> 
> int ufo_gg_injected=0;
> 
> static void proc_ufo_ext(Term t)
> {
>     static Atom sl, sl1=0, sl2=0, ec, eb, et, rc, rb, rt, aq;
>     if(sl1==0) 
>     {
>         sl=NewAtom("slhaVal",0);
>         sl1=NewAtom("slhaVal1",0);
>         sl2=NewAtom("slhaVal2",0);
>         ec=NewAtom("McEff",0);
>         eb=NewAtom("MbEff",0);
>         et=NewAtom("MtEff",0);
>         rc=NewAtom("McRun",0);
>         rb=NewAtom("MbRun",0);
>         rt=NewAtom("MtRun",0);
>         aq=NewAtom("alphaQCD",0);
>     }
>    // DisplayTerm(t);puts("");
>     if(is_list(t))
>     {
>         List l;
>         for(l=t;l;l=ListTail(l)) proc_ufo_ext(ListFirst(l));
>         return;
>     }
>     if(is_compound(t) && CompoundName(t)==OPR_EQSIGN)
>     {
>        int hasc=is_compound(CompoundArg2(t)) &&
>             CompoundName(CompoundArg2(t))==OPR_COLON;
>         Term rp=hasc?CompoundArg1(CompoundArg2(t)):CompoundArg2(t);
>         if(CompoundArg1(t)==A_GG)
>         {
>             Atom tn=NewAtom("aS",0);
>             SetAtomProperty(tn,PROP_TYPE,OPR_PARAMETER);
>             SetAtomProperty(tn,A_LHA,
>                 MakeCompound1(NewAtom("SMINPUTS",0),MakeList1(NewInteger(3))));
>             Term t1=MakeCompound3(tn,NewFloat(0.118),0,0);
>             params=AppendLast(params,t1);
>             t1=MakeCompound2(OPR_MLT,MakeCompound1(NewAtom("cmath.acos",0),NewInteger(-1)),tn);
>             t1=MakeCompound1(NewAtom("cmath.sqrt",0),t1);
>             t1=MakeCompound2(OPR_MLT,NewInteger(2),t1);
>             if(hasc) SetCompoundArg(CompoundArg2(t),1,t1);
>             else SetCompoundArg(t,2,t1);
>             ufo_gg_injected=1;
>             printf("GG the strong coupling is automatically defined.\n");
>             return;
>         }
>         if(is_compound(rp) && CompoundName(rp)==sl1)
>         {
>             Atom bl=CompoundArg1(rp);
>             if(is_compound(bl)) bl=CompoundArg1(bl);
>             Integer i1=CompoundArgN(rp,3);
>             SetAtomProperty(CompoundArg1(t),A_LHA,
>                 MakeCompound1(bl,MakeList1(i1)));
>             if(hasc) SetCompoundArg(CompoundArg2(t),1,NewInteger(0));
>             else SetCompoundArg(t,2,NewInteger(0));
>             return;
>         }
>         if(is_compound(rp) && CompoundName(rp)==sl && CompoundArity(rp)==4)
>         {
>             Atom bl=CompoundArg1(rp);
>             if(is_compound(bl)) bl=CompoundArg1(bl);
>             Integer i1=CompoundArgN(rp,4);
>             SetAtomProperty(CompoundArg1(t),A_LHA,
>                 MakeCompound1(bl,MakeList1(i1)));
>             if(hasc) SetCompoundArg(CompoundArg2(t),1,NewInteger(0));
>             else SetCompoundArg(t,2,NewInteger(0));
>             return;
>         }
>         if(is_compound(rp) && CompoundName(rp)==sl2)
>         {
>             Atom bl=CompoundArg1(rp);
>             if(is_compound(bl)) bl=CompoundArg1(bl);
>             Integer i1=CompoundArgN(rp,3);
>             Integer i2=CompoundArgN(rp,4);
>             SetAtomProperty(CompoundArg1(t),A_LHA,
>                 MakeCompound1(bl,MakeList2(i1,i2)));
>             if(hasc) SetCompoundArg(CompoundArg2(t),1,NewInteger(0));
>             else SetCompoundArg(t,2,NewInteger(0));
>             return;
>         }
>         if(is_compound(rp) && CompoundName(rp)==sl && CompoundArity(rp)==5)
>         {
>             Atom bl=CompoundArg1(rp);
>             if(is_compound(bl)) bl=CompoundArg1(bl);
>             Integer i1=CompoundArgN(rp,4);
>             Integer i2=CompoundArgN(rp,5);
>             SetAtomProperty(CompoundArg1(t),A_LHA,
>                 MakeCompound1(bl,MakeList2(i1,i2)));
>             if(hasc) SetCompoundArg(CompoundArg2(t),1,NewInteger(0));
>             else SetCompoundArg(t,2,NewInteger(0));
>             return;
>         }
>         
>     }
>     if(is_compound(t))
>     {
>         int i, ar=CompoundArity(t);
>         for(i=1;i<=ar;i++)
>         {
>             Term ta, t1=CompoundArgN(t,i), tn;
>             char cbuf[100];
>             int cnt=1;
>             if(!is_compound(t1)) {proc_ufo_ext(t1); continue;}
>             ta=CompoundName(t1);
>             if(!GetAtomProperty(ta,A_EXT_FUNC)) {proc_ufo_ext(t1);continue;}
>             if(strncmp(AtomValue(ta),"cmath.",6)==0) {proc_ufo_ext(t1);continue;}
>             if(strcmp(AtomValue(ta),"abs")==0) {proc_ufo_ext(t1);continue;}
>             t1=ConsumeCompoundArg(t,i);
>             do {
>                 sprintf(cbuf,"%s%d",AtomValue(ta),cnt++);
>                 tn=NewAtom(cbuf,0);
>             } while(GetAtomProperty(tn,PROP_TYPE));
>             SetCompoundArg(t,i,tn);
>             SetAtomProperty(tn,PROP_TYPE,OPR_PARAMETER);
>             printf("New parameter %s=",cbuf);WriteTerm(t1);puts("");
>             Term nv=NewInteger(1);
>             if(ta==ec) nv=NewFloat(0.66065);
>             if(ta==eb) nv=NewFloat(3.2407);
>             if(ta==et) nv=NewFloat(171.4);
>             if(ta==rc) nv=NewFloat(0.59086);
>             if(ta==rb) nv=NewFloat(2.8984);
>             if(ta==rt) nv=NewFloat(161.91);
>             if(ta==aq) nv=NewFloat(0.1156);
>            // WriteTerm(ta); printf(" "); WriteTerm(nv);puts("");
>             t1=MakeCompound3(tn,nv,0,0);
>             params=AppendLast(params,t1);
>         }
>     }
> }
> 
59a224,226
>     if(UFOutput)
>         proc_ufo_ext(t);
>         
140a308
> 	
145c313
< 		value=ProcessAlias(value);
---
> 		
150a319,320
> 	
> 
165,167c335,336
< 		FreeAtomic(value);
< 		FreeAtomic(comment);
< 		return;
---
> 		value=0;
>                 comment=0;
169a339,340
> 	if(chk_cmplx) has_cmplx_params=1;
> 		
213a385,386
> 	 check_fortr(name);
> 	 if(aname) check_fortr(aname);
297a471,473
> 	if(is_atom(t))
> 		arg=NewAtom("?",0);
> 	else
469c645,647
< 				printf("Error: function ");WriteTerm(t);puts(" is unknown.");
---
>                                 ErrorInfo(0);
> 				printf("unknown function %s(). Use statement:\n",AtomValue(CompoundName(t)));
>                                 printf("external_func(%s,%d).\n",AtomValue(CompoundName(t)),CompoundArity(t));
646c824
< 	int no;
---
> 	Term  no;
716c894,902
< 			int j, pw=IntegerValue(CompoundArg2(t1));
---
>             if(!is_integer(CompoundArg2(t1)))
>             {
>                 Term n=MakeCompound1(NewAtom("math.log",0),ConsumeCompoundArg(t1,1));
>                 n=MakeCompound2(OPR_MLT,ConsumeCompoundArg(t1,2),n);
>                 n=MakeCompound1(NewAtom("math.exp",0),n);
>                 SetCompoundArg(t,i,n);
>                 continue;
>             }
> 			int j, pw=(int)IntegerValue(CompoundArg2(t1));
732c918
< extern int UFOutput;
---
> extern int UFOutput, ufo_gg_injected;
734a921,922
> List ufo_params_nolha=0;
> static int ufo_params_nolha_no=1;
744a933,935
>     if(!ufo_gg_injected)
>         puts("Warning: strong coupling was not automatically defined.");
>     
764a956,961
>     fprintf(f,"ZERO = Parameter(name = 'ZERO',\n");
> 	fprintf(f,"                  nature = 'internal',\n");
> 	fprintf(f,"                  type = 'real',\n");
> 	fprintf(f,"                  value = '0.0',\n");
> 	fprintf(f,"                  texname = '0')\n\n");
>     
815a1013,1018
> 		else if((is_integer(val)||is_float(val)))
> 		{
> 		  ufo_params_nolha=AppendLast(ufo_params_nolha,t);
> 		  fprintf(f,",\n               lhablock = 'USERDEF',\n");
> 		  fprintf(f,"               lhacode = [ %d ]",ufo_params_nolha_no++);
> 		}
1163a1367,1388
>     int firstll=1;
>     fprintf(f,"      subroutine ModelVarFromFile(nFile)\n      implicit none\n");
>     fprintf(f,"      double precision sqrtS\n      integer nFile\n");
>     fprintf(f,"      double precision Alfas\n\n#include \"decl.h\"\n");
>     fprintf(f,"      character*10 name\n       real*8  val\n\n");
>     fprintf(f,"      character*128 argv(1)\n");
>     fprintf(f,"      call ModelDefaults(0,argv)\n\n123   continue\n");
>     fprintf(f,"      read(nFile,*,end=321) name, val\n");
>     for(li=params;li;li=ListTail(li))
> 	{
> 		Term t, val;
> 		char mt[64];
> 		t=CompoundName(ListFirst(li));
> 		if(strcmp(AtomValue(t),"pi")==0)
> 		  continue;
>         fprintf(f,"      %s",firstll?"":"else ");
>         firstll=0;
>         fprintf(f,"if(name.eq.\"%s\") then\n",AtomValue(t));
>         fprintf(f,"         %s=val\n",AtomValue(t));
> 	}
>     fprintf(f,"      endif\n      goto 123\n321   continue\n      end\n\n");
>     
1239c1464
< 			int no=IntegerValue(GetAtomProperty(t,A_CHNAME));
---
> 			int no=(int)IntegerValue(GetAtomProperty(t,A_CHNAME));
1261c1486
< 		while(p+strlen(mtp)>60)
---
> 		while(p+(int)strlen(mtp)>60)
1497c1722
< 		tttl=strlen(AtomValue(CompoundName(ttt)));
---
> 		tttl=(int)strlen(AtomValue(CompoundName(ttt)));
1500c1725
< 			tttl+=strlen(AtomValue(attt))+1;
---
> 			tttl+=(int)strlen(AtomValue(attt))+1;
1540c1765
< 			if(opAutoWidths && GetAtomProperty(CompoundName(ttt),OPR_WIDTH)
---
> 			if(!UFOutput && opAutoWidths && GetAtomProperty(CompoundName(ttt),OPR_WIDTH)
1713,1715c1938
< #include "../../CalcHEP_src/c_source/SLHAplus/include/SLHAplus.h"
< 
< //#include "SLHAplus/SLHAplus.h"
---
> #include "SLHAplus/SLHAplus.h"
1718a1942,2138
> static cmplx cx_pow(cmplx c, int p)
> {
>     cmplx ret;
> 	int i;
> 	ret.r=1.0;
> 	ret.i=0.0;
> 	if(p<0)
> 	{
> 	  cmplx t=c;
> 	  c.r=t.r/(t.r*t.r+t.i*t.i);
> 	  c.i=-t.i/(t.r*t.r+t.i*t.i);
> 	  p=-p;
> 	}
> 	for(i=0;i<p;i++)
> 	{
> 	  cmplx t;
> 	  t.r=ret.r*c.r-ret.i*c.i;
> 	  t.i=ret.r*c.i+ret.i*c.r;
> 	  ret=t;
> 	}
> 	return ret;
> }
> 
> cmplx cEvalParameter(Term t)
> {
>   cmplx ret;
>   ret.r=ret.i=0.0;
>   
>   if(t==0)
> 		return ret;
> 
> 	if(t==A_SQRT2)
> 	{
> 		ret.r=sqrt((double)2.0);
> 		return ret;
> 	}
> 	
> 	if(t==A_I)
> 	{
> 	  ret.i=1.0;
> 		return ret;
> 	}
>   
>   if(is_integer(t))
> 	{
> 		ret.r=(double)IntegerValue(t);
> 		return ret;
> 	}
> 	
> 	if(is_float(t))
> 		return ComplexValue(t);
> 	
> 	if(is_atom(t) && is_parameter(t))
> 		{
> 		List l;
> 		Atom at;
> 
> 		l=GetAtomProperty(t,A_DUMMY_PRM);
> 		if(l)
> 		{
> 			
> 			List l1;
> 			for(l1=l;l1;l1=ListTail(l1))
> 			{
> 			  cmplx r1=cEvalParameter(CompoundArg2(ListFirst(l1)));
> 			  r1.r*=IntegerValue(CompoundArg1(ListFirst(l1)));
> 			  r1.i*=IntegerValue(CompoundArg1(ListFirst(l1)));
> 			  ret.r+=r1.r;
> 			  ret.i+=r1.i;
> 			}	
> 			return ret;
> 		}
> 
> 		at=GetAtomProperty(t,A_ANTI);
> 		if(at==0)
> 		{
> 		  ret.r=EvalParameter(t);
> 		  return ret;
> 		}
> 
> 		for(l=params;l;l=ListTail(l))
> 			{
> 			Atom curt=CompoundName(ListFirst(l));
> 			if(curt==t || curt==at)
> 				{
> 				Term t1;
> 				double dd;
> 				t1=CompoundArg1(ListFirst(l));
> 				if(is_integer(t1))
> 				{
> 					ret.r= (double)IntegerValue(t1);
> 					return ret;
> 				}
> 				
> 				if(is_float(t1))
> 				{
> 					ret= ComplexValue(t1);
> 					if(curt==at) ret.i=-ret.i;
> 					return ret;
> 				}
> 				if(t1==0)
> 					return ret;
> 				if(CompoundArgN(ListFirst(l),3)!=0)
> 				{
> 					ret=ComplexValue(CompoundArgN(ListFirst(l),3));
> 					if(curt==at) ret.i=-ret.i;
> 					return ret;
> 				}
> 				ret=cEvalParameter(t1);
> 				SetCompoundArg(ListFirst(l),3,NewComplex(ret));
> 				if(curt==at) ret.i=-ret.i;
> 				return ret;
> 				}
> 			}
> 		if(GetAtomProperty(t,A_EXT_FUNC))
> 		{
> 			if(strncmp(AtomValue(t),"initDiagonal",12)==0)
> 			{initDiagonal();
> 			  return ret;
> 			}
> 			else
> 				return ret;
> 		}
> 
> 		printf("Internal error (prm01'%s')\n",AtomValue(t));
> 		return ret;
> 		}
> 	
> 	if(is_compound(t) && CompoundArity(t)==2 && CompoundName(t)==OPR_PLUS)
> 	{
> 	  cmplx c1=cEvalParameter(CompoundArg1(t)), c2=cEvalParameter(CompoundArg2(t));
> 	  ret.r=c1.r+c2.r;
> 	  ret.i=c1.i+c2.i;
> 	  return ret;
> 	}
> 	if(is_compound(t) && CompoundArity(t)==2 && CompoundName(t)==OPR_MINUS)
> 	{
> 	  cmplx c1=cEvalParameter(CompoundArg1(t)), c2=cEvalParameter(CompoundArg2(t));
> 	  ret.r=c1.r-c2.r;
> 	  ret.i=c1.i-c2.i;
> 	  return ret;
> 	}
> 	if(is_compound(t) && CompoundArity(t)==2 && CompoundName(t)==OPR_MLT)
> 	{
> 	  cmplx c1=cEvalParameter(CompoundArg1(t)), c2=cEvalParameter(CompoundArg2(t));
> 	  ret.r=c1.r*c2.r-c1.i*c2.i;
> 	  ret.i=c1.r*c2.i+c1.i*c2.r;
> 	  return ret;
> 	}
> 	if(is_compound(t) && CompoundArity(t)==2 && CompoundName(t)==OPR_DIV)
> 	{
> 	  cmplx c1=cEvalParameter(CompoundArg1(t)), c2=cEvalParameter(CompoundArg2(t));
> 	  ret.r=(c1.r*c2.r+c1.i*c2.i)/(c2.r*c2.r+c2.i*c2.i);
> 	  ret.i=(-c1.r*c2.i+c1.i*c2.r);
> 	  return ret;
> 	}
> 	if(is_compound(t) && CompoundArity(t)==1 && CompoundName(t)==OPR_MINUS)
> 	{
> 	  ret=cEvalParameter(CompoundArg1(t));
> 	  ret.r=-ret.r;
> 	  ret.i=-ret.i;
> 	  return ret;
> 	}
> 	if(is_compound(t) && CompoundArity(t)==2 && CompoundName(t)==OPR_POW)
> 	{
> 	  cmplx c1=cEvalParameter(CompoundArg1(t));
> 	  Term pw=CompoundArg2(t);
> 	  if(!is_integer(pw))
> 	  {
> 		ErrorInfo(0);
> 		puts("Complex power is not implemented.");
> 		return ret;
> 	  }
> 	  ret=cx_pow(c1,(int)IntegerValue(pw));
> 	  return ret;
> 	}
> 	
> 	if(is_list(t))
> 		{
> 		List l;
> 		ret.r=1.0;
> 		for(l=t;l;l=ListTail(l))
> 			{
> 			cmplx tpv, tmp;
> 			int tpw;
> 			tpv=cEvalParameter(CompoundArg1(ListFirst(l)));
> 			tpw=(int)IntegerValue(CompoundArg2(ListFirst(l)));
> 			tpv=cx_pow(tpv,tpw);
> 			/*WriteTerm(ListFirst(l)); printf("=(%f,%f)\n",tpv.r,tpv.i);*/
> 			tmp.r=tpv.r*ret.r-tpv.i*ret.i;
> 			tmp.i=tpv.i*ret.r+tpv.r*ret.i;
> 			ret=tmp;
> 			}
> 		return ret;
> 		}
> 	
> }
1724c2144
< 		return 1.0;
---
> 		return 0.0;
1732a2153
> 
1734a2156
> 	
1987c2409,2410
< 			tpw=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 			tpw=(int)IntegerValue(CompoundArg2(ListFirst(l)));
> 			
2023c2446
< 	double ret;
---
> 	cmplx ret;
2026c2449
< 	ret=EvalParameter(CompoundArg1(t));
---
> 	ret=cEvalParameter(CompoundArg1(t));
2028c2451,2454
< 	printf("=%f\n",ret);
---
> 	if(ret.i==0)
> 	  printf("=%f\n",ret.r);
> 	else
> 	  printf("=(%f,%f)\n",ret.r,ret.i);
2131c2557
< 	mono=IntegerValue(CompoundArg1(t));
---
> 	mono=(int)IntegerValue(CompoundArg1(t));
2339a2766
> 		if(!ListMember(ExtFuncList,name))
2399c2826
< 			hf=(extfunc)&MbEff;
---
> 			hf=(extfunc)&MtEff;
2504a2932
> 	if(!ListMember(ExtFuncList,CompoundArg1(t)))
2689c3117
< 			r*=IntegerValue(CompoundArg1(t));
---
> 			r*=(int)IntegerValue(CompoundArg1(t));
2691a3120
> 	
2697c3126
< 			r*=IntegerValue(CompoundArg1(t));
---
> 			r*=(int)IntegerValue(CompoundArg1(t));
2699a3129
> 	
2710c3140
< 		int v=IntegerValue(CompoundArg1(t))*IntegerValue(CompoundArg2(t));
---
> 		long int v=IntegerValue(CompoundArg1(t))*IntegerValue(CompoundArg2(t));
2729c3159
< 		int v=IntegerValue(CompoundArg1(t))+IntegerValue(CompoundArg2(t));
---
> 		int v=(int)IntegerValue(CompoundArg1(t))+(int)IntegerValue(CompoundArg2(t));
2741c3171
< 		Term t1=ConsumeCompoundArg(t,1);
---
> 		Term t1=ConsumeCompoundArg(t,2);
2749c3179
< 		int v=IntegerValue(CompoundArg1(t))-IntegerValue(CompoundArg2(t));
---
> 		long int v=IntegerValue(CompoundArg1(t))-IntegerValue(CompoundArg2(t));
diff -rbd micromegas/Packages/LanHEP/parse.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/parse.c
79c79
< 				&& (n_a==OPR_MINUS || GetOperator(n_a,OP_INFIX,NULL,NULL)==0))
---
> 				&& (n_a==OPR_MINUS || n_a==OPR_PLUS || GetOperator(n_a,OP_INFIX,NULL,NULL)==0))
373c373,374
< 	int minprior=-1, oper_type;
---
> 	int minprior=-1;
>     Atom  oper_type;
375a377
> 	
384d385
< 
403c404
< 		pri=IntegerValue(CompoundArgN(ct,3));
---
> 		pri=(int)IntegerValue(CompoundArgN(ct,3));
diff -rbd micromegas/Packages/LanHEP/photon.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/photon.c
11c11
< int defined_em_charge(void)
---
> Atom defined_em_charge(void)
92,95c92,95
< 			num=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 			num*=IntegerValue(CompoundArg1(m2));
< 			den=IntegerValue(CompoundArg2(CompoundArg2(a2)));
< 			cd=gcf(num,den);
---
> 			num=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 			num*=(int)IntegerValue(CompoundArg1(m2));
> 			den=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
> 			cd=(int)gcf(num,den);
184,187c184,187
< 	num=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 	num*=IntegerValue(CompoundArg1(ListFirst(l)));
< 	den=IntegerValue(CompoundArg2(CompoundArg2(a2)));
< 	cd=gcf(num,den);
---
> 	num=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 	num*=(int)IntegerValue(CompoundArg1(ListFirst(l)));
> 	den=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
> 	cd=(int)gcf(num,den);
254,257c254,257
< 			num=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 			num*=IntegerValue(CompoundArg1(m2));
< 			den=IntegerValue(CompoundArg2(CompoundArg2(a2)));
< 			cd=gcf(num,den);
---
> 			num=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 			num*=(int)IntegerValue(CompoundArg1(m2));
> 			den=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
> 			cd=(int)gcf(num,den);
296,297c296,297
< 	nu=IntegerValue(CompoundArg1(dv));
< 	de=IntegerValue(CompoundArg2(dv));
---
> 	nu=(int)IntegerValue(CompoundArg1(dv));
> 	de=(int)IntegerValue(CompoundArg2(dv));
383a384
>                 int auf=0;
392a394,400
>                         if(is_compound(prp) && CompoundName(prp)==OPR_PARTICLE)
>                         {
>                             Atom aaa=CompoundArgN(prp,7);
>                             if(is_atom(aaa) && (AtomValue(aaa)[0]=='*' ||
>                                 AtomValue(aaa)[1]=='*'))
>                                 auf=1;
>                         }
417c425
< 		if(get_num())
---
> 		if(!auf && get_num())
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: README
diff -rbd micromegas/Packages/LanHEP/redcol.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/redcol.c
78c78
< 		i2=IntegerValue(CompoundArg2(t));
---
> 		i2=(int)IntegerValue(CompoundArg2(t));
95,96c95,96
< 	i1=IntegerValue(CompoundArg1(l));
< 	i2=IntegerValue(CompoundArg2(l));
---
> 	i1=(int)IntegerValue(CompoundArg1(l));
> 	i2=(int)IntegerValue(CompoundArg2(l));
128,129c128,129
< 	n1=floor(sqrt(i1)+0.5);
< 	d1=floor(sqrt(i2)+0.5);
---
> 	n1=(int)floor(sqrt(i1)+0.5);
> 	d1=(int)floor(sqrt(i2)+0.5);
276c276
< 		if(ListNth(l1,i1)==ListNth(l2,i2))
---
> 		if(ListNth(l1,(int)i1)==ListNth(l2,(int)i2))
287c287
< 			collab=ListNth(l1,i1);
---
> 			collab=ListNth(l1,(int)i1);
337a338
> 		
368a370,395
> 	if(i1==A_COLOR_L6 && i2==A_COLOR_L6)
> 		{
> 		  
> 		if(co1==3 && co2==3)
> 			{
> 			ctype=3;
> 			goto cnt4;
> 			}
> 		if(co1==1 && co2==2)
> 			{
> 			ctype=6;
> 			goto cnt4;
> 			}
> 		if(co1==2 && co2==1)
> 			{
> 			co1=csp1;
> 			csp1=csp2;
> 			csp2=co1;
> 			ctype=6;
> 			goto cnt4;
> 			}
> 		printf("Internal error in vertex ");
> 		WriteVertex(CompoundArg1(a2));
> 		printf(" (rc23).\n");
> 		return AppendFirst(NewList(),a2);
> 		}
660,662c687,688
< 	
< 		
< 	l2=mk_im_field(ctype, ListLength(i1)-1, (ctype==3&&opNeutrC8)?0:anti, prt);
---
> 	l2=mk_im_field(ctype, ListLength(i1)-1, (ctype==3&&opNeutrC8)?0:anti, 
> 	  ConcatList(CopyTerm(prt1),CopyTerm(prt2)));
956c982
< 	l2=mk_im_field(0, ListLength(i1), anti, prt);
---
> 	l2=mk_im_field(0, ListLength(i1), anti, ConcatList(CopyTerm(prt1),CopyTerm(prt2)));
1018,1019c1044,1045
< 			*pos=IntegerValue(CompoundArg2(prp));
< 			return IntegerValue(CompoundArg1(prp));
---
> 			*pos=(int)IntegerValue(CompoundArg2(prp));
> 			return (int)IntegerValue(CompoundArg1(prp));
1026a1053,1054
> extern Atom ColorK6, ColorK6b;
> 	
1029a1058
> 	int colc6=0, colc6b=0;
1160a1190,1199
> 	 for(l1=cs_l;l1;l1=ListTail(l1))
> 	 {
> 	   if(CompoundArg1(ListFirst(l1))==ColorK6)
> 	     colc6++;
> 	   if(CompoundArg1(ListFirst(l1))==ColorK6b)
> 	     colc6b++;
> 	 }
> 	
> 	if(ListLength(cs_l)!=4 || !colc6 || !colc6b)
> 	{
1162a1202
> 	}
1199c1239
< 		if((cp_no<3 && cs_no>0) || (cp_no==3 && cs_no!=1))
---
> 		if((cp_no<3 && cs_no>0) || (cp_no==3 && cs_no>1))
diff -rbd micromegas/Packages/LanHEP/redspin.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/redspin.c
4c4,6
< /*#define DEB*/
---
> /*
> #define DEB
> */
25c27
< 		i2=IntegerValue(CompoundArg2(t));
---
> 		i2=(int)IntegerValue(CompoundArg2(t));
42,43c44,45
< 	i1=IntegerValue(CompoundArg1(l));
< 	i2=IntegerValue(CompoundArg2(l));
---
> 	i1=(int)IntegerValue(CompoundArg1(l));
> 	i2=(int)IntegerValue(CompoundArg2(l));
74,75c76,77
< 	n1=floor(sqrt(i1)+0.5);
< 	d1=floor(sqrt(i2)+0.5);
---
> 	n1=(int)floor(sqrt(i1)+0.5);
> 	d1=(int)floor(sqrt(i2)+0.5);
101a104,105
> 			if(spin==1)
> 			{
111a116
> 			}
114a120,121
> 			if(spin==1)
> 			{
125a133
> 		}
477c485
< 	FreeAtomic(i2);
---
> //	FreeAtomic(i2);
480c488
< printf("im indices: ");	WriteTerm(i1); puts("");
---
> printf("im indices: ");	WriteTerm(i1); printf(" x "); WriteTerm(i2); puts("");
503c511,512
< 	l2=mk_im_field(0, ListLength(i1), anti, prt);
---
> 	l2=mk_im_field(0, ListLength(i1), anti, 
> 		       ConcatList(CopyTerm(prt1),CopyTerm(prt2)));
diff -rbd micromegas/Packages/LanHEP/regprt.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/regprt.c
24c24
< 		if(r<0)
---
> 		if(r<0 && !CalcOutput)
diff -rbd micromegas/Packages/LanHEP/SLHAplus/Makefile /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/SLHAplus/Makefile
1,2c1,2
< #CC = 
< #FC =
---
> CC = gcc
> FC = gfortran
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: susy8
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: susyLHA
diff -rbd micromegas/Packages/LanHEP/terms.h /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/terms.h
9a10,11
> #define TERMTYPE(t) (t>>56)
> 
15c17
< typedef signed int Atom, Integer, Float,
---
> typedef signed long int Atom, Integer, Float,
48c50
< extern union LISTpoint *LISTS_buffers[4096];
---
> extern union LISTpoint *LISTS_buffers[400096];
53c55
< #define LIST_pointer(l) (LISTS_buffers[(l&0xfff0000)/0x10000]+(l&0xffff))
---
> #define LIST_pointer(l) (LISTS_buffers[(l&0xfffff0000)/0x10000]+(l&0xffff))
95c97
< extern union COMPOpoint *COMPO_buffers[4096];
---
> extern union COMPOpoint *COMPO_buffers[400096];
98c100
< extern int LABEL_count;
---
> extern long int LABEL_count;
122,124c124,126
< #define CompoundFunctor(c) ((COMPO_buffers[(c&0xfff0000)/0x10000]+(c&0xffff))->data.a[0])
< #define CompoundArg1(c) ((COMPO_buffers[(c&0xfff0000)/0x10000]+(c&0xffff))->data.a[1])
< #define CompoundArg2(c) ((COMPO_buffers[(c&0xfff0000)/0x10000]+(c&0xffff))->data.a[2])
---
> #define CompoundFunctor(c) ((COMPO_buffers[(c&0xfffff0000)/0x10000]+(c&0xffff))->data.a[0])
> #define CompoundArg1(c) ((COMPO_buffers[(c&0xfffff0000)/0x10000]+(c&0xffff))->data.a[1])
> #define CompoundArg2(c) ((COMPO_buffers[(c&0xfffff0000)/0x10000]+(c&0xffff))->data.a[2])
126,127c128,129
< #define FunctorName(f) ((f & 0xffffff) + 0x1000000)
< #define FunctorArity(f) ((f/0x1000000)-1)
---
> #define FunctorName(f) ((f & 0xffffff) + (1L<<56))
> #define FunctorArity(f) ((int)(((f>>48)&0xff)-1))
169a172,174
> 
> typedef struct { double r, i;} cmplx;
> Float   NewComplex(cmplx);
171a177,179
> cmplx  ComplexValue(Float);
> void   SetFloat(Float, double, double);
> double ImaginaryValue(Float);
190c198
< int 	LabelValue(Atomic l);
---
> long int 	LabelValue(Atomic l);
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP: test
diff -rbd micromegas/Packages/LanHEP/trics3.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/trics3.c
65,66c65,66
< 	comf=IntegerValue(CompoundArg1(m2_1));
< 	comf1=IntegerValue(CompoundArg1(m2_3));
---
> 	comf=(int)IntegerValue(CompoundArg1(m2_1));
> 	comf1=(int)IntegerValue(CompoundArg1(m2_3));
458c458
< 		nr[i-1]=IntegerValue(CompoundArg1(ListFirst(ListFirst(l))));
---
> 		nr[i-1]=(int)IntegerValue(CompoundArg1(ListFirst(ListFirst(l))));
511c511
< 		nr[i-1]=IntegerValue(CompoundArg1(ListFirst(ListFirst(l))));
---
> 		nr[i-1]=(int)IntegerValue(CompoundArg1(ListFirst(ListFirst(l))));
diff -rbd micromegas/Packages/LanHEP/tridef.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/tridef.c
20c20
< static int check_sine(Atom nm, Term val)
---
> static Term check_sine(Atom nm, Term val)
168c168
< 		ncf=IntegerValue(CompoundArg1(nn));
---
> 		ncf=(int)IntegerValue(CompoundArg1(nn));
173c173
<            n=IntegerValue(CompoundArg1(ListFirst(ll)));
---
>            n=(int)IntegerValue(CompoundArg1(ListFirst(ll)));
335,336c335,336
< 	g1=IntegerValue(CompoundArg1(ListFirst(val)));
< 	g2=IntegerValue(CompoundArg1(ListFirst(ListTail(val))));
---
> 	g1=(int)IntegerValue(CompoundArg1(ListFirst(val)));
> 	g2=(int)IntegerValue(CompoundArg1(ListFirst(ListTail(val))));
759c759
< 		tri_dbg_mode=IntegerValue(CompoundArg1(t));
---
> 		tri_dbg_mode=(int)IntegerValue(CompoundArg1(t));
diff -rbd micromegas/Packages/LanHEP/trigon.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/trigon.c
106c106
< 		if(red_1(IntegerValue(ListFirst(lu)),m2l,&l1,&l2)==0)
---
> 		if(red_1((int)IntegerValue(ListFirst(lu)),m2l,&l1,&l2)==0)
115c115
< 		if(red_2(-IntegerValue(ListFirst(lu)),m2l,&l1,&l2)==0)
---
> 		if(red_2(-(int)IntegerValue(ListFirst(lu)),m2l,&l1,&l2)==0)
150,151c150,151
< 		a1= IntegerValue(ListFirst(ListTail(lu)));
< 		a2= IntegerValue(ListFirst(lu));
---
> 		a1=(int) IntegerValue(ListFirst(ListTail(lu)));
> 		a2=(int) IntegerValue(ListFirst(lu));
250,251c250,251
< 		a1= IntegerValue(ListFirst(ListTail(lu)));
< 		a2=-IntegerValue(ListFirst(lu));
---
> 		a1= (int)IntegerValue(ListFirst(ListTail(lu)));
> 		a2=-(int)IntegerValue(ListFirst(lu));
382,383c382,383
< 				pt=IntegerValue(CompoundArg2(ListFirst(l2)));
< 				pc=IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 				pt=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
> 				pc=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
411,412c411,412
< 					pt=IntegerValue(CompoundArg2(ListFirst(l3)));
< 					pc=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 					pt=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
> 					pc=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
431,432c431,432
< 				CompoundArg1(ListNth(tri_si_co_list,IntegerValue(ListFirst(l)))),
< 				CompoundArg2(ListNth(tri_si_co_list,IntegerValue(ListFirst(l)))));
---
> 				CompoundArg1(ListNth(tri_si_co_list,(int)IntegerValue(ListFirst(l)))),
> 				CompoundArg2(ListNth(tri_si_co_list,(int)IntegerValue(ListFirst(l)))));
447,448c447,448
< 				pt=IntegerValue(CompoundArg2(ListFirst(l2)));
< 				pc=IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 				pt=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
> 				pc=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
476,477c476,477
< 					pt=IntegerValue(CompoundArg2(ListFirst(l3)));
< 					pc=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 					pt=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
> 					pc=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
494,495c494,495
< 				CompoundArg2(ListNth(tri_si_co_list,IntegerValue(ListFirst(l)))),
< 				CompoundArg1(ListNth(tri_si_co_list,IntegerValue(ListFirst(l)))));
---
> 				CompoundArg2(ListNth(tri_si_co_list,(int)IntegerValue(ListFirst(l)))),
> 				CompoundArg1(ListNth(tri_si_co_list,(int)IntegerValue(ListFirst(l)))));
538c538
< 		cnum=IntegerValue(CompoundArg1(ListFirst(ml)));
---
> 		cnum=(int)IntegerValue(CompoundArg1(ListFirst(ml)));
559c559
< 		fa=IntegerValue(CompoundArg1(ListFirst(ml)));
---
> 		fa=(int)IntegerValue(CompoundArg1(ListFirst(ml)));
604,608c604,608
< 		i1=IntegerValue(CompoundArg1(m1));
< 		i2=IntegerValue(CompoundArg1(m2));
< 		i3=IntegerValue(CompoundArg1(m3));
< 		cf=gcf(i1,i2);
< 		cf=gcf(cf,i3);
---
> 		i1=(int)IntegerValue(CompoundArg1(m1));
> 		i2=(int)IntegerValue(CompoundArg1(m2));
> 		i3=(int)IntegerValue(CompoundArg1(m3));
> 		cf=(int)gcf(i1,i2);
> 		cf=(int)gcf(cf,i3);
707c707
< 			cf=gcf(IntegerValue(CompoundArg1(ListFirst(l3))),
---
> 			cf=(int)gcf(IntegerValue(CompoundArg1(ListFirst(l3))),
810c810
< 		sc=ListNth(tri_si_co_list,IntegerValue(ListFirst(l)));
---
> 		sc=ListNth(tri_si_co_list,(int)IntegerValue(ListFirst(l)));
828c828
< 		lu22=ListNth(tri_sc_2_list,IntegerValue(lu2));
---
> 		lu22=ListNth(tri_sc_2_list,(int)IntegerValue(lu2));
871c871
< 		lu22=ListNth(tri_sc_2_list,IntegerValue(lu2));
---
> 		lu22=ListNth(tri_sc_2_list,(int)IntegerValue(lu2));
920c920
< 					po=IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 					po=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
960,961c960,961
< 		rs=IntegerValue(CompoundArg2(ListFirst(m1))) -
< 			IntegerValue(CompoundArg2(ListFirst(m2)));
---
> 		rs=(int)IntegerValue(CompoundArg2(ListFirst(m1))) -
> 			(int)IntegerValue(CompoundArg2(ListFirst(m2)));
1000c1000
< 	n=IntegerValue(CompoundArg1(m2));
---
> 	n=(int)IntegerValue(CompoundArg1(m2));
1052c1052
< 	cf=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 	cf=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
1056c1056
< 		cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 		cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
1058c1058
< 		cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 		cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
1061c1061
< 			cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 			cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
1064c1064
< 			cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
---
> 			cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l))));
diff -rbd micromegas/Packages/LanHEP/triheu.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/triheu.c
29c29
< 		return IntegerValue(pp1)-IntegerValue(pp2);
---
> 		return (int)IntegerValue(pp1)-(int)IntegerValue(pp2);
46c46
< 			n=pw+IntegerValue(CompoundArg2(pp));
---
> 			n=pw+(int)IntegerValue(CompoundArg2(pp));
69,70c69,70
< 				n1=IntegerValue(CompoundArg1(t));
< 				n2=IntegerValue(CompoundArg1(m2));
---
> 				n1=(int)IntegerValue(CompoundArg1(t));
> 				n2=(int)IntegerValue(CompoundArg1(m2));
102c102
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
111c111
< 			prmpw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			prmpw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
174c174
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
183c183
< 			prmpw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			prmpw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
250c250
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
306c306
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
396c396
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
405c405
< 			prmpw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			prmpw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
576c576
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
585c585
< 			prmpw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			prmpw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
685c685
< 		num=IntegerValue(CompoundArg1(m1));
---
> 		num=(int)IntegerValue(CompoundArg1(m1));
694c694
< 			prmpw=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			prmpw=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
821c821
< 				mres=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 				mres=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
839c839
< 			p=IntegerValue(CompoundArg2(ListFirst(l2)))-res;
---
> 			p=(int)IntegerValue(CompoundArg2(ListFirst(l2)))-res;
963c963
< 		no=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 		no=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
1053c1053
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
1055c1055
< 			nu=gcf(nu,IntegerValue(CompoundArg1(ListFirst(l3))));
---
> 			nu=(int)gcf(nu,IntegerValue(CompoundArg1(ListFirst(l3))));
1265c1265
< 	t=ListNth(tri_si_co_list,IntegerValue(CompoundArg1(v2d)));
---
> 	t=ListNth(tri_si_co_list,(int)IntegerValue(CompoundArg1(v2d)));
1277c1277
< 	t=ListNth(tri_si_co_list,IntegerValue(CompoundArg2(v2d)));
---
> 	t=ListNth(tri_si_co_list,(int)IntegerValue(CompoundArg2(v2d)));
diff -rbd micromegas/Packages/LanHEP/triuti.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/triuti.c
90c90
< 				scoeff=IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 				scoeff=(int)IntegerValue(CompoundArg2(ListFirst(l3)));
123c123
< 				n=IntegerValue(CompoundArg1(m2));
---
> 				n=(int)IntegerValue(CompoundArg1(m2));
207c207
< 			ps=IntegerValue(CompoundArg2(ListFirst(ls)));
---
> 			ps=(int)IntegerValue(CompoundArg2(ListFirst(ls)));
242c242
< 		cf=IntegerValue(CompoundArg1(ListFirst(ml)));
---
> 		cf=(int)IntegerValue(CompoundArg1(ListFirst(ml)));
246c246
< 			cf=gcf(cf,IntegerValue(CompoundArg1(ListFirst(l2))));
---
> 			cf=(int)gcf(cf,IntegerValue(CompoundArg1(ListFirst(l2))));
274,275c274,275
< 		ps=IntegerValue(CompoundArg1(ListFirst(l1)));
< 		pc=IntegerValue(CompoundArg2(ListFirst(l1)));
---
> 		ps=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
> 		pc=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
346a347
> 	//WriteTerm(np); printf(" -> "); WriteTerm(ml);puts("");
419c420
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
471c472
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)));
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)));
520c521
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))/2;
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))/2;
636c637
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))*s1;		
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))*s1;		
706c707
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))*s1;		
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))*s1;		
786c787
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))*sn2/2;		
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))*sn2/2;		
951c952
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))*sp_s*cp_s;		
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))*sp_s*cp_s;		
1079c1080
< 		nu=IntegerValue(CompoundArg1(ListFirst(l1)))*s_1;
---
> 		nu=(int)IntegerValue(CompoundArg1(ListFirst(l1)))*s_1;
1211c1212
< 		i=IntegerValue(CompoundArg1(v2d));
---
> 		i=(int)IntegerValue(CompoundArg1(v2d));
1223c1224
< 		i=IntegerValue(CompoundArg2(v2d));
---
> 		i=(int)IntegerValue(CompoundArg2(v2d));
1409,1410c1410,1411
< 			po1=IntegerValue(CompoundArg2(ListFirst(l1)));
< 			po2=IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			po1=(int)IntegerValue(CompoundArg2(ListFirst(l1)));
> 			po2=(int)IntegerValue(CompoundArg2(ListFirst(l2)));
1473,1474c1474,1475
< 		num=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 		den=IntegerValue(CompoundArg2(CompoundArg2(a2)));
---
> 		num=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 		den=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
1477c1478
< 		rnum=gcf(num,den);
---
> 		rnum=(int)gcf(num,den);
diff -rbd micromegas/Packages/LanHEP/util.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/util.c
3c3
< int gcf(int i1, int i2)
---
> long int gcf(long int i1, long  int i2)
diff -rbd micromegas/Packages/LanHEP/varver.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/varver.c
80c80
< 		ppow=IntegerValue(CompoundArg2(t));
---
> 		ppow=(int)IntegerValue(CompoundArg2(t));
564,565c564,565
< 	n=IntegerValue(CompoundArg1(CompoundArg2(a2)));
< 	d=IntegerValue(CompoundArg2(CompoundArg2(a2)));
---
> 	n=(int)IntegerValue(CompoundArg1(CompoundArg2(a2)));
> 	d=(int)IntegerValue(CompoundArg2(CompoundArg2(a2)));
571c571
< 			IntegerValue(CompoundArg1(ListFirst(ml))));
---
> 			(int)IntegerValue(CompoundArg1(ListFirst(ml))));
575c575
< 		n=IntegerValue(CompoundArg1(ListFirst(l)));
---
> 		n=(int)IntegerValue(CompoundArg1(ListFirst(l)));
949c949
< 				thcut=IntegerValue(CompoundArg2(t1));
---
> 				thcut=(int)IntegerValue(CompoundArg2(t1));
991c991
< 		spin[i]=IntegerValue(CompoundArgN(prp,4));
---
> 		spin[i]=(int)IntegerValue(CompoundArgN(prp,4));
1072c1072,1073
< 	fprintf(f,"cat > scan_%s/process.h <<END\n",pname);
---
>         fprintf(f,"if test ! -d drivers/F ;\n");
> 	fprintf(f,"then cat > scan_%s/process.h <<END\n",pname);
1093,1094c1094
< 	fprintf(f,"#define NCOMP 2\n#include \"%cto2.F\"\nEND\n\n",dec?'1':'2');
< 	
---
> 	fprintf(f,"#define NCOMP 2\n#include \"%cto2.F\"\nEND\n\nfi\n\n",dec?'1':'2');
1096a1097
> 	/*
1098a1100
> 	*/
1115c1117
< 	fprintf(f,"then ./configure && cp ../makefile . ;\n");
---
> 	fprintf(f,"then ./configure ;\n");
diff -rbd micromegas/Packages/LanHEP/write.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/write.c
43a44
> 			if(ImaginaryValue(T)==0.0)
44a46,47
> 			else
> 			  return printf("(%g,%g)",FloatValue(T),ImaginaryValue(T));
107a111
> 		  if(ImaginaryValue(T)==0.0)
108a113,114
> 		  else
> 			  return fprintf(file,"(%g,%g)",FloatValue(T),ImaginaryValue(T));
199c205
< 	len=strlen(s);
---
> 	len=(int)strlen(s);
220a227
> 		  if(ImaginaryValue(T)==0.0)
221a229,230
> 		  else
> 			  return printf("(%g,%g)",FloatValue(T),ImaginaryValue(T));
375a385
> 		  if(ImaginaryValue(T)==0.0)
376a387,388
> 		  else
> 			  return fprintf(file,"(%g,%g)",FloatValue(T),ImaginaryValue(T));
542c554,558
< 		    int ret=sprintf(string,"%g",FloatValue(T));
---
> 		    int ret;
> 			if(ImaginaryValue(T)==0.0)
> 			  ret=sprintf(string,"%g",FloatValue(T));
> 			else
> 			  ret=sprintf(string,"(%g,%g)",FloatValue(T),ImaginaryValue(T));
737d752
< 	
739a755
> 		 
746a763
> 		  if(ImaginaryValue(t)==0.0)
747a765,766
> 		  else
> 			  printf("(%g,%g)",FloatValue(t),ImaginaryValue(t));
diff -rbd micromegas/Packages/LanHEP/wrtfa.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/wrtfa.c
27c27
< void alg2_fix_uuv(Term), alg2_fix_ff(Term), alg2_red_rc(Term);
---
> void alg2_fix_uuv(Term), alg2_fix_ff(Term), alg2_fix_mom2(Term), alg2_red_rc(Term);
68,69c68,69
< 			return IntegerValue(CompoundArg2(ListFirst(l1)))-
< 					IntegerValue(CompoundArg2(ListFirst(l2)));
---
> 			return (int)IntegerValue(CompoundArg2(ListFirst(l1)))-
> 					(int)IntegerValue(CompoundArg2(ListFirst(l2)));
79c79
< 			return CompoundName(ListFirst(l1))-CompoundName(ListFirst(l2));
---
> 			return (int)(CompoundName(ListFirst(l1))-CompoundName(ListFirst(l2)));
81c81
< 			return CompoundArg1(ListFirst(l1))-CompoundArg1(ListFirst(l2));
---
> 			return (int)(CompoundArg1(ListFirst(l1))-CompoundArg1(ListFirst(l2)));
172c172
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
174c174
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
176c176,184
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
> 											IntegerValue(CompoundArg2(ch)));
>                                                 if(ch)
>                                                 {
>                                                     fprintf(f,"\tQuantumNumbers -> {");
>                                                     if(CompoundArg2(ch)==NewInteger(1))
> 							fprintf(f," %ld Charge },\n",IntegerValue(CompoundArg1(ch)));
>                                                     else
> 							fprintf(f," %ld/%ld Charge },\n",IntegerValue(CompoundArg1(ch)),
178a187
> 						}
203c212
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
205c214
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
207c216
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
242c251
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
244c253
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
246c255
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
277c286
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
279c288
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
281c290
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
310c319
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
312c321
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
314c323
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
355c364
< 							fprintf(f,"0\n");
---
> 							fprintf(f,"0,\n");
357c366
< 							fprintf(f,"%ld\n",IntegerValue(CompoundArg1(ch)));
---
> 							fprintf(f,"%ld,\n",IntegerValue(CompoundArg1(ch)));
359c368
< 							fprintf(f,"%ld/%ld\n",IntegerValue(CompoundArg1(ch)),
---
> 							fprintf(f,"%ld/%ld,\n",IntegerValue(CompoundArg1(ch)),
390,391c399,400
< 			int cl=IntegerValue(ListFirst(fp));
< 			int no=IntegerValue(ListFirst(ListTail(fp)));
---
> 			int cl=(int)IntegerValue(ListFirst(fp));
> 			int no=(int)IntegerValue(ListFirst(ListTail(fp)));
409,410c418,419
< 			cl=IntegerValue(ListFirst(fp));
< 			no=IntegerValue(ListFirst(ListTail(fp)));
---
> 			cl=(int)IntegerValue(ListFirst(fp));
> 			no=(int)IntegerValue(ListFirst(ListTail(fp)));
451c460,462
< 					if(GetAtomProperty(CompoundArg1(ListFirst(l3)),A_INFINITESIMAL))
---
> 					if(GetAtomProperty(CompoundArg1(ListFirst(l3)),A_INFINITESIMAL) &&
>                                         !GetAtomProperty(CompoundArg1(ListFirst(l3)),PROP_TYPE)
>                                         )
469a481
> 		alg2_fix_mom2(a2);
482a495
>        
483a497
>        
668c682
< 				ii=IntegerValue(ListFirst(ListTail(fai)));
---
> 				ii=(int)IntegerValue(ListFirst(ListTail(fai)));
717,719c731,735
< 				if((pr=GetAtomProperty(CompoundArg1(ListFirst(l3)),A_INFINITESIMAL)))
< 					io+=IntegerValue(CompoundArg1(pr))*
< 						IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 				if((pr=GetAtomProperty(CompoundArg1(ListFirst(l3)),A_INFINITESIMAL))
>                                     && !GetAtomProperty(CompoundArg1(ListFirst(l3)),PROP_TYPE)
>                                 )
> 					io+=(int)IntegerValue(CompoundArg1(pr))*
> 						(int)IntegerValue(CompoundArg2(ListFirst(l3)));
865c881
< 		int curi=pind[0];
---
> 		long int curi=pind[0];
1000c1016
< 			int p1=IntegerValue(CompoundArg1(ListFirst(l)));
---
> 			int p1=(int)IntegerValue(CompoundArg1(ListFirst(l)));
1018c1034
< 					int p2=IntegerValue(CompoundArg1(ListFirst(l2)));
---
> 					int p2=(int)IntegerValue(CompoundArg1(ListFirst(l2)));
1059c1075
< 		int n=IntegerValue(is_integer(num)?num:CompoundArg1(num));
---
> 		int n=(int)IntegerValue(is_integer(num)?num:CompoundArg1(num));
1075c1091
< 		int  w=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 		int  w=(int)IntegerValue(CompoundArg2(ListFirst(l)));
1172c1188
< 			il1=(i==4?IntegerValue(in1)+4:i);
---
> 			il1=(i==4?(int)IntegerValue(in1)+4:i);
1175c1191
< 			il2=(i==4?IntegerValue(in2)+4:i);
---
> 			il2=(i==4?(int)IntegerValue(in2)+4:i);
1178c1194
< 			il3=(i==4?IntegerValue(in3)+4:i);
---
> 			il3=(i==4?(int)IntegerValue(in3)+4:i);
1197c1213
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
1200c1216
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1215c1231
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
1218c1234
< 			puts(": color structure error(3)");il4=IntegerValue(in4);}
---
> 			puts(": color structure error(3)");il4=(int)IntegerValue(in4);}
1229c1245
< 			puts(": color structure error");il2=IntegerValue(in2);
---
> 			puts(": color structure error");il2=(int)IntegerValue(in2);
1254c1270
< 			puts(": color structure error(1)");il1=IntegerValue(in1);}
---
> 			puts(": color structure error(1)");il1=(int)IntegerValue(in1);}
1257c1273
< 			puts(": color structure error(1)");il2=IntegerValue(in2);}
---
> 			puts(": color structure error(1)");il2=(int)IntegerValue(in2);}
1275c1291
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
1278c1294
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1287c1303
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
1313c1329
< 			puts(": color structure error(1)");il1=IntegerValue(in1);}
---
> 			puts(": color structure error(1)");il1=(int)IntegerValue(in1);}
1316c1332
< 			puts(": color structure error(1)");il2=IntegerValue(in2);}
---
> 			puts(": color structure error(1)");il2=(int)IntegerValue(in2);}
1334c1350
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
1337c1353
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1354c1370
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
1357c1373
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1365c1381
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
1539c1555
< 	  cf=IntegerValue(CompoundArg1(m));
---
> 	  cf=(int)IntegerValue(CompoundArg1(m));
1546c1562
< 	  cf=IntegerValue(CompoundArg1(m));
---
> 	  cf=(int)IntegerValue(CompoundArg1(m));
1553a1570,1623
> void alg2_fix_mom2(Term a2)
> {
> 	List l=CompoundArg1(a2);
> 	return;
> 	if(ListLength(l)!=2)
> 		return;
> 	for(l=CompoundArgN(a2,5);l;l=ListTail(l))
> 	{
> 	Term d1=0, d2=0;
> 	int dno=0;
>     List l2;
> 	for(l2=CompoundArgN(ListFirst(l),3);l2;l2=ListTail(l2))
> 		{
> 		Term m=ListFirst(l2);
> 	    if(is_compound(m) && CompoundName(m)==A_MOMENT)
> 		{
> 			dno++;
> 			if(dno==1) d1=m;
> 			if(dno==2) d2=m;
> 		}
> 		}
> 	if(dno==2)
> 	{
> 		int i1=(int)IntegerValue(ListFirst(CompoundArg2(d1)));
> 		int i2=(int)IntegerValue(ListFirst(CompoundArg2(d2)));
> 		int ch=0;
> 		if(i1!=i2 && i1<3 && i2<3 &&
> 			CompoundArg1(d1)==CompoundArg1(d2))
> 		{
> 			SetCompoundArg(d1,1,NewInteger(i2));
> 			SetCompoundArg(d2,1,NewInteger(i1));
> 			ch=1;
> 		}
> 		else
> 		if(CompoundArg1(d1)==NewInteger(1) && CompoundArg1(d2)==NewInteger(1))
> 		{
> 			SetCompoundArg(d2,1,NewInteger(2));
> 			ch=1;
> 		} else
> 		if(CompoundArg1(d1)==NewInteger(2) && CompoundArg1(d2)==NewInteger(2))
> 		{
> 			SetCompoundArg(d1,1,NewInteger(1));
> 			ch=1;
> 		}
> 		if(ch)
> 		{
> 			
> 			Term m=ListFirst(l);
> 		//	WriteTerm(m);puts("");
> 			SetCompoundArg(m,1,NewInteger(-IntegerValue(CompoundArg1(m))));
> 		}
> 		
> 	}
> 	}
1554a1625
> }
1692c1763,1765
< 			if(GetAtomProperty(CompoundArg1(ListFirst(l2)),A_INFINITESIMAL))
---
> 			if(GetAtomProperty(CompoundArg1(ListFirst(l2)),A_INFINITESIMAL) &&
>                             !GetAtomProperty(CompoundArg1(ListFirst(l2)),PROP_TYPE)
>                         )
diff -rbd micromegas/Packages/LanHEP/wrtuf.c /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LanHEP/wrtuf.c
14,15c14,15
< static Atom ili[4]={0,0,0,0}, imom[4];
< static Integer pind[4], wind[4];
---
> static Atom ili[26]={0,0,0,0,0,0}, imom[16];
> static Integer pind[16], wind[16];
60a61,64
>     int ccf=0;
>     Term prop=GetAtomProperty(a,PROP_TYPE);
>     if(prop && is_compound(prop) && CompoundName(prop)==OPR_FIELD
>        && CompoundArg2(prop)==NewInteger(4)) ccf=1;
102a107
>             if(ccf) {cnbuf[j]=0; return cnbuf;}
140a146
> static int ufo_auto_pdg=1000501;
227a234
> 				
278a286
>                 case 4:
281a290,298
>                 int aux=0;
>                 v=CompoundArgN(p,7);
> 				if(v && is_atom(v))
> 				{
> 					int i, len;
> 					char *av=AtomValue(v);
> 					len=strlen(av);
> 					for(i=0;i<len;i++) if(av[i]=='*') aux=1;
>                 }
284,285c301,303
< 				if(v==0)
< 					printf("Error: PDG code not provided for particle %s.\n",AtomValue(CompoundArg1(p)));
---
> 				if(v==0 && !aux)
> 					printf("Error: PDG code is not provided for particle %s.\n",AtomValue(CompoundArg1(p)));
>                 if(v==0) v=NewInteger(ufo_auto_pdg++);
312a331,347
> 				
> 					if(aux)
> 					{
> 						int sp=(int)IntegerValue(CompoundArgN(p,4));
> 						fprintf(f,"              propagating = False,\n");
> 						if(sp==0) fprintf(f,"              propagator = Prop.ConstS,\n");
> 						else if(sp==1) fprintf(f,"              propagator = Prop.ConstF,\n");
> 						else if(sp==2) fprintf(f,"              propagator = Prop.ConstV,\n");
> 						else if(sp==4) fprintf(f,"              propagator = Prop.ConstT,\n");
> 						else
> 						{
> 							ErrorInfo(700);
> 							printf("Constant propagator in UFO undefined for spin %d/2\n",sp);
> 						}
> 					}
> 						
> 				
432c467,470
< 		alg2_red_1pm5(a2);
---
> 		//WriteTerm(a2); puts(" --> ");
>         //if(ListLength(CompoundArg1(a2))<4) alg2_red_1pm5(a2);
>         //WriteTerm(a2); puts("\n -------------------");
>         
470a509
> 		
474c513
< 		if(ListLength(CompoundArg1(a2))>4)
---
> 		if(ListLength(CompoundArg1(a2))>6)
481c520
< 				printf(" with more than 4 particles.\n");
---
> 				printf(" with more than 6 particles.\n");
484c523
< 				puts("More vertices with more than 4 particles follow");
---
> 				puts("More vertices with more than 6 particles follow");
580c619
< 				ListLength(CompoundArg1(a2))>4)
---
> 				ListLength(CompoundArg1(a2))>6)
597c636
< 		for(i=0;i<4;i++) pind[i]=wind[i]=0;
---
> 		for(i=0;i<6;i++) pind[i]=wind[i]=0;
666a706,707
> 				else if(a==OPR_TENSOR) 
> 					{cbuf[i]='T';}
694,695c735,736
< 					io+=IntegerValue(CompoundArg1(pr))*
< 						IntegerValue(CompoundArg2(ListFirst(l3)));
---
> 					io+=(int)IntegerValue(CompoundArg1(pr))*
> 						(int)IntegerValue(CompoundArg2(ListFirst(l3)));
719c760
< 		for(i=0;i<4;i++) pind[i]=0;
---
> 		for(i=0;i<6;i++) pind[i]=0;
725c766
< 						(a==OPR_VECTOR||a==OPR_SPINOR)?2:1);
---
> 						a==OPR_TENSOR?3:((a==OPR_VECTOR||a==OPR_SPINOR)?2:1));
848,849c889
< 
< static Term conv_lor(List pl, Term m2, int eff)
---
> static Atom fili(Integer ii, char *tns)
852,857c892
< 	List l;
< 	List nc=0, cc=0;
< 	if(ili[0]==0)
< 	{
< 		char cbuf[16];
< 		for(i=1;i<=4;i++)
---
> 	for(i=0;i<6;i++)
859,861c894,895
< 			sprintf(cbuf,"li%d",i); ili[i-1]=NewAtom(cbuf,0);
< 			sprintf(cbuf,"mom%d",i); imom[i-1]=NewAtom(cbuf,0);
< 		}
---
> 		if(ii==pind[i]) return tns[i]?ili[i+10]:ili[i];
> 		if(ii==pind[i+10]) return ili[i+20];
862a897,898
> 	return 0;
> }
864,872d899
< 	for(l=pl,i=0;l;l=ListTail(l),i++)
< 	{
< 		Atom a;
< 		a=CompoundName(CompoundArg2(ListFirst(l)));
< 		if(a==OPR_VECTOR || a==OPR_SPINOR)
< 			pind[i]=ListFirst(CompoundArg1(CompoundArg2(ListFirst(l))));
< 		else
< 			pind[i]=0; 
< 	}
873a901,905
> static List mkgammal(Term m2, List nc, Term curi, Term lasti, List pl, char *tens, int eff)
> {
> 	List l,l2;
> 	static int gim=-11;
> 	if(nc==0) gim=-11;
875,878c907
< 	if(CompoundName(CompoundArg2(ListFirst(pl)))==OPR_SPINOR)
< 	{
< 		int curi=pind[0];
< 		for(l=CompoundArgN(m2,3);l&&curi!=pind[1];l=ListTail(l))
---
> 		for(l=CompoundArgN(m2,3);l&&curi!=lasti;l=ListTail(l))
880a910
> 			
882c912
< 			if(curi==pind[1]) break;
---
> 			if(curi==lasti) break;
891,892c921,924
< 					for(i=0;i<4;i++) if(pind[i]==gi) break;
< 					if(i<4)
---
> 					Atom iii;
> 					if(is_atom(gi)) iii=gi;
> 					else iii=fili(gi,tens);
> 					if(iii)
894c926
< 						nc=AppendLast(nc,MakeCompound1(A_GAMMA,ili[i]));
---
> 						nc=AppendLast(nc,MakeCompound1(A_GAMMA,iii));
913a946,964
> 					for(l2=CompoundArgN(m2,3);l2;l2=ListTail(l2))
> 					{
> 						if(l2==l) continue;
> 						if(ListFirst(l2) &&
> 								CompoundArg1(ListFirst(l2))==A_GAMMA &&
> 								ListNth(CompoundArg2(ListFirst(l2)),3)==gi)
> 						{
> 							char cbuf[80];
> 							Atom ni;
> 							sprintf(cbuf,"li%d",gim--);
> 							ni=NewAtom(cbuf,0);
> 							nc=AppendLast(nc,MakeCompound1(A_GAMMA,ni));
> 							ChangeList(ListNthList(CompoundArg2(ListFirst(l2)),3),ni);
> 							if(eff){FreeAtomic(ListFirst(l));ChangeList(l,0);}
> 							else ChangeList(ListNthList(CompoundArg2(ListFirst(l)),3),ni);
> 							l=CompoundArgN(m2,3);
> 							goto rpt;
> 						}
> 					}
926a978,981
> 					if(pind[2]==ListFirst(CompoundArg2(ListFirst(l))) &&
> 							pind[3]==ListNth(CompoundArg2(ListFirst(l)),2))
> 						pind[2]=pind[3]=0;
> 					nc=AppendLast(nc,A_DELTA);
932a988,989
> 	return nc;	
> 	}
933a991,1024
> static Term conv_lor(List pl, Term m2, int eff)
> {
> 	int i;
> 	List l;
> 	List nc=0, cc=0;
> 	char tens[10];
>   //  WriteTerm(m2);puts("");
> 	//WriteTerm(pl);puts("");
> 	if(ili[0]==0)
> 	{
> 		char cbuf[16];
> 		for(i=1;i<=6;i++)
> 		{
> 			sprintf(cbuf,"li%d",i); ili[i-1]=NewAtom(cbuf,0);
> 			sprintf(cbuf,"li%d",i+1000); ili[i-1+10]=NewAtom(cbuf,0);
> 			sprintf(cbuf,"li%d",i+2000); ili[i-1+20]=NewAtom(cbuf,0);
> 			sprintf(cbuf,"mom%d",i); imom[i-1]=NewAtom(cbuf,0);
> 		}
> 	}
>     for(i=0;i<16;i++) pind[i]=0;
>     
> 	for(l=pl,i=0;l;l=ListTail(l),i++)
> 	{
> 		Atom a;
> 		tens[i]=0;
> 		a=CompoundName(CompoundArg2(ListFirst(l)));
> 		if(a==OPR_VECTOR || a==OPR_SPINOR)
> 			pind[i]=ListFirst(CompoundArg1(CompoundArg2(ListFirst(l))));
> 		else if(a==OPR_TENSOR)
> 			pind[i]=ListFirst(CompoundArg1(CompoundArg2(ListFirst(l)))),
> 			pind[i+10]=ListFirst(ListTail(CompoundArg1(CompoundArg2(ListFirst(l))))),
> 			tens[i]=1;
> 		else
> 			pind[i]=0; 
936a1028,1033
> 	if(CompoundName(CompoundArg2(ListFirst(pl)))==OPR_SPINOR)
> 		nc=mkgammal(m2,nc,pind[0],pind[1],pl,tens,eff);
> 	if(ListLength(pl)==4 && CompoundName(CompoundArg2(ListNth(pl,3)))==OPR_SPINOR)
> 	{nc=AppendLast(nc,0); nc=mkgammal(m2,nc,pind[2],pind[3],pl,tens,eff);}
> 
> 		
944,945c1041,1043
< 			for(i=0;i<4;i++)
< 				if(ListFirst(CompoundArg2(ListFirst(l)))==pind[i])
---
> 			Integer ci=ListFirst(CompoundArg2(ListFirst(l)));
> 			for(i=0;i<6;i++)
> 				if(ci==pind[i]||ci==pind[i+10])
947c1045
< 			if(i==4)
---
> 			if(i==6)
949,951c1047,1052
< 			i1=ili[i];
< 			for(i++;i<4;i++)
< 				if(ListFirst(ListTail(CompoundArg2(ListFirst(l))))==pind[i])
---
> 			if(tens[i]==0) i1=ili[i];
> 			else if(ci==pind[i]) i1=ili[i+10];
> 			else i1=ili[i+20];
> 			ci=ListFirst(ListTail(CompoundArg2(ListFirst(l))));
> 			for(;i<6;i++)
> 				if(ci==pind[i]||ci==pind[i+10])
953c1054
< 			if(i==4)
---
> 			if(i==6)
960c1061,1063
< 			i2=ili[i];
---
> 			if(tens[i]==0) i2=ili[i];
> 			else if(ci==pind[i]) i2=ili[i+10];
> 			else i2=ili[i+20];
972c1075
< 			Atom in[4];
---
> 			Atom in[6];
978,981c1081,1082
< 			for(i=0;i<4;i++)
< 				if(ListFirst(lj)==pind[i])
< 					break;
< 			if(i<4)
---
> 			Atom iii=fili(ListFirst(lj),tens);
> 			if(iii)
983c1084
< 				in[j]=ili[i];
---
> 				in[j]=iii;
1011c1112
< 			int p1=IntegerValue(CompoundArg1(ListFirst(l)));
---
> 			int p1=(int)IntegerValue(CompoundArg1(ListFirst(l)));
1014,1017c1115,1116
< 			for(i=0;i<4;i++)
< 				if(pi==pind[i])
< 					break;
< 			if(i<4)
---
> 			Atom iii=fili(pi,tens);
> 			if(iii)
1019c1118
< 				cc=AppendLast(cc,MakeCompound2(A_DELTA,ili[i],imom[p1-1]));
---
> 				cc=AppendLast(cc,MakeCompound2(A_DELTA,iii,imom[p1-1]));
1029c1128
< 					int p2=IntegerValue(CompoundArg1(ListFirst(l2)));
---
> 					int p2=(int)IntegerValue(CompoundArg1(ListFirst(l2)));
1058a1158
>  //   WriteTerm(cc); printf(" "); WriteTerm(nc);puts("\n");
1070c1170
< 		int n=IntegerValue(is_integer(num)?num:CompoundArg1(num));
---
> 		int n=(int)IntegerValue(is_integer(num)?num:CompoundArg1(num));
1085c1185
< 		int  w=IntegerValue(CompoundArg2(ListFirst(l)));
---
> 		int  w=(int)IntegerValue(CompoundArg2(ListFirst(l)));
1119,1120c1219,1220
< 			for(i=0;i<4;i++) if(in1==pind[i]) break;
< 			if(i==4)
---
> 			for(i=0;i<6;i++) if(in1==pind[i]) break;
> 			if(i==6)
1122c1222
< 				for(i=0;i<4;i++) if(in1==wind[i]) break;
---
> 				for(i=0;i<6;i++) if(in1==wind[i]) break;
1124,1125c1224,1225
< 				if(i==4) puts("Internal error wrtfa07");
< 				for(i=0;i<4;i++) if(in2==wind[i]) break;
---
> 				if(i==6) puts("Internal error wrtfa07");
> 				for(i=0;i<6;i++) if(in2==wind[i]) break;
1127c1227
< 				if(i==4) puts("Internal error wrtfa07");
---
> 				if(i==6) puts("Internal error wrtfa07");
1133,1134c1233,1234
< 			for(i=0;i<4;i++) if(in2==pind[i]) break;
< 			if(i==4){puts("Internal error wrtfa07");}
---
> 			for(i=0;i<6;i++) if(in2==pind[i]) break;
> 			if(i==6){puts("Internal error wrtfa07");}
1151,1152c1251,1252
< 				for(i=0;i<4;i++) if(in1==wind[i]) break;
< 				if(i==4) puts("Internal error wrtfa07");
---
> 				for(i=0;i<6;i++) if(in1==wind[i]) break;
> 				if(i==6) puts("Internal error wrtfa07");
1180,1181c1280,1281
< 			for(i=0;i<4;i++) if(in1==pind[i]) break;
< 			il1=(i==4?IntegerValue(in1)+4:i);
---
> 			for(i=0;i<6;i++) if(in1==pind[i]) break;
> 			il1=(i==6?(int)IntegerValue(in1)+4:i);
1183,1184c1283,1284
< 			for(i=0;i<4;i++) if(in2==pind[i]) break;
< 			il2=(i==4?IntegerValue(in2)+4:i);
---
> 			for(i=0;i<6;i++) if(in2==pind[i]) break;
> 			il2=(i==6?(int)IntegerValue(in2)+4:i);
1186,1187c1286,1287
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			il3=(i==4?IntegerValue(in3)+4:i);
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			il3=(i==6?(int)IntegerValue(in3)+4:i);
1191c1291
< 			sno+=fprintf(of,"T(%d,%d,%d)",il3+1,il1+1,il2+1);
---
> 			sno+=fprintf(of,"T(%d,%d,%d)",il3+1,il2+1,il1+1);
1204,1209c1304,1309
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il2=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il2=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1211c1311
< 					il3+1,il1+1,il4+1,il2+1);
---
> 					il3+1,il2+1,il4+1,il1+1);
1222,1227c1322,1327
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(3)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(3)");il4=(int)IntegerValue(in4);}
1229c1329
< 					il1+1,il2+1,il3+1,il4+1);
---
> 					il2+1,il1+1,il4+1,il3+1);
1238c1338
< 			puts(": color structure error");il2=IntegerValue(in2);
---
> 			puts(": color structure error");il2=(int)IntegerValue(in2);
1261,1268c1361,1368
< 			for(i=0;i<4;i++) if(in1==pind[i]) break; il1=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l));
< 			puts(": color structure error(1)");il1=IntegerValue(in1);}
< 			for(i=0;i<4;i++) if(in2==pind[i]) break; il2=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l));
< 			puts(": color structure error(1)");il2=IntegerValue(in2);}
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i<4)
---
> 			for(i=0;i<6;i++) if(in1==pind[i]) break; il1=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l));
> 			puts(": color structure error(1)");il1=(int)IntegerValue(in1);}
> 			for(i=0;i<6;i++) if(in2==pind[i]) break; il2=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l));
> 			puts(": color structure error(1)");il2=(int)IntegerValue(in2);}
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i<6)
1282,1287c1382,1387
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1303,1308c1403,1408
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1317c1417
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
1341,1348c1441,1448
< 			for(i=0;i<4;i++) if(in1==pind[i]) break; il1=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l));
< 			puts(": color structure error(1)");il1=IntegerValue(in1);}
< 			for(i=0;i<4;i++) if(in2==pind[i]) break; il2=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l));
< 			puts(": color structure error(1)");il2=IntegerValue(in2);}
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i<4)
---
> 			for(i=0;i<6;i++) if(in1==pind[i]) break; il1=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l));
> 			puts(": color structure error(1)");il1=(int)IntegerValue(in1);}
> 			for(i=0;i<6;i++) if(in2==pind[i]) break; il2=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l));
> 			puts(": color structure error(1)");il2=(int)IntegerValue(in2);}
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i<6)
1362,1367c1462,1467
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1382,1387c1482,1487
< 			for(i=0;i<4;i++) if(in3==pind[i]) break; il3=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il3=IntegerValue(in3);}
< 			for(i=0;i<4;i++) if(in4==pind[i]) break; il4=i;
< 			if(i==4){WriteVertex(cv);WriteTerm(ListFirst(l2));
< 			puts(": color structure error(2)");il4=IntegerValue(in4);}
---
> 			for(i=0;i<6;i++) if(in3==pind[i]) break; il3=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il3=(int)IntegerValue(in3);}
> 			for(i=0;i<6;i++) if(in4==pind[i]) break; il4=i;
> 			if(i==6){WriteVertex(cv);WriteTerm(ListFirst(l2));
> 			puts(": color structure error(2)");il4=(int)IntegerValue(in4);}
1395c1495
< 			puts(": color structure error(3)");il3=IntegerValue(in3);}
---
> 			puts(": color structure error(3)");il3=(int)IntegerValue(in3);}
1440,1441d1539
< 	
< 	
1457a1556,1557
> 			else if(a==OPR_TENSOR) 
> 				{cbuf[i]='T';spl=AppendLast(spl,NewInteger(5));}
1525a1626
> 				int twoli=0;
1527a1629,1631
>                     int addin=0;
> 					if(ListFirst(l3)==0)
> 					{ twoli=2; su=0; continue;}
1530a1635
> 					else if(ListFirst(l3)==A_DELTA) fprintf(f,"Identity(");
1538c1643
< 							{fprintf(f,"P(%d,%d)*Gamma(%s,",-lin,-lin,AtomValue(a)+3);lin++;}
---
>                             {fprintf(f,"P(%d,%s)*Gamma(%d,",-lin-su,AtomValue(a)+3,-lin-su);lin++;addin=1;}
1543c1648
< 						fprintf(f,"1,");
---
> 						fprintf(f,"%d,",1+twoli);
1545,1546c1650,1651
< 					 {fprintf(f,"%d,",-lin);lin++;}
< 					if(ListTail(l3))
---
>                     {fprintf(f,"%d,",-lin+addin);lin++;addin=0;}
> 					if(ListTail(l3) && ListFirst(ListTail(l3)))
1551c1656
< 						fprintf(f,"2)");
---
> 						fprintf(f,"%d)",2+twoli);
Only in micromegas/Packages: Lilith
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages: Lilith-2-2.1db19.09patch1
diff -rbd micromegas/Packages/LoopTools-2.12-v0/MAKE /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/MAKE
1c1
< Make -j 4
---
> gmake -j 4
diff -rbd micromegas/Packages/LoopTools-2.12-v0/src/C/ffcc0.F /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/src/C/ffcc0.F
140,141c140,141
< *		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
< *     +			isgnal
---
> 		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
>      +			isgnal
148,150c148,150
< *		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
< *     +			isgnal
< *		print '(a,2g28.16,i3)','c0 = ',cc0p,ier1
---
> 		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
>      +			isgnal
> 		print '(a,2g28.16,i3)','c0 = ',cc0p,ier1
diff -rbd micromegas/Packages/LoopTools-2.12-v0/src/C/ffxc0.F /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/src/C/ffxc0.F
725,726c725,726
< *		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
< *     +			isgnal
---
> 		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
>      +			isgnal
733,735c733,735
< *		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
< *     +			isgnal
< *		print '(a,2g28.16,i3)','c0 = ',cc0p,ier1
---
> 		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
>      +			isgnal
> 		print '(a,2g28.16,i3)','c0 = ',cc0p,ier1
diff -rbd micromegas/Packages/LoopTools-2.12-v0/src/D/ffxd0.F /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/src/D/ffxd0.F
621,622c621,622
< *		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
< *     +			isgnal
---
> 		print '(a,i1,a,i2)','---#[ rotation ',irota,': isgnal ',
>      +			isgnal
625,627c625,627
< *		print '(a,i1,a,i2,a)','---#] rotation ',irota,
< *     +			': isgnal ',isgnal,' '
< *		print '(a,2g28.16,i3)','d0 = ',cd0p,ier1
---
> 		print '(a,i1,a,i2,a)','---#] rotation ',irota,
>      +			': isgnal ',isgnal,' '
> 		print '(a,2g28.16,i3)','d0 = ',cd0p,ier1
diff -rbd micromegas/Packages/LoopTools-2.12-v0/src/E/ffxe0.F /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/src/E/ffxe0.F
805,808c805,808
< *		print '(a,i2,a,i2)','---#[ rotation ',irota,
< *     +			': isgnal ',isgnal
< *		if (lcon) write(icon,'(a,i2,a,i2)') 'rotation ',irota,
< *     +                  ', isgnal ',isgnal
---
> 		print '(a,i2,a,i2)','---#[ rotation ',irota,
>      +			': isgnal ',isgnal
> 		if (lcon) write(icon,'(a,i2,a,i2)') 'rotation ',irota,
>      +                  ', isgnal ',isgnal
815,817c815,817
< *		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
< *     +			isgnal
< *		print '(a,2g28.16,i3)','e0 = ',ce0p,ier1
---
> 		print '(a,i1,a,i2)','---#] rotation ',irota,': isgnal ',
>      +			isgnal
> 		print '(a,2g28.16,i3)','e0 = ',ce0p,ier1
diff -rbd micromegas/Packages/LoopTools-2.12-v0/src/util/ffinit.F /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages/LoopTools-2.12-v0/src/util/ffinit.F
55,63c55,63
< *	print *,'===================================================='
< *	print *,'  FF 2.0, a package to evaluate one-loop integrals'
< *	print *,'written by G. J. van Oldenborgh, NIKHEF-H, Amsterdam'
< *	print *,'===================================================='
< *	print *,'for the algorithms used see preprint NIKHEF-H 89/17,'
< *	print *,'''New Algorithms for One-loop Integrals'', by G.J. van'
< *	print *,'Oldenborgh and J.A.M. Vermaseren, published in '
< *	print *,'Zeitschrift fuer Physik C46(1990)425.'
< *	print *,'===================================================='
---
> 	print *,'===================================================='
> 	print *,'  FF 2.0, a package to evaluate one-loop integrals'
> 	print *,'written by G. J. van Oldenborgh, NIKHEF-H, Amsterdam'
> 	print *,'===================================================='
> 	print *,'for the algorithms used see preprint NIKHEF-H 89/17,'
> 	print *,'''New Algorithms for One-loop Integrals'', by G.J. van'
> 	print *,'Oldenborgh and J.A.M. Vermaseren, published in '
> 	print *,'Zeitschrift fuer Physik C46(1990)425.'
> 	print *,'===================================================='
615c615
< *	print '(a,a)', 'error in ', error(nnerr)
---
> 	print '(a,a)', 'error in ', error(nnerr)
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages: NMSSMTools_5.5.2
Only in micromegas/Packages: superiso_v4.0
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma/Packages: SuSpect_2.41
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: SingletDM
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: THDMRS
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: TMtest
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: Z3IDM
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: Z4IDSM
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: Z5M
Only in /home/pukhov/MICROMEGAS/2021/micromegas_5.2.8-gamma: ZpPortal
